<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
<meta name="theme-color" content="#0d0d0d">
<title>Ù†ÙˆØ± AI â€” Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠ Ø§Ù„Ø°ÙƒÙŠ</title>
<meta name="description" content="Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¥Ø³Ù„Ø§Ù…ÙŠ Ù…ØªØ®ØµØµ">
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics-compat.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Naskh+Arabic:wght@400;500;600;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0d0d0d;--bg2:#171717;--bg3:#212121;--bg4:#2a2a2a;--bg5:#333;
  --border:#2f2f2f;--border2:#3a3a3a;
  --gold:#c9a84c;--gold-l:#e8c97a;--gold-d:#8b6914;
  --gold-dim:rgba(201,168,76,.12);--gold-glow:rgba(201,168,76,.07);--gold-border:rgba(201,168,76,.25);
  --text:#ececec;--text2:#9a9a9a;--text3:#565656;
  --green:#19c37d;--red:#ef4444;--blue:#58a6ff;
  --sidebar:268px;--radius:12px;
}
*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{font-family:'Noto Naskh Arabic',serif;background:var(--bg);color:var(--text);min-height:100vh;}
::-webkit-scrollbar{width:5px;height:5px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:4px;}

/* ===== PAGES ===== */
.page{display:none;}
.page.active{display:block;}
#appPage{display:none;height:100vh;overflow:hidden;}
#appPage.active{display:flex;flex-direction:row;}

/* ===== NAV ===== */
.nav{
  position:fixed;top:0;left:0;right:0;z-index:100;
  height:60px;display:flex;align-items:center;justify-content:space-between;
  padding:0 32px;
  background:rgba(13,13,13,.9);backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);
}
.nav-logo{display:flex;align-items:center;gap:10px;cursor:pointer;text-decoration:none;}
.nav-logo-icon{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--gold),var(--gold-d));display:flex;align-items:center;justify-content:center;}
.nav-logo-icon svg{width:18px;height:18px;fill:white;}
.nav-logo-text{font-family:'Amiri',serif;font-size:22px;color:var(--gold);font-weight:700;}
.nav-links{display:flex;align-items:center;gap:4px;list-style:none;}
.nav-links a{color:var(--text2);text-decoration:none;font-size:14px;padding:8px 14px;border-radius:8px;transition:all .15s;cursor:pointer;}
.nav-links a:hover{color:var(--text);background:var(--bg3);}
.nav-cta{display:flex;gap:8px;}
.btn{padding:8px 18px;border-radius:8px;font-family:'Noto Naskh Arabic',serif;font-size:14px;cursor:pointer;border:none;transition:all .2s;text-decoration:none;display:inline-flex;align-items:center;gap:6px;}
.btn-ghost{background:transparent;color:var(--text2);border:1px solid var(--border2);}
.btn-ghost:hover{color:var(--text);border-color:var(--text3);background:var(--bg3);}
.btn-gold{background:linear-gradient(135deg,var(--gold),var(--gold-d));color:#0d0d0d;font-weight:700;}
.btn-gold:hover{background:linear-gradient(135deg,var(--gold-l),var(--gold));transform:translateY(-1px);box-shadow:0 4px 16px rgba(201,168,76,.3);}
.btn-lg{padding:12px 26px;font-size:15px;border-radius:10px;}

/* ===== HERO ===== */
.hero{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:80px 20px 60px;position:relative;overflow:hidden;}
.hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse 80% 50% at 50% -10%,rgba(201,168,76,.08),transparent),radial-gradient(ellipse 60% 40% at 80% 80%,rgba(201,168,76,.04),transparent);pointer-events:none;}
.hero-badge{display:inline-flex;align-items:center;gap:8px;padding:5px 14px;border-radius:100px;background:var(--gold-dim);border:1px solid var(--gold-border);font-size:13px;color:var(--gold);margin-bottom:28px;animation:fadeUp .6s ease both;}
.pulse{width:7px;height:7px;border-radius:50%;background:var(--gold);animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1);}50%{opacity:.4;transform:scale(.75);}}
.hero-eyebrow{font-family:'Amiri',serif;font-size:17px;color:var(--gold);opacity:.7;letter-spacing:2px;margin-bottom:18px;animation:fadeUp .6s ease .1s both;}
.hero-title{font-family:'Amiri',serif;font-size:clamp(38px,7vw,76px);font-weight:700;line-height:1.2;margin-bottom:20px;animation:fadeUp .6s ease .15s both;}
.hero-title .grad{background:linear-gradient(135deg,var(--gold-l),var(--gold),var(--gold-d));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.hero-desc{font-size:17px;color:var(--text2);max-width:520px;line-height:1.9;margin-bottom:36px;animation:fadeUp .6s ease .2s both;}
.hero-btns{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;animation:fadeUp .6s ease .25s both;}
.hero-stats{display:flex;gap:48px;margin-top:64px;animation:fadeUp .6s ease .35s both;}
.stat-num{font-family:'Amiri',serif;font-size:34px;font-weight:700;color:var(--gold);}
.stat-label{font-size:13px;color:var(--text3);margin-top:2px;}
@keyframes fadeUp{from{opacity:0;transform:translateY(18px);}to{opacity:1;transform:translateY(0);}}

/* ===== DEMO ===== */
.demo-section{padding:80px 20px;max-width:860px;margin:0 auto;}
.section-eyebrow{text-align:center;font-size:11px;color:var(--text3);letter-spacing:2px;margin-bottom:12px;text-transform:uppercase;}
.section-title{font-family:'Amiri',serif;font-size:34px;text-align:center;margin-bottom:44px;}
.demo-box{background:var(--bg2);border:1px solid var(--border);border-radius:16px;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,.5);}
.demo-topbar{padding:14px 18px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;background:var(--bg3);}
.demo-topbar-left{display:flex;align-items:center;gap:10px;}
.demo-av{width:30px;height:30px;border-radius:8px;background:linear-gradient(135deg,var(--gold),var(--gold-d));display:flex;align-items:center;justify-content:center;}
.demo-av svg{width:14px;height:14px;fill:white;}
.demo-model{font-size:13px;font-weight:600;}
.demo-ver{font-size:11px;color:var(--text3);}
.online{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--green);}
.online-dot{width:7px;height:7px;border-radius:50%;background:var(--green);animation:pulse 2s infinite;}
.demo-msgs{padding:20px;display:flex;flex-direction:column;gap:20px;min-height:340px;max-height:420px;overflow-y:auto;}
.d-msg{display:flex;gap:10px;}
.d-msg.user{flex-direction:row-reverse;}
.d-av{width:28px;height:28px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0;margin-top:2px;}
.d-msg.ai .d-av{background:linear-gradient(135deg,var(--gold),var(--gold-d));}
.d-msg.ai .d-av svg{width:13px;height:13px;fill:white;}
.d-msg.user .d-av{background:var(--bg4);border:1px solid var(--border);color:var(--text3);}
.d-bubble{max-width:78%;padding:11px 14px;border-radius:12px;font-size:14px;line-height:1.85;}
.d-msg.ai .d-bubble{background:var(--bg3);border:1px solid var(--border);border-radius:4px 12px 12px 12px;}
.d-msg.user .d-bubble{background:var(--gold-dim);border:1px solid var(--gold-border);border-radius:12px 4px 12px 12px;}
.quran-box{background:var(--gold-glow);border:1px solid var(--gold-border);border-right:3px solid var(--gold);border-radius:0 8px 8px 0;padding:12px 14px;margin:10px 0;font-family:'Amiri',serif;font-size:17px;color:var(--gold-l);line-height:2.1;}
.quran-ref{font-size:11px;color:var(--text3);margin-top:5px;font-family:'Noto Naskh Arabic',serif;}
.src-row{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px;}
.src-tag{padding:3px 9px;background:var(--bg3);border:1px solid var(--border);border-radius:100px;font-size:11px;color:var(--text3);}
.typing-dots{display:flex;gap:5px;padding:4px 2px;}
.tdot{width:6px;height:6px;border-radius:50%;background:var(--gold);animation:blink 1.4s infinite;}
.tdot:nth-child(2){animation-delay:.2s;}.tdot:nth-child(3){animation-delay:.4s;}
@keyframes blink{0%,60%,100%{opacity:.3;transform:scale(.85);}30%{opacity:1;transform:scale(1.1);}}
.demo-suggests{display:flex;flex-wrap:wrap;gap:7px;padding:12px 18px;border-top:1px solid var(--border);}
.sug{padding:6px 13px;background:var(--bg3);border:1px solid var(--border);border-radius:100px;font-size:12px;color:var(--text2);cursor:pointer;transition:all .2s;font-family:'Noto Naskh Arabic',serif;white-space:nowrap;}
.sug:hover{border-color:var(--gold-border);color:var(--gold);background:var(--gold-glow);}
.demo-input{padding:14px 18px;border-top:1px solid var(--border);background:var(--bg3);}
.demo-input-box{display:flex;align-items:center;gap:8px;background:var(--bg2);border:1px solid var(--border);border-radius:10px;padding:10px 14px;}
.demo-input-box input{flex:1;background:transparent;border:none;outline:none;color:var(--text);font-family:'Noto Naskh Arabic',serif;font-size:14px;direction:rtl;}
.demo-input-box input::placeholder{color:var(--text3);}
.demo-send{width:32px;height:32px;border-radius:7px;background:var(--gold);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;}
.demo-send:hover{background:var(--gold-l);}
.demo-send svg{width:14px;height:14px;fill:#0d0d0d;}

/* ===== FEATURES ===== */
.features-section{padding:80px 20px;max-width:1160px;margin:0 auto;}
.features-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:48px;}
.feat-card{padding:26px;background:var(--bg2);border:1px solid var(--border);border-radius:14px;cursor:default;transition:all .25s;position:relative;overflow:hidden;}
.feat-card::after{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--gold),transparent);opacity:0;transition:opacity .25s;}
.feat-card:hover{border-color:var(--gold-border);transform:translateY(-3px);background:var(--bg3);}
.feat-card:hover::after{opacity:1;}
.feat-icon{width:40px;height:40px;border-radius:10px;background:var(--gold-dim);border:1px solid var(--gold-border);display:flex;align-items:center;justify-content:center;margin-bottom:14px;}
.feat-icon svg{width:18px;height:18px;fill:var(--gold);}
.feat-name{font-size:16px;font-weight:600;margin-bottom:8px;}
.feat-desc{font-size:13px;color:var(--text2);line-height:1.8;}

/* ===== HOW ===== */
.how-section{padding:80px 20px;max-width:900px;margin:0 auto;}
.steps{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-top:48px;}
.step{text-align:center;padding:32px 20px;}
.step-num{font-family:'Amiri',serif;font-size:48px;color:var(--gold);opacity:.3;font-weight:700;margin-bottom:12px;}
.step-name{font-size:16px;font-weight:600;margin-bottom:8px;}
.step-desc{font-size:13px;color:var(--text2);line-height:1.8;}

/* ===== PRICING ===== */
.pricing-section{padding:80px 20px;max-width:800px;margin:0 auto;}
.pricing-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:48px;}
.plan-card{background:var(--bg2);border:1px solid var(--border);border-radius:18px;padding:32px;position:relative;overflow:hidden;transition:transform .2s;}
.plan-card:hover{transform:translateY(-4px);}
.plan-card.pro{border-color:var(--gold-border);background:var(--gold-glow);}
.plan-best{position:absolute;top:18px;left:18px;padding:3px 12px;background:var(--gold);border-radius:100px;font-size:11px;font-weight:700;color:#0d0d0d;}
.plan-name{font-family:'Amiri',serif;font-size:22px;margin-bottom:8px;}
.plan-price{font-family:'Amiri',serif;font-size:48px;font-weight:700;color:var(--gold);line-height:1;margin:14px 0 4px;}
.plan-price.free-p{color:var(--text);}
.plan-period{font-size:12px;color:var(--text3);margin-bottom:24px;}
.plan-feats{list-style:none;display:flex;flex-direction:column;gap:10px;margin-bottom:24px;}
.plan-feats li{display:flex;align-items:center;gap:9px;font-size:13px;color:var(--text2);}
.plan-feats li svg{width:15px;height:15px;flex-shrink:0;}
.check-svg{fill:var(--green);}
.x-svg{fill:var(--text3);}

/* ===== DIVIDER ===== */
.divider{display:flex;align-items:center;gap:16px;max-width:1200px;margin:0 auto;padding:0 32px;opacity:.25;}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--border);}

/* ===== APP LAYOUT ===== */
.sidebar{
  width:var(--sidebar);flex-shrink:0;
  background:var(--bg2);border-left:1px solid var(--border);
  display:flex;flex-direction:column;
  position:relative;z-index:10;
}
.sidebar-top{padding:12px;display:flex;flex-direction:column;gap:6px;}
.new-btn{width:100%;padding:9px 14px;background:transparent;border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'Noto Naskh Arabic',serif;font-size:13px;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all .15s;}
.new-btn:hover{background:var(--bg3);}
.new-btn svg{flex-shrink:0;}
/* Search box */
.sb-search{display:flex;align-items:center;gap:7px;background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:7px 10px;}
.sb-search input{flex:1;background:transparent;border:none;outline:none;color:var(--text);font-family:'Noto Naskh Arabic',serif;font-size:12px;direction:rtl;}
.sb-search input::placeholder{color:var(--text3);}
.sb-search svg{width:13px;height:13px;stroke:var(--text3);flex-shrink:0;}
.sidebar-list{flex:1;overflow-y:auto;padding:4px 8px;}
.grp-label{font-size:11px;color:var(--text3);padding:10px 8px 4px;font-weight:600;letter-spacing:.3px;}
.c-item{padding:9px 10px;border-radius:8px;cursor:pointer;font-size:13px;color:var(--text2);display:flex;align-items:center;gap:8px;transition:all .15s;position:relative;}
.c-item:hover{background:var(--bg3);color:var(--text);}
.c-item.on{background:var(--bg3);color:var(--text);}
.c-txt{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.c-del{opacity:0;width:20px;height:20px;border-radius:4px;display:flex;align-items:center;justify-content:center;background:transparent;border:none;color:var(--text3);cursor:pointer;transition:all .15s;flex-shrink:0;}
.c-item:hover .c-del{opacity:1;}
.c-del:hover{color:var(--red);background:rgba(239,68,68,.1);}
.sidebar-foot{padding:8px;border-top:1px solid var(--border);}
.user-row{display:flex;align-items:center;gap:10px;padding:10px;border-radius:8px;cursor:pointer;transition:all .15s;}
.user-row:hover{background:var(--bg3);}
.u-av{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--gold-d));display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:#0d0d0d;flex-shrink:0;}
.u-av.empty{background:var(--bg3);border:1px solid var(--border);}
.u-name{font-size:13px;color:var(--text);}
.u-plan{font-size:11px;color:var(--text3);}
.u-info{flex:1;min-width:0;}

/* ===== CHAT MAIN ===== */
.chat-main{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0;}
.app-topbar{display:none;align-items:center;justify-content:space-between;padding:0 14px;height:52px;background:var(--bg2);border-bottom:1px solid var(--border);flex-shrink:0;}
.icon-btn{width:36px;height:36px;border-radius:8px;background:transparent;border:1px solid var(--border);cursor:pointer;color:var(--text2);display:flex;align-items:center;justify-content:center;transition:all .15s;}
.icon-btn:hover{background:var(--bg3);color:var(--text);}
.chat-msgs{flex:1;overflow-y:auto;display:flex;flex-direction:column;}

/* ===== WELCOME ===== */
.welcome-screen{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;text-align:center;}
.w-icon{width:56px;height:56px;border-radius:16px;background:linear-gradient(135deg,var(--gold),var(--gold-d));display:flex;align-items:center;justify-content:center;margin-bottom:18px;}
.w-icon svg{width:28px;height:28px;fill:white;}
.w-title{font-family:'Amiri',serif;font-size:28px;font-weight:700;margin-bottom:8px;}
.w-sub{font-size:14px;color:var(--text2);line-height:1.85;max-width:400px;margin-bottom:28px;}
.starter-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;width:100%;max-width:480px;}
.starter{padding:14px 16px;background:var(--bg3);border:1px solid var(--border);border-radius:12px;cursor:pointer;text-align:right;transition:all .2s;}
.starter:hover{border-color:var(--gold-border);background:var(--bg4);}
.st-icon{width:28px;height:28px;border-radius:7px;background:var(--gold-dim);border:1px solid var(--gold-border);display:flex;align-items:center;justify-content:center;margin-bottom:8px;}
.st-icon svg{width:13px;height:13px;fill:var(--gold);}
.st-name{font-size:13px;font-weight:600;}
.st-sub{font-size:11px;color:var(--text3);margin-top:2px;}

/* ===== MESSAGES ===== */
.msg-row{padding:14px 28px;width:100%;max-width:720px;margin:0 auto;animation:fadeUp .25s ease;}
.msg-row.u{display:block;text-align:left;}
.u-bubble{background:var(--bg3);border-radius:18px 18px 4px 18px;padding:12px 16px;font-size:15px;line-height:1.8;display:inline-block;max-width:80%;direction:rtl;}
.msg-row.a{display:flex;gap:12px;align-items:flex-start;}
.a-av{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--gold),var(--gold-d));display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:2px;}
.a-av svg{width:13px;height:13px;fill:white;}
.a-content{flex:1;font-size:15px;line-height:1.9;}

/* Message actions */
.msg-actions{display:flex;gap:6px;margin-top:10px;opacity:0;transition:opacity .2s;}
.msg-row.a:hover .msg-actions{opacity:1;}
.msg-act-btn{padding:4px 10px;border-radius:6px;background:var(--bg3);border:1px solid var(--border);color:var(--text3);font-size:11px;cursor:pointer;font-family:'Noto Naskh Arabic',serif;display:flex;align-items:center;gap:5px;transition:all .15s;}
.msg-act-btn:hover{color:var(--text);border-color:var(--border2);}
.msg-act-btn svg{width:11px;height:11px;}

/* Quran box in chat */
.chat-quran{background:var(--gold-glow);border:1px solid var(--gold-border);border-right:3px solid var(--gold);border-radius:0 8px 8px 0;padding:14px 16px;margin:12px 0;font-family:'Amiri',serif;font-size:18px;color:var(--gold-l);line-height:2.1;}
.chat-quran-ref{font-size:11px;color:var(--text3);margin-top:6px;font-family:'Noto Naskh Arabic',serif;}
.chat-src-row{display:flex;gap:6px;flex-wrap:wrap;margin-top:10px;}
.chat-src-tag{padding:3px 10px;background:var(--bg3);border:1px solid var(--border);border-radius:100px;font-size:11px;color:var(--text3);}

.typing-row{display:flex;gap:12px;align-items:flex-start;padding:14px 28px;max-width:720px;margin:0 auto;width:100%;}
.t-dots{display:flex;gap:5px;padding:6px 0;align-items:center;}

/* ===== INPUT ZONE ===== */
.input-zone{padding:12px 28px 16px;background:var(--bg);flex-shrink:0;max-width:768px;width:100%;margin:0 auto;}
.input-box{background:var(--bg3);border:1px solid var(--border);border-radius:14px;padding:11px 13px;display:flex;align-items:flex-end;gap:8px;transition:border-color .2s;}
.input-box:focus-within{border-color:var(--gold-border);}
.chat-ta{flex:1;background:transparent;border:none;outline:none;color:var(--text);font-family:'Noto Naskh Arabic',serif;font-size:15px;line-height:1.6;resize:none;direction:rtl;min-height:24px;max-height:120px;}
.chat-ta::placeholder{color:var(--text3);}
.inp-row{display:flex;gap:6px;align-items:center;}
.inp-btn{width:34px;height:34px;border-radius:8px;border:none;background:transparent;color:var(--text3);display:flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0;transition:all .2s;}
.inp-btn:hover{background:var(--bg4);color:var(--text2);}
.inp-send{background:var(--gold);color:#0d0d0d;}
.inp-send:hover{background:var(--gold-l);color:#0d0d0d;}
.inp-send:disabled{opacity:.35;cursor:not-allowed;}
.inp-send svg,.inp-btn svg{width:15px;height:15px;}
.inp-send svg{fill:#0d0d0d;stroke:none;}
.inp-btn svg{fill:none;stroke:currentColor;stroke-width:2;}
.footer-note{text-align:center;font-size:11px;color:var(--text3);margin-top:9px;}

/* Mode selector */
.mode-bar{display:flex;gap:6px;margin-bottom:8px;flex-wrap:wrap;}
.mode-btn{padding:5px 12px;border-radius:100px;background:var(--bg3);border:1px solid var(--border);color:var(--text3);font-size:12px;cursor:pointer;font-family:'Noto Naskh Arabic',serif;transition:all .2s;display:flex;align-items:center;gap:5px;}
.mode-btn.on{background:var(--gold-dim);border-color:var(--gold-border);color:var(--gold);}
.mode-btn svg{width:12px;height:12px;fill:currentColor;}

/* Char counter */
.char-info{display:flex;align-items:center;justify-content:space-between;padding:4px 0;}
.char-cnt{font-size:11px;color:var(--text3);}

/* ===== AUTH MODAL ===== */
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.82);backdrop-filter:blur(14px);z-index:500;align-items:center;justify-content:center;padding:16px;}
.overlay.show{display:flex;}
.modal{background:var(--bg2);border:1px solid var(--border);border-radius:20px;padding:34px 30px;width:100%;max-width:420px;position:relative;animation:fadeUp .25s ease;}
.mx{position:absolute;top:14px;left:14px;background:none;border:none;color:var(--text3);font-size:20px;cursor:pointer;width:28px;height:28px;border-radius:6px;display:flex;align-items:center;justify-content:center;transition:all .15s;}
.mx:hover{background:var(--bg3);color:var(--text);}
.modal-logo{width:46px;height:46px;border-radius:14px;background:linear-gradient(135deg,var(--gold),var(--gold-d));display:flex;align-items:center;justify-content:center;margin:0 auto 14px;}
.modal-logo svg{width:22px;height:22px;fill:white;}
.modal-title{font-family:'Amiri',serif;font-size:23px;text-align:center;margin-bottom:4px;}
.modal-sub{font-size:13px;color:var(--text2);text-align:center;margin-bottom:22px;}
.tabs{display:flex;background:var(--bg);border-radius:10px;padding:3px;margin-bottom:18px;gap:3px;}
.tab{flex:1;padding:8px;border:none;background:transparent;color:var(--text3);font-family:'Noto Naskh Arabic',serif;font-size:13px;cursor:pointer;border-radius:7px;transition:all .15s;}
.tab.on{background:var(--bg3);color:var(--text);border:1px solid var(--border);}
.alert-box{padding:10px 13px;border-radius:9px;font-size:13px;margin-bottom:11px;display:none;}
.alert-box.err{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3);color:#f87171;}
.alert-box.ok{background:rgba(25,195,125,.1);border:1px solid rgba(25,195,125,.3);color:#34d399;}
.oauth-btn{width:100%;padding:11px;border-radius:10px;background:var(--bg3);border:1px solid var(--border);color:var(--text);font-family:'Noto Naskh Arabic',serif;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:8px;transition:all .15s;}
.oauth-btn:hover{border-color:var(--border2);background:var(--bg4);}
.sep{display:flex;align-items:center;gap:12px;margin:13px 0;}
.sep::before,.sep::after{content:'';flex:1;height:1px;background:var(--border);}
.sep span{font-size:12px;color:var(--text3);}
.field{width:100%;padding:11px 14px;margin-bottom:9px;background:var(--bg);border:1px solid var(--border);border-radius:9px;color:var(--text);font-family:'Noto Naskh Arabic',serif;font-size:14px;outline:none;direction:rtl;transition:border-color .2s;}
.field:focus{border-color:var(--gold-border);}
.field::placeholder{color:var(--text3);}
.submit{width:100%;padding:12px;border-radius:10px;border:none;background:var(--gold);color:#0d0d0d;font-family:'Noto Naskh Arabic',serif;font-size:15px;font-weight:700;cursor:pointer;transition:all .2s;}
.submit:hover{background:var(--gold-l);}
.submit:disabled{opacity:.5;cursor:not-allowed;}
.modal-foot{text-align:center;font-size:12px;color:var(--text3);margin-top:13px;}
.modal-foot a{color:var(--gold);text-decoration:none;cursor:pointer;}

/* ===== TOAST ===== */
.toast{position:fixed;bottom:24px;right:24px;background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:12px 18px;font-size:13px;color:var(--text);z-index:9999;display:flex;align-items:center;gap:10px;box-shadow:0 8px 24px rgba(0,0,0,.4);transform:translateY(80px);opacity:0;transition:all .3s ease;}
.toast.show{transform:translateY(0);opacity:1;}
.toast.ok{border-color:var(--green);}
.toast svg{width:15px;height:15px;flex-shrink:0;}

/* ===== PRAYER TIMES WIDGET ===== */
.prayer-widget{margin:8px 8px 0;background:var(--gold-glow);border:1px solid var(--gold-border);border-radius:10px;padding:10px;display:none;}
.prayer-widget.show{display:block;}
.pw-title{font-size:11px;color:var(--gold);margin-bottom:6px;font-weight:600;}
.pw-grid{display:grid;grid-template-columns:1fr 1fr;gap:4px;}
.pw-item{font-size:11px;color:var(--text2);display:flex;justify-content:space-between;padding:2px 4px;border-radius:4px;}
.pw-item.next{color:var(--gold);background:var(--gold-dim);}

/* ===== TASBIH MODAL ===== */
.tasbih-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.82);backdrop-filter:blur(14px);z-index:600;align-items:center;justify-content:center;}
.tasbih-overlay.show{display:flex;}
.tasbih-box{background:var(--bg2);border:1px solid var(--border);border-radius:20px;padding:40px 30px;text-align:center;width:320px;position:relative;}
.tasbih-title{font-family:'Amiri',serif;font-size:24px;color:var(--gold);margin-bottom:6px;}
.tasbih-dhikr{font-family:'Amiri',serif;font-size:22px;color:var(--text);margin:16px 0;}
.tasbih-count{font-family:'Amiri',serif;font-size:72px;font-weight:700;color:var(--gold);line-height:1;}
.tasbih-btn{width:100px;height:100px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--gold-d));border:none;cursor:pointer;font-size:36px;margin:20px auto;display:block;transition:all .15s;box-shadow:0 4px 16px rgba(201,168,76,.3);}
.tasbih-btn:active{transform:scale(.93);}
.tasbih-controls{display:flex;gap:10px;justify-content:center;margin-top:16px;}
.tasbih-ctrl{padding:8px 16px;border-radius:8px;background:var(--bg3);border:1px solid var(--border);color:var(--text2);cursor:pointer;font-family:'Noto Naskh Arabic',serif;font-size:13px;transition:all .15s;}
.tasbih-ctrl:hover{color:var(--text);background:var(--bg4);}
.dhikr-opts{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;margin-bottom:16px;}
.dhikr-opt{padding:5px 12px;border-radius:100px;background:var(--bg3);border:1px solid var(--border);color:var(--text3);font-size:12px;cursor:pointer;font-family:'Amiri',serif;transition:all .15s;}
.dhikr-opt.on{background:var(--gold-dim);border-color:var(--gold-border);color:var(--gold);}

/* ===== EXPORT OPTIONS ===== */
.export-menu{position:absolute;bottom:100%;right:0;background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:6px;z-index:100;display:none;min-width:140px;}
.export-menu.show{display:block;}
.export-item{padding:8px 12px;border-radius:7px;cursor:pointer;font-size:13px;color:var(--text2);font-family:'Noto Naskh Arabic',serif;transition:all .15s;display:flex;align-items:center;gap:8px;}
.export-item:hover{background:var(--bg4);color:var(--text);}
.export-wrap{position:relative;}

/* ===== MOBILE ===== */
.mob-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:199;}
.mob-overlay.show{display:block;}

@media(max-width:720px){
  .nav-links{display:none;}
  .hero-stats{gap:24px;}
  .features-grid{grid-template-columns:1fr;}
  .steps{grid-template-columns:1fr;}
  .pricing-grid{grid-template-columns:1fr;}
  #appPage{flex-direction:column;}
  .sidebar{position:fixed;right:0;top:0;bottom:0;z-index:200;transform:translateX(100%);width:280px;box-shadow:-6px 0 24px rgba(0,0,0,.5);}
  .sidebar.mob-open{transform:translateX(0);}
  .app-topbar{display:flex;}
  .msg-row{padding-right:14px;padding-left:14px;}
  .input-zone{padding:10px 14px 14px;}
  .nav{padding:0 16px;}
  footer .footer-grid{grid-template-columns:1fr 1fr;}
}
</style>
</head>
<body>

<div class="mob-overlay" id="mobOv" onclick="closeSB()"></div>

<!-- TOAST -->
<div class="toast" id="toast">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
  <span id="toastMsg"></span>
</div>

<!-- TASBIH MODAL -->
<div class="tasbih-overlay" id="tasbihOv">
  <div class="tasbih-box">
    <button class="mx" onclick="closeTasbih()" style="color:var(--text3)">Ã—</button>
    <div class="tasbih-title">ğŸ“¿ Ø§Ù„Ø³Ø¨Ø­Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</div>
    <div class="dhikr-opts">
      <span class="dhikr-opt on" onclick="setDhikr(this,'Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡')">Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡</span>
      <span class="dhikr-opt" onclick="setDhikr(this,'Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡')">Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡</span>
      <span class="dhikr-opt" onclick="setDhikr(this,'Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±')">Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±</span>
      <span class="dhikr-opt" onclick="setDhikr(this,'Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡')">Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡</span>
      <span class="dhikr-opt" onclick="setDhikr(this,'Ø£Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡')">Ø£Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡</span>
    </div>
    <div class="tasbih-dhikr" id="tasbihDhikr">Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡</div>
    <div class="tasbih-count" id="tasbihCount">0</div>
    <button class="tasbih-btn" onclick="tasbihClick()">â˜</button>
    <div class="tasbih-controls">
      <button class="tasbih-ctrl" onclick="resetTasbih()">Ø¥Ø¹Ø§Ø¯Ø©</button>
      <button class="tasbih-ctrl" onclick="closeTasbih()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>
</div>

<!-- ============================================================ -->
<!--  LANDING PAGE                                                -->
<!-- ============================================================ -->
<div id="landingPage" class="page active">
  <nav class="nav">
    <a class="nav-logo">
      <div class="nav-logo-icon"><svg viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></div>
      <span class="nav-logo-text">Ù†ÙˆØ± AI</span>
    </a>
    <ul class="nav-links">
      <li><a href="#demo-anchor">Ø§Ù„Ù…Ù†ØµØ©</a></li>
      <li><a href="#features-anchor">Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª</a></li>
      <li><a href="#pricing-anchor">Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</a></li>
    </ul>
    <div class="nav-cta">
      <button class="btn btn-ghost" onclick="openModal('login')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      <button class="btn btn-gold" onclick="goApp()">Ø§Ø¨Ø¯Ø£ Ù…Ø¬Ø§Ù†Ù‹Ø§ â€º</button>
    </div>
  </nav>

  <section class="hero">
    <div class="hero-badge"><div class="pulse"></div>Ù…Ø¯Ø¹ÙˆÙ… Ø¨Ø£Ø­Ø¯Ø« Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</div>
    <div class="hero-eyebrow">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„Ù‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…Ù°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
    <h1 class="hero-title">Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠ<br><span class="grad">Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ÙˆØ«ÙˆÙ‚</span></h1>
    <p class="hero-desc">Ù…Ù†ØµØ© Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…ØªØ®ØµØµØ© ÙÙŠ Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ© â€” ØªÙØ³ÙŠØ± Ø§Ù„Ù‚Ø±Ø¢Ù†ØŒ Ø´Ø±Ø­ Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ«ØŒ Ø§Ù„ÙÙ‚Ù‡ ÙˆØ§Ù„ÙØªØ§ÙˆÙ‰ØŒ ÙˆØ§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ù†Ø¨ÙˆÙŠØ©. Ø¥Ø¬Ø§Ø¨Ø§Øª Ø¯Ù‚ÙŠÙ‚Ø© Ø¨Ù…ØµØ§Ø¯Ø± Ù…ÙˆØ«Ù‚Ø©.</p>
    <div class="hero-btns">
      <button class="btn btn-gold btn-lg" onclick="goApp()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© â€”</button>
      <a class="btn btn-ghost btn-lg" href="#demo-anchor">Ø´Ø§Ù‡Ø¯ ÙƒÙŠÙ ÙŠØ¹Ù…Ù„</a>
    </div>
    <div class="hero-stats">
      <div class="stat"><div class="stat-num">Ù¡Ù¡Ù¤</div><div class="stat-label">Ø³ÙˆØ±Ø© Ù‚Ø±Ø¢Ù†ÙŠØ©</div></div>
      <div class="stat"><div class="stat-num">Ù¦Ù Ù Ù +</div><div class="stat-label">Ø­Ø¯ÙŠØ« Ù†Ø¨ÙˆÙŠ</div></div>
      <div class="stat"><div class="stat-num">Ù¤</div><div class="stat-label">Ù…Ø°Ø§Ù‡Ø¨ ÙÙ‚Ù‡ÙŠØ©</div></div>
      <div class="stat"><div class="stat-num">Ù£</div><div class="stat-label">Ù„ØºØ§Øª Ù…Ø¯Ø¹ÙˆÙ…Ø©</div></div>
    </div>
  </section>

  <section id="demo-anchor" class="demo-section">
    <div class="section-eyebrow">â€” ØªØ¬Ø±Ø¨Ø© Ø­ÙŠØ© â€”</div>
    <h2 class="section-title">Ø´Ø§Ù‡Ø¯ Ù†ÙˆØ± AI ÙÙŠ Ø§Ù„Ø¹Ù…Ù„</h2>
    <div class="demo-box">
      <div class="demo-topbar">
        <div class="demo-topbar-left">
          <div class="demo-av"><svg viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></div>
          <div><div class="demo-model">Ù†ÙˆØ± AI</div><div class="demo-ver">Ø§Ù„Ù†Ø³Ø®Ø© Ù¡.Ù </div></div>
        </div>
        <div class="online"><div class="online-dot"></div>Ù†Ø´Ø· Ø§Ù„Ø¢Ù†</div>
      </div>
      <div class="demo-msgs" id="demoMsgs">
        <div class="d-msg ai">
          <div class="d-av"><svg viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></div>
          <div class="d-bubble">Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡ ğŸŒ™<br><br>Ø£Ù†Ø§ <strong>Ù†ÙˆØ± AI</strong>ØŒ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠ Ø§Ù„Ù…ØªØ®ØµØµ. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ</div>
        </div>
        <div class="d-msg user">
          <div class="d-av">Ù</div>
          <div class="d-bubble">Ù…Ø§ ØªÙØ³ÙŠØ± Ø§Ù„Ø¢ÙŠØ© "ÙˆØ¥Ø°Ø§ Ø³Ø£Ù„Ùƒ Ø¹Ø¨Ø§Ø¯ÙŠ Ø¹Ù†ÙŠ ÙØ¥Ù†ÙŠ Ù‚Ø±ÙŠØ¨"ØŸ</div>
        </div>
        <div class="d-msg ai">
          <div class="d-av"><svg viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></div>
          <div class="d-bubble">
            Ù‡Ø°Ù‡ Ø§Ù„Ø¢ÙŠØ© Ù…Ù† Ø£Ø¹Ø¸Ù… Ø§Ù„Ø¢ÙŠØ§Øª Ø§Ù„ØªÙŠ ØªØªØ­Ø¯Ø« Ø¹Ù† Ù‚Ø±Ø¨ Ø§Ù„Ù„Ù‡ ÙˆØ¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø¯Ø¹Ø§Ø¡.
            <div class="quran-box">ï´¿ÙˆÙØ¥ÙØ°ÙØ§ Ø³ÙØ£ÙÙ„ÙÙƒÙ Ø¹ÙØ¨ÙØ§Ø¯ÙÙŠ Ø¹ÙÙ†ÙÙ‘ÙŠ ÙÙØ¥ÙÙ†ÙÙ‘ÙŠ Ù‚ÙØ±ÙÙŠØ¨ÙŒ Ø£ÙØ¬ÙÙŠØ¨Ù Ø¯ÙØ¹Ù’ÙˆÙØ©Ù Ø§Ù„Ø¯ÙÙ‘Ø§Ø¹Ù Ø¥ÙØ°ÙØ§ Ø¯ÙØ¹ÙØ§Ù†Ùï´¾<div class="quran-ref">Ø³ÙˆØ±Ø© Ø§Ù„Ø¨Ù‚Ø±Ø©: Ø¢ÙŠØ© Ù¡Ù¨Ù¦</div></div>
            <strong>Ø§Ù„Ù…Ø¹Ù†Ù‰:</strong> Ù‚Ø±Ø¨ Ø§Ù„Ø¹Ù„Ù… ÙˆØ§Ù„Ø¥Ø­Ø§Ø·Ø©ØŒ ÙˆÙ‚Ø±Ø¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù„Ù…Ù† Ø¯Ø¹Ø§Ù‡ Ø¨ØµØ¯Ù‚ ÙˆÙŠÙ‚ÙŠÙ†.
            <div class="src-row"><span class="src-tag">ØªÙØ³ÙŠØ± Ø§Ø¨Ù† ÙƒØ«ÙŠØ±</span><span class="src-tag">Ø§Ù„Ø·Ø¨Ø±ÙŠ</span><span class="src-tag">âœ” Ù…ÙˆØ«Ù‚</span></div>
          </div>
        </div>
      </div>
      <div class="demo-suggests">
        <span class="sug" onclick="demoAsk(this)">Ø£Ø±ÙƒØ§Ù† Ø§Ù„Ø¥Ø³Ù„Ø§Ù…</span>
        <span class="sug" onclick="demoAsk(this)">Ø­ÙƒÙ… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† Ø¨Ø¯ÙˆÙ† ÙˆØ¶ÙˆØ¡</span>
        <span class="sug" onclick="demoAsk(this)">Ù…ØªÙ‰ ØªØ¬Ø¨ Ø§Ù„Ø²ÙƒØ§Ø©ØŸ</span>
        <span class="sug" onclick="demoAsk(this)">ÙØ¶Ù„ Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ù</span>
        <span class="sug" onclick="demoAsk(this)">Ø¯Ø¹Ø§Ø¡ ÙƒÙØ§Ø±Ø© Ø§Ù„Ù…Ø¬Ù„Ø³</span>
      </div>
      <div class="demo-input">
        <div class="demo-input-box">
          <input id="demoInp" type="text" placeholder="Ø§Ø³Ø£Ù„Ù†ÙŠ Ø¹Ù† Ø§Ù„Ù‚Ø±Ø¢Ù†ØŒ Ø§Ù„Ø­Ø¯ÙŠØ«ØŒ Ø§Ù„ÙÙ‚Ù‡..." onkeydown="if(event.key==='Enter')demoSend()">
          <button class="demo-send" onclick="demoSend()"><svg viewBox="0 0 24 24"><path d="M22 2L11 13M22 2L15 22 11 13 2 9l20-7z"/></svg></button>
        </div>
      </div>
    </div>
  </section>

  <section id="features-anchor" class="features-section">
    <div class="section-eyebrow">â€” Ù‚Ø¯Ø±Ø§Øª Ø§Ù„Ù…Ù†ØµØ© â€”</div>
    <h2 class="section-title">ÙƒÙ„ Ù…Ø§ ØªØ­ØªØ§Ø¬Ù‡ ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯</h2>
    <div class="features-grid">
      <div class="feat-card">
        <div class="feat-icon"><svg viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg></div>
        <div class="feat-name">ØªÙØ³ÙŠØ± Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</div>
        <div class="feat-desc">ØªÙØ³ÙŠØ± Ø¯Ù‚ÙŠÙ‚ Ù„Ù„Ø¢ÙŠØ§Øª Ù…Ø¹ Ø°ÙƒØ± Ø§Ù„Ù…ØµØ¯Ø± Ù…Ù† ÙƒØªØ¨ Ø§Ù„ØªÙØ³ÙŠØ± Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© ÙƒØ§Ø¨Ù† ÙƒØ«ÙŠØ± ÙˆØ§Ù„Ø·Ø¨Ø±ÙŠ ÙˆØ§Ù„Ø³Ø¹Ø¯ÙŠ.</div>
      </div>
      <div class="feat-card">
        <div class="feat-icon"><svg viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></div>
        <div class="feat-name">Ø´Ø±Ø­ Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ« Ø§Ù„Ù†Ø¨ÙˆÙŠØ©</div>
        <div class="feat-desc">Ø´Ø±Ø­ ÙˆØ§ÙÙ Ù„Ù„Ø£Ø­Ø§Ø¯ÙŠØ« Ù…Ø¹ ØªØ®Ø±ÙŠØ¬Ù‡Ø§ ÙˆØ¨ÙŠØ§Ù† Ø¯Ø±Ø¬Ø© ØµØ­ØªÙ‡Ø§ Ù…Ù† Ù…ØµØ§Ø¯Ø± Ù…ÙˆØ«ÙˆÙ‚Ø© ÙƒØ§Ù„Ø¨Ø®Ø§Ø±ÙŠ ÙˆÙ…Ø³Ù„Ù… ÙˆØºÙŠØ±Ù‡Ù…Ø§.</div>
      </div>
      <div class="feat-card">
        <div class="feat-icon"><svg viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></div>
        <div class="feat-name">Ø§Ù„ÙÙ‚Ù‡ ÙˆØ§Ù„ÙØªØ§ÙˆÙ‰</div>
        <div class="feat-desc">Ø¥Ø¬Ø§Ø¨Ø§Øª ÙÙ‚Ù‡ÙŠØ© ÙˆØ§Ø¶Ø­Ø© Ù…Ø¹ ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ù…Ø°Ù‡Ø¨ ÙˆØ£Ø¯Ù„ØªÙ‡ØŒ Ø´Ø§Ù…Ù„Ø© Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø¹Ø© ÙˆØ¢Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù„Ù…Ø§Ø¡ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ÙŠÙ†.</div>
      </div>
      <div class="feat-card">
        <div class="feat-icon"><svg viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg></div>
        <div class="feat-name">Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ù†Ø¨ÙˆÙŠØ©</div>
        <div class="feat-desc">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ÙˆØ«Ù‚Ø© Ø¹Ù† Ø³ÙŠØ±Ø© Ø§Ù„Ù†Ø¨ÙŠ ï·º ÙˆØ³ÙŠØ±Ø© Ø§Ù„ØµØ­Ø§Ø¨Ø© Ø§Ù„ÙƒØ±Ø§Ù… ÙˆØ£Ø­Ø¯Ø§Ø« ØµØ¯Ø± Ø§Ù„Ø¥Ø³Ù„Ø§Ù….</div>
      </div>
      <div class="feat-card">
        <div class="feat-icon"><svg viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></div>
        <div class="feat-name">Ø§Ù„Ø£Ø°ÙƒØ§Ø± ÙˆØ§Ù„Ø£Ø¯Ø¹ÙŠØ©</div>
        <div class="feat-desc">Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­ ÙˆØ§Ù„Ù…Ø³Ø§Ø¡ØŒ Ø£Ø¯Ø¹ÙŠØ© Ø§Ù„Ø£Ø­ÙˆØ§Ù„ Ø§Ù„Ù…Ø®ØªÙ„ÙØ©ØŒ Ø³Ù†Ù† Ø§Ù„Ø±Ø³ÙˆÙ„ ï·º Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ù…Ø¹ Ø§Ù„Ø¯Ù„ÙŠÙ„ ÙˆØ§Ù„Ù…ØµØ¯Ø±.</div>
      </div>
      <div class="feat-card">
        <div class="feat-icon"><svg viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></div>
        <div class="feat-name">Ø­Ù…Ø§ÙŠØ© ÙˆØ®ØµÙˆØµÙŠØ©</div>
        <div class="feat-desc">ØªØ´ÙÙŠØ± ÙƒØ§Ù…Ù„ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù† Ø¹Ø¨Ø± FirebaseØŒ ÙˆØ¶Ù…Ø§Ù† Ø³Ø±ÙŠØ© Ù…Ø­Ø§Ø¯Ø«Ø§ØªÙƒ Ø§Ù„ØªØ§Ù…Ø©.</div>
      </div>
      <div class="feat-card">
        <div class="feat-icon"><svg viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div>
        <div class="feat-name">Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù†</div>
        <div class="feat-desc">Ø¨Ø­Ø« Ù…ØªÙ‚Ø¯Ù… ÙÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… Ø¨Ø§Ù„ÙƒÙ„Ù…Ø© Ø£Ùˆ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ© Ù…Ø¹ Ø§Ù„ØªØ±Ø¬Ù…Ø© ÙˆØ§Ù„ØªÙØ³ÙŠØ± Ø§Ù„ÙÙˆØ±ÙŠ.</div>
      </div>
      <div class="feat-card">
        <div class="feat-icon"><svg viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="2"><circle cx="5" cy="12" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="19" cy="12" r="2"/></svg></div>
        <div class="feat-name">ğŸ“¿ Ø§Ù„Ø³Ø¨Ø­Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</div>
        <div class="feat-desc">Ø³Ø¨Ø­Ø© Ø±Ù‚Ù…ÙŠØ© Ù„Ø­ÙØ¸ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø°ÙƒØ§Ø± ÙˆØ§Ù„ØªØ³Ø¨ÙŠØ­Ø§Øª Ù…Ø¹ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø°ÙƒØ± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ø¯.</div>
      </div>
      <div class="feat-card">
        <div class="feat-icon"><svg viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></div>
        <div class="feat-name">Ø³Ø±Ø¹Ø© ÙˆØ¯Ù‚Ø©</div>
        <div class="feat-desc">Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙÙˆØ±ÙŠØ© Ø¨Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¯Ù‚ÙŠÙ‚Ø© ÙˆÙ…ÙˆØ«Ù‚Ø©ØŒ Ù…Ø¹ Ø°ÙƒØ± Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ù…ØµØ¯Ø§Ù‚ÙŠØ©.</div>
      </div>
    </div>
  </section>

  <div class="divider"><span style="color:var(--gold);font-size:18px;">â—†</span></div>

  <section id="pricing-anchor" class="pricing-section">
    <div class="section-eyebrow">â€” Ø®Ø·Ø· Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ â€”</div>
    <h2 class="section-title">Ø§Ø®ØªØ± Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©</h2>
    <div class="pricing-grid">
      <div class="plan-card">
        <div class="plan-name">Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ</div>
        <div class="plan-price free-p">Ù </div>
        <div class="plan-period">Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ù…Ø¬Ø§Ù†ÙŠ</div>
        <ul class="plan-feats">
          <li><svg viewBox="0 0 24 24" class="check-svg"><path d="M20 6L9 17l-5-5"/></svg>Ù¢Ù  Ù…Ø­Ø§Ø¯Ø«Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§</li>
          <li><svg viewBox="0 0 24 24" class="check-svg"><path d="M20 6L9 17l-5-5"/></svg>ØªÙØ³ÙŠØ± Ø§Ù„Ù‚Ø±Ø¢Ù† ÙˆØ§Ù„Ø£Ø­Ø§Ø¯ÙŠØ«</li>
          <li><svg viewBox="0 0 24 24" class="check-svg"><path d="M20 6L9 17l-5-5"/></svg>Ø§Ù„Ø£Ø°ÙƒØ§Ø± ÙˆØ§Ù„Ø£Ø¯Ø¹ÙŠØ©</li>
          <li><svg viewBox="0 0 24 24" class="check-svg"><path d="M20 6L9 17l-5-5"/></svg>Ø§Ù„Ø³Ø¨Ø­Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</li>
          <li><svg viewBox="0 0 24 24" class="x-svg" fill="none" stroke="var(--text3)" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</li>
          <li><svg viewBox="0 0 24 24" class="x-svg" fill="none" stroke="var(--text3)" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</li>
        </ul>
        <button class="btn btn-ghost" style="width:100%;padding:11px;justify-content:center;" onclick="goApp()">Ø§Ø¨Ø¯Ø£ Ù…Ø¬Ø§Ù†Ù‹Ø§</button>
      </div>
      <div class="plan-card pro">
        <div class="plan-best">Ø§Ù„Ø£ÙƒØ«Ø± Ø´ÙŠÙˆØ¹Ù‹Ø§</div>
        <div class="plan-name">Ø§Ù„Ù…Ø­ØªØ±Ù</div>
        <div class="plan-price">Ù¤Ù©</div>
        <div class="plan-period">Ø±ÙŠØ§Ù„ / Ø´Ù‡Ø±ÙŠÙ‹Ø§</div>
        <ul class="plan-feats">
          <li><svg viewBox="0 0 24 24" class="check-svg"><path d="M20 6L9 17l-5-5"/></svg>Ù…Ø­Ø§Ø¯Ø«Ø§Øª ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©</li>
          <li><svg viewBox="0 0 24 24" class="check-svg"><path d="M20 6L9 17l-5-5"/></svg>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</li>
          <li><svg viewBox="0 0 24 24" class="check-svg"><path d="M20 6L9 17l-5-5"/></svg>Ø­ÙØ¸ ÙˆØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</li>
          <li><svg viewBox="0 0 24 24" class="check-svg"><path d="M20 6L9 17l-5-5"/></svg>Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±Ø¯ÙˆØ¯ ÙƒØ±ÙˆØ§Ø¨Ø·</li>
          <li><svg viewBox="0 0 24 24" class="check-svg"><path d="M20 6L9 17l-5-5"/></svg>Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© + Ø¯Ø¹Ù…</li>
        </ul>
        <button class="btn btn-gold" style="width:100%;padding:11px;justify-content:center;" onclick="openModal('register')">Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù† â€º</button>
      </div>
    </div>
  </section>

  <footer style="border-top:1px solid var(--border);padding:52px 32px 32px;">
    <div style="display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:48px;max-width:1200px;margin:0 auto 48px;" class="footer-grid">
      <div>
        <span style="font-family:'Amiri',serif;font-size:28px;color:var(--gold);display:block;margin-bottom:12px;">Ù†ÙˆØ± AI</span>
        <p style="font-size:13px;color:var(--text2);line-height:1.9;max-width:250px;">Ù…Ù†ØµØ© Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¥Ø³Ù„Ø§Ù…ÙŠØ© Ù…ØªØ®ØµØµØ©ØŒ ØªÙ‚Ø¯Ù… Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…ÙˆØ«ÙˆÙ‚Ø© ÙˆØ¯Ù‚ÙŠÙ‚Ø©ØŒ Ù…Ø¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø£Ø¹Ù„Ù‰ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„Ø®ØµÙˆØµÙŠØ©.</p>
      </div>
      <div>
        <h4 style="font-size:12px;font-weight:600;color:var(--text);margin-bottom:14px;">Ø§Ù„Ù…Ù†ØµØ©</h4>
        <ul style="list-style:none;display:flex;flex-direction:column;gap:9px;">
          <li><a onclick="goApp()" style="font-size:13px;color:var(--text3);text-decoration:none;cursor:pointer;" onmouseover="this.style.color='var(--gold)'" onmouseout="this.style.color='var(--text3)'">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</a></li>
          <li><a href="#features-anchor" style="font-size:13px;color:var(--text3);text-decoration:none;" onmouseover="this.style.color='var(--gold)'" onmouseout="this.style.color='var(--text3)'">Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª</a></li>
          <li><a href="#pricing-anchor" style="font-size:13px;color:var(--text3);text-decoration:none;" onmouseover="this.style.color='var(--gold)'" onmouseout="this.style.color='var(--text3)'">Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</a></li>
        </ul>
      </div>
      <div>
        <h4 style="font-size:12px;font-weight:600;color:var(--text);margin-bottom:14px;">Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</h4>
        <ul style="list-style:none;display:flex;flex-direction:column;gap:9px;">
          <li><a style="font-size:13px;color:var(--text3);cursor:pointer;" onmouseover="this.style.color='var(--gold)'" onmouseout="this.style.color='var(--text3)'">ØªÙØ³ÙŠØ± Ø§Ù„Ù‚Ø±Ø¢Ù†</a></li>
          <li><a style="font-size:13px;color:var(--text3);cursor:pointer;" onmouseover="this.style.color='var(--gold)'" onmouseout="this.style.color='var(--text3)'">Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ«</a></li>
          <li><a style="font-size:13px;color:var(--text3);cursor:pointer;" onmouseover="this.style.color='var(--gold)'" onmouseout="this.style.color='var(--text3)'">Ø§Ù„ÙÙ‚Ù‡ ÙˆØ§Ù„ÙØªØ§ÙˆÙ‰</a></li>
          <li><a style="font-size:13px;color:var(--text3);cursor:pointer;" onmouseover="this.style.color='var(--gold)'" onmouseout="this.style.color='var(--text3)'">Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ù†Ø¨ÙˆÙŠØ©</a></li>
        </ul>
      </div>
      <div>
        <h4 style="font-size:12px;font-weight:600;color:var(--text);margin-bottom:14px;">Ù‚Ø§Ù†ÙˆÙ†ÙŠ</h4>
        <ul style="list-style:none;display:flex;flex-direction:column;gap:9px;">
          <li><a style="font-size:13px;color:var(--text3);cursor:pointer;" onmouseover="this.style.color='var(--gold)'" onmouseout="this.style.color='var(--text3)'">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a></li>
          <li><a style="font-size:13px;color:var(--text3);cursor:pointer;" onmouseover="this.style.color='var(--gold)'" onmouseout="this.style.color='var(--text3)'">Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</a></li>
          <li><a style="font-size:13px;color:var(--text3);cursor:pointer;" onmouseover="this.style.color='var(--gold)'" onmouseout="this.style.color='var(--text3)'">Ø§ØªØµÙ„ Ø¨Ù†Ø§</a></li>
        </ul>
      </div>
    </div>
    <div style="display:flex;align-items:center;justify-content:space-between;padding-top:28px;border-top:1px solid var(--border);font-size:12px;color:var(--text3);max-width:1200px;margin:0 auto;">
      <span>Â© Ù¢Ù Ù¢Ù¥ Ù†ÙˆØ± AI â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</span>
      <div style="display:flex;gap:14px;">
        <span style="cursor:pointer;color:var(--gold);">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
        <span style="cursor:pointer;" onmouseover="this.style.color='var(--text2)'" onmouseout="this.style.color=''">English</span>
        <span style="cursor:pointer;" onmouseover="this.style.color='var(--text2)'" onmouseout="this.style.color=''">FranÃ§ais</span>
      </div>
    </div>
  </footer>
</div>

<!-- ============================================================ -->
<!--  APP PAGE                                                    -->
<!-- ============================================================ -->
<div id="appPage" class="page">
  <div class="sidebar" id="sb">
    <div class="sidebar-top">
      <button class="new-btn" onclick="newChat()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©
      </button>
      <!-- SEARCH -->
      <div class="sb-search">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <input type="text" id="sbSearchInp" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª..." oninput="filterConvs(this.value)">
      </div>
    </div>

    <!-- PRAYER WIDGET -->
    <div class="prayer-widget" id="prayerWidget">
      <div class="pw-title">ğŸ•Œ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© (ØªÙ‚Ø±ÙŠØ¨ÙŠ)</div>
      <div class="pw-grid" id="prayerGrid"></div>
    </div>

    <!-- QUICK TOOLS -->
    <div style="padding:4px 8px;display:flex;gap:5px;flex-wrap:wrap;">
      <button onclick="openTasbih()" style="flex:1;padding:6px;border-radius:7px;background:var(--bg3);border:1px solid var(--border);color:var(--text3);font-size:11px;cursor:pointer;font-family:'Noto Naskh Arabic',serif;transition:all .15s;" onmouseover="this.style.color='var(--gold)'" onmouseout="this.style.color='var(--text3)'">ğŸ“¿ Ø§Ù„Ø³Ø¨Ø­Ø©</button>
      <button onclick="goLanding()" style="flex:1;padding:6px;border-radius:7px;background:var(--bg3);border:1px solid var(--border);color:var(--text3);font-size:11px;cursor:pointer;font-family:'Noto Naskh Arabic',serif;transition:all .15s;" onmouseover="this.style.color='var(--gold)'" onmouseout="this.style.color='var(--text3)'">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </div>

    <div class="sidebar-list" id="sbList"></div>
    <div class="sidebar-foot">
      <div class="user-row" id="uRow" onclick="openModal('login')">
        <div class="u-av empty" id="uAv">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="var(--text3)" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        </div>
        <div class="u-info" id="uInfo">
          <div class="u-name" id="uName">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
          <div class="u-plan" id="uPlan">Ø§Ø¨Ø¯Ø£ Ù…Ø¬Ø§Ù†Ù‹Ø§</div>
        </div>
      </div>
    </div>
  </div>

  <div class="chat-main">
    <div class="app-topbar">
      <button class="icon-btn" onclick="toggleSB()">
        <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
      </button>
      <span style="font-family:'Amiri',serif;font-size:19px;color:var(--gold);">Ù†ÙˆØ± AI</span>
      <button class="icon-btn" onclick="newChat()">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      </button>
    </div>

    <div class="chat-msgs" id="chatMsgs"></div>

    <div class="input-zone">
      <!-- MODE BAR -->
      <div class="mode-bar">
        <button class="mode-btn on" id="modeGeneral" onclick="setMode('general',this)">
          <svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
          Ø¹Ø§Ù…
        </button>
        <button class="mode-btn" id="modeQuran" onclick="setMode('quran',this)">
          <svg viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" fill="none" stroke="currentColor" stroke-width="2"/></svg>
          ØªÙØ³ÙŠØ± Ø§Ù„Ù‚Ø±Ø¢Ù†
        </button>
        <button class="mode-btn" id="modeHadith" onclick="setMode('hadith',this)">
          <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10"/></svg>
          Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ«
        </button>
        <button class="mode-btn" id="modeFiqh" onclick="setMode('fiqh',this)">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          Ø§Ù„ÙÙ‚Ù‡ ÙˆØ§Ù„ÙØªØ§ÙˆÙ‰
        </button>
        <div class="export-wrap" style="margin-right:auto;">
          <button class="mode-btn" onclick="toggleExport()" id="exportBtn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            ØªØµØ¯ÙŠØ±
          </button>
          <div class="export-menu" id="exportMenu">
            <div class="export-item" onclick="exportChat('text')">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="13" height="13"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/></svg>
              Ù†Øµ Ø¹Ø§Ø¯ÙŠ .txt
            </div>
            <div class="export-item" onclick="exportChat('html')">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="13" height="13"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
              ØµÙØ­Ø© HTML
            </div>
            <div class="export-item" onclick="copyAllChat()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="13" height="13"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
              Ù†Ø³Ø® Ø§Ù„ÙƒÙ„
            </div>
          </div>
        </div>
      </div>

      <div class="input-box">
        <textarea class="chat-ta" id="ta" rows="1"
          placeholder="Ø§Ø³Ø£Ù„Ù†ÙŠ Ø¹Ù† Ø§Ù„Ù‚Ø±Ø¢Ù†ØŒ Ø§Ù„Ø­Ø¯ÙŠØ«ØŒ Ø§Ù„ÙÙ‚Ù‡..."
          onkeydown="onKey(event)" oninput="grow(this)"></textarea>
        <div class="inp-row">
          <button class="inp-btn" onclick="startVoice()" title="ØµÙˆØª" id="micBtn">
            <svg viewBox="0 0 24 24"><rect x="9" y="2" width="6" height="12" rx="3"/><path d="M5 10a7 7 0 0 0 14 0"/><line x1="12" y1="19" x2="12" y2="22"/><line x1="8" y1="22" x2="16" y2="22"/></svg>
          </button>
          <button class="inp-btn inp-send" id="sendBtn" onclick="send()">
            <svg viewBox="0 0 24 24"><path d="M22 2L11 13M22 2L15 22 11 13 2 9l20-7z"/></svg>
          </button>
        </div>
      </div>
      <div class="char-info">
        <span class="char-cnt" id="charCnt">Ù  / Ù¢Ù Ù Ù </span>
        <span class="footer-note">Ù†ÙˆØ± AI Ù‚Ø¯ ÙŠØ±ØªÙƒØ¨ Ø£Ø®Ø·Ø§Ø¡Ù‹ â€” ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø´Ø±Ø¹ÙŠØ© Ù„Ù„Ù…Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©</span>
      </div>
    </div>
  </div>
</div>

<!-- ============================================================ -->
<!--  AUTH MODAL                                                  -->
<!-- ============================================================ -->
<div class="overlay" id="authOv">
  <div class="modal">
    <button class="mx" onclick="closeModal()">Ã—</button>
    <div class="modal-logo"><svg viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></div>
    <div class="modal-title">Ø£Ù‡Ù„Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù†ÙˆØ± AI</div>
    <div class="modal-sub" id="mSub">Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª</div>
    <div class="tabs">
      <button class="tab on" id="tL" onclick="swTab('l')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      <button class="tab" id="tR" onclick="swTab('r')">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
    </div>
    <div class="alert-box" id="aBox"></div>
    <button class="oauth-btn" onclick="googleLogin()">
      <svg width="18" height="18" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
      Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ Google
    </button>
    <div class="sep"><span>Ø£Ùˆ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</span></div>
    <div id="fL">
      <input class="field" type="email" id="lE" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" autocomplete="email">
      <input class="field" type="password" id="lP" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" autocomplete="current-password" onkeydown="if(event.key==='Enter')doLogin()">
      <button class="submit" id="bL" onclick="doLogin()">Ø¯Ø®ÙˆÙ„</button>
      <div style="text-align:center;margin-top:9px;"><a style="font-size:12px;color:var(--text3);cursor:pointer;" onclick="doForgot()">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</a></div>
    </div>
    <div id="fR" style="display:none;">
      <input class="field" type="text" id="rN" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
      <input class="field" type="email" id="rE" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" autocomplete="email">
      <input class="field" type="password" id="rP" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Ù¨ Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)" autocomplete="new-password" onkeydown="if(event.key==='Enter')doReg()">
      <button class="submit" id="bR" onclick="doReg()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
    </div>
    <div class="modal-foot" id="mFoot">
      Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a onclick="swTab('r')">Ø³Ø¬Ù‘Ù„ Ù…Ø¬Ø§Ù†Ù‹Ø§</a>
    </div>
  </div>
</div>

<script>
// ==============================
//  FIREBASE
// ==============================
const FC = {
  apiKey:"AIzaSyBWmPhxpq0Q7G7CRUaAfGBa18zs556wgD0",
  authDomain:"noor-94b0d.firebaseapp.com",
  projectId:"noor-94b0d",
  storageBucket:"noor-94b0d.firebasestorage.app",
  messagingSenderId:"440882728031",
  appId:"1:440882728031:web:00fc10ad029bec27a01fea",
  measurementId:"G-N6Q29Y4Y3E"
};
let fbReady=false, auth=null, curUser=null;
try {
  firebase.initializeApp(FC);
  auth = firebase.auth();
  try { firebase.analytics(); } catch(e){}
  fbReady = true;
  auth.onAuthStateChanged(u => {
    if(u) onLogin({uid:u.uid, name:u.displayName||u.email.split('@')[0], email:u.email, photo:u.photoURL});
    else { const s=ls('noor_s'); if(s) onLogin(s); else renderOut(); }
  });
} catch(e) {
  const s=ls('noor_s'); if(s) onLogin(s); else renderOut();
}

// ==============================
//  HELPERS
// ==============================
function ls(k){ try{return JSON.parse(localStorage.getItem(k)||'null');}catch{return null;} }
function lss(k,v){ localStorage.setItem(k,JSON.stringify(v)); }
function lsr(k){ localStorage.removeItem(k); }

function showToast(msg, type='ok'){
  const t=document.getElementById('toast');
  document.getElementById('toastMsg').textContent=msg;
  t.className='toast show '+(type==='ok'?'ok':'');
  clearTimeout(t._t);
  t._t=setTimeout(()=>t.classList.remove('show'),2800);
}

// ==============================
//  PAGES
// ==============================
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>{
    p.classList.remove('active');
    if(p.id==='appPage') p.style.display='none';
    else p.style.display='none';
  });
  const el = document.getElementById(id);
  if(id==='appPage'){
    el.style.display='flex';
    el.classList.add('active');
    initPrayerWidget();
  } else {
    el.style.display='block';
    el.classList.add('active');
  }
}

window.addEventListener('load', () => {
  showPage('landingPage');
  showWelcomeSc();
  loadConvsFromStorage();
});

function goApp(){
  showPage('appPage');
  showWelcomeSc();
  if(window.innerWidth<=720) closeSB();
}

function goLanding(){
  showPage('landingPage');
}

// ==============================
//  SIDEBAR
// ==============================
function toggleSB(){
  document.getElementById('sb').classList.toggle('mob-open');
  document.getElementById('mobOv').classList.toggle('show');
}
function closeSB(){
  document.getElementById('sb').classList.remove('mob-open');
  document.getElementById('mobOv').classList.remove('show');
}

// ==============================
//  PRAYER TIMES (approx)
// ==============================
function initPrayerWidget(){
  const now = new Date();
  const h = now.getHours();
  const prayers = [
    {name:'Ø§Ù„ÙØ¬Ø±', hour:5, min:0},
    {name:'Ø§Ù„Ø¸Ù‡Ø±', hour:12, min:30},
    {name:'Ø§Ù„Ø¹ØµØ±', hour:15, min:45},
    {name:'Ø§Ù„Ù…ØºØ±Ø¨', hour:18, min:15},
    {name:'Ø§Ù„Ø¹Ø´Ø§Ø¡', hour:20, min:0}
  ];
  const curMin = h*60+now.getMinutes();
  let nextIdx = prayers.findIndex(p=> p.hour*60+p.min > curMin);
  if(nextIdx<0) nextIdx=0;
  const grid = document.getElementById('prayerGrid');
  grid.innerHTML = prayers.map((p,i)=>{
    const t = String(p.hour).padStart(2,'0')+':'+String(p.min).padStart(2,'0');
    return `<div class="pw-item${i===nextIdx?' next':''}">${p.name}<span>${t}</span></div>`;
  }).join('');
  document.getElementById('prayerWidget').classList.add('show');
}

// ==============================
//  AUTH
// ==============================
function openModal(tab){
  document.getElementById('authOv').classList.add('show');
  swTab(tab==='register'?'r':'l');
  clrAlert();
}
function closeModal(){ document.getElementById('authOv').classList.remove('show'); }
document.getElementById('authOv').addEventListener('click',function(e){ if(e.target===this) closeModal(); });

function swTab(t){
  const isL=t==='l';
  document.getElementById('fL').style.display=isL?'block':'none';
  document.getElementById('fR').style.display=isL?'none':'block';
  document.getElementById('tL').className='tab'+(isL?' on':'');
  document.getElementById('tR').className='tab'+(!isL?' on':'');
  document.getElementById('mSub').textContent=isL
    ?'Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª'
    :'Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ Ø§Ù„Ø¢Ù†';
  document.getElementById('mFoot').innerHTML=isL
    ?'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a onclick="swTab(\'r\')">Ø³Ø¬Ù‘Ù„ Ù…Ø¬Ø§Ù†Ù‹Ø§</a>'
    :'Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a onclick="swTab(\'l\')">Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>';
  clrAlert();
}

function showAlert(m,t){ const b=document.getElementById('aBox'); b.textContent=m; b.className='alert-box '+t; b.style.display='block'; }
function clrAlert(){ document.getElementById('aBox').style.display='none'; }

function fbErr(c){
  const m={
    'auth/user-not-found':'Ø§Ù„Ø¨Ø±ÙŠØ¯ ØºÙŠØ± Ù…Ø³Ø¬Ù„',
    'auth/wrong-password':'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©',
    'auth/email-already-in-use':'Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ù‹Ø§',
    'auth/weak-password':'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ù‹Ø§',
    'auth/invalid-email':'Ø¨Ø±ÙŠØ¯ ØºÙŠØ± ØµØ§Ù„Ø­',
    'auth/popup-closed-by-user':'ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„',
    'auth/network-request-failed':'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„',
    'auth/invalid-credential':'Ø¨ÙŠØ§Ù†Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©'
  };
  return m[c]||('Ø®Ø·Ø£: '+c);
}

function getUsers(){ return ls('noor_u')||{}; }

async function doLogin(){
  const e=document.getElementById('lE').value.trim(), p=document.getElementById('lP').value;
  if(!e||!p) return showAlert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„','err');
  const btn=document.getElementById('bL'); btn.disabled=true; btn.textContent='...';
  if(fbReady&&auth){
    try{ await auth.signInWithEmailAndPassword(e,p); closeModal(); showToast('Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ!'); }
    catch(er){ showAlert(fbErr(er.code),'err'); }
  } else {
    const us=getUsers();
    if(!us[e]){ showAlert('Ø§Ù„Ø¨Ø±ÙŠØ¯ ØºÙŠØ± Ù…Ø³Ø¬Ù„','err'); btn.disabled=false; btn.textContent='Ø¯Ø®ÙˆÙ„'; return; }
    if(us[e].p!==btoa(p)){ showAlert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©','err'); btn.disabled=false; btn.textContent='Ø¯Ø®ÙˆÙ„'; return; }
    lss('noor_s',us[e]); onLogin(us[e]); closeModal(); showToast('Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ!');
  }
  btn.disabled=false; btn.textContent='Ø¯Ø®ÙˆÙ„';
}

async function doReg(){
  const n=document.getElementById('rN').value.trim(), e=document.getElementById('rE').value.trim(), p=document.getElementById('rP').value;
  if(!n||!e||!p) return showAlert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„','err');
  if(p.length<8) return showAlert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù¨ Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„','err');
  if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)) return showAlert('Ø¨Ø±ÙŠØ¯ ØºÙŠØ± ØµØ§Ù„Ø­','err');
  const btn=document.getElementById('bR'); btn.disabled=true; btn.textContent='...';
  if(fbReady&&auth){
    try{
      const cr=await auth.createUserWithEmailAndPassword(e,p);
      await cr.user.updateProfile({displayName:n});
      closeModal(); showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!');
    } catch(er){ showAlert(fbErr(er.code),'err'); }
  } else {
    const us=getUsers();
    if(us[e]){ showAlert('Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ù‹Ø§','err'); btn.disabled=false; btn.textContent='Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨'; return; }
    const u={name:n,email:e,p:btoa(p),plan:'free',ts:Date.now()};
    us[e]=u; lss('noor_u',us); lss('noor_s',u); onLogin(u); closeModal(); showToast('Ø£Ù‡Ù„Ù‹Ø§ Ø¨Ùƒ '+n+'!');
  }
  btn.disabled=false; btn.textContent='Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨';
}

async function googleLogin(){
  if(fbReady&&auth){
    try{
      const pv=new firebase.auth.GoogleAuthProvider();
      await auth.signInWithPopup(pv);
      closeModal(); showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
    } catch(er){ showAlert(fbErr(er.code),'err'); }
  } else {
    const n=prompt('Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ:'); if(!n) return;
    const u={name:n,email:'g_'+Date.now()+'@google.com',plan:'free'};
    lss('noor_s',u); onLogin(u); closeModal(); showToast('Ø£Ù‡Ù„Ù‹Ø§ Ø¨Ùƒ '+n+'!');
  }
}

async function doForgot(){
  const e=document.getElementById('lE').value.trim();
  if(!e) return showAlert('Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø£ÙˆÙ„Ø§Ù‹','err');
  if(fbReady&&auth){
    try{ await auth.sendPasswordResetEmail(e); showAlert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†','ok'); }
    catch(er){ showAlert(fbErr(er.code),'err'); }
  } else { showAlert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† (ØªØ¬Ø±ÙŠØ¨ÙŠ)','ok'); }
}

function onLogin(u){ curUser=u; lss('noor_s',u); renderIn(u); updSB(); }

function renderIn(u){
  const init=(u.name||'U').charAt(0).toUpperCase();
  const av=document.getElementById('uAv');
  av.className='u-av'; av.textContent=init;
  document.getElementById('uName').textContent=u.name||u.email||'';
  document.getElementById('uPlan').textContent='Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©';
  const row=document.getElementById('uRow');
  row.onclick=null;
  // Remove old logout btn
  const old=row.querySelector('.logout-btn');
  if(old) old.remove();
  const logBtn=document.createElement('button');
  logBtn.className='logout-btn';
  logBtn.style.cssText='background:transparent;border:none;color:var(--text3);cursor:pointer;padding:4px;border-radius:5px;display:flex;align-items:center;';
  logBtn.innerHTML='<svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>';
  logBtn.onclick=(e)=>{e.stopPropagation();doLogout();};
  logBtn.onmouseover=()=>logBtn.style.color='var(--red)';
  logBtn.onmouseout=()=>logBtn.style.color='var(--text3)';
  row.appendChild(logBtn);
}

function renderOut(){
  const av=document.getElementById('uAv');
  av.className='u-av empty';
  av.innerHTML='<svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="var(--text3)" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>';
  document.getElementById('uName').textContent='ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
  document.getElementById('uPlan').textContent='Ø§Ø¨Ø¯Ø£ Ù…Ø¬Ø§Ù†Ù‹Ø§';
  const row=document.getElementById('uRow');
  const logBtn=row.querySelector('.logout-btn');
  if(logBtn) logBtn.remove();
  row.onclick=()=>openModal('login');
}

async function doLogout(){
  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) return;
  if(fbReady&&auth) await auth.signOut().catch(()=>{});
  lsr('noor_s'); curUser=null;
  renderOut(); showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬');
}

// ==============================
//  DEMO CHAT
// ==============================
const demoReplies = {
  'Ø£Ø±ÙƒØ§Ù† Ø§Ù„Ø¥Ø³Ù„Ø§Ù…': 'Ø£Ø±ÙƒØ§Ù† Ø§Ù„Ø¥Ø³Ù„Ø§Ù… Ø®Ù…Ø³Ø© Ø«Ø§Ø¨ØªØ© Ø¨Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„ØµØ­ÙŠØ­:<br><br><div class="quran-box" style="font-size:15px;">Â«Ø¨ÙÙ†ÙÙŠÙ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…Ù Ø¹Ù„Ù‰ Ø®Ù…Ø³ÙÂ»<div class="quran-ref">Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡ â€” ØµØ­ÙŠØ­ Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ ÙˆÙ…Ø³Ù„Ù…</div></div>1. Ø´Ù‡Ø§Ø¯Ø© Ø£Ù† Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡ ÙˆØ£Ù† Ù…Ø­Ù…Ø¯Ù‹Ø§ Ø±Ø³ÙˆÙ„ Ø§Ù„Ù„Ù‡<br>2. Ø¥Ù‚Ø§Ù… Ø§Ù„ØµÙ„Ø§Ø©<br>3. Ø¥ÙŠØªØ§Ø¡ Ø§Ù„Ø²ÙƒØ§Ø©<br>4. ØµÙˆÙ… Ø±Ù…Ø¶Ø§Ù†<br>5. Ø­Ø¬ Ø§Ù„Ø¨ÙŠØª Ù„Ù…Ù† Ø§Ø³ØªØ·Ø§Ø¹ Ø¥Ù„ÙŠÙ‡ Ø³Ø¨ÙŠÙ„Ù‹Ø§<div class="src-row"><span class="src-tag">ØµØ­ÙŠØ­ Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ</span><span class="src-tag">ØµØ­ÙŠØ­ Ù…Ø³Ù„Ù…</span><span class="src-tag">âœ” Ù…ÙˆØ«Ù‚</span></div>',
  'Ø­ÙƒÙ… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† Ø¨Ø¯ÙˆÙ† ÙˆØ¶ÙˆØ¡': 'Ø§Ø®ØªÙ„Ù Ø§Ù„Ø¹Ù„Ù…Ø§Ø¡ Ø¹Ù„Ù‰ Ù‚ÙˆÙ„ÙŠÙ† Ø±Ø¦ÙŠØ³ÙŠÙŠÙ†:<br><br><strong>Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± (Ø§Ù„Ø´Ø§ÙØ¹ÙŠØ© ÙˆØ§Ù„Ù…Ø§Ù„ÙƒÙŠØ© ÙˆØ§Ù„Ø­Ù†Ø§Ø¨Ù„Ø©):</strong> ÙŠØ­Ø±Ù… Ù…Ø³ Ø§Ù„Ù…ØµØ­Ù Ø¨Ø¯ÙˆÙ† ÙˆØ¶ÙˆØ¡ØŒ Ù„Ù‚ÙˆÙ„Ù‡ ØªØ¹Ø§Ù„Ù‰:<br><div class="quran-box" style="font-size:15px;">âƒÙ„ÙØ§ ÙŠÙÙ…ÙØ³ÙÙ‘Ù‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø§Ù„Ù’Ù…ÙØ·ÙÙ‡ÙÙ‘Ø±ÙÙˆÙ†Ùâƒ<div class="quran-ref">Ø³ÙˆØ±Ø© Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©: Ø¢ÙŠØ© 79</div></div><strong>Ø£Ù…Ø§ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù…Ù† Ø­ÙØ¸ Ø¨Ø¯ÙˆÙ† Ù…Ø³ Ù„Ù„Ù…ØµØ­Ù:</strong> Ø¬Ø§Ø¦Ø² Ù„Ù„Ù…Ø­Ø¯Ø« Ø­Ø¯Ø«Ù‹Ø§ Ø£ØµØºØ± Ø¹Ù†Ø¯ Ø¬Ù…Ù‡ÙˆØ± Ø§Ù„Ø¹Ù„Ù…Ø§Ø¡.<div class="src-row"><span class="src-tag">ØªÙØ³ÙŠØ± Ø§Ù„Ù‚Ø±Ø·Ø¨ÙŠ</span><span class="src-tag">Ø§Ù„Ù…ØºÙ†ÙŠ</span><span class="src-tag">âœ” Ù…ÙˆØ«Ù‚</span></div>',
  'Ù…ØªÙ‰ ØªØ¬Ø¨ Ø§Ù„Ø²ÙƒØ§Ø©ØŸ': 'ØªØ¬Ø¨ Ø§Ù„Ø²ÙƒØ§Ø© Ø¨Ø®Ù…Ø³Ø© Ø´Ø±ÙˆØ·:<br><br>1. Ø§Ù„Ø¥Ø³Ù„Ø§Ù…<br>2. Ø§Ù„Ø­Ø±ÙŠØ©<br>3. Ù…Ù„Ùƒ Ø§Ù„Ù†ØµØ§Ø¨ â€” ÙˆÙ‡Ùˆ 85 Ø¬Ø±Ø§Ù…Ù‹Ø§ Ù…Ù† Ø§Ù„Ø°Ù‡Ø¨ Ø£Ùˆ Ù…Ø§ ÙŠØ¹Ø§Ø¯Ù„Ù‡ Ù…Ù† Ø§Ù„Ù…Ø§Ù„<br>4. Ø­ÙˆÙ„Ø§Ù† Ø§Ù„Ø­ÙˆÙ„ â€” Ù…Ø±ÙˆØ± Ø³Ù†Ø© Ù‡Ø¬Ø±ÙŠØ© ÙƒØ§Ù…Ù„Ø©<br>5. Ø§Ù„Ù†Ù…Ø§Ø¡ â€” Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ø§Ù„ Ù†Ø§Ù…ÙŠÙ‹Ø§<br><br><strong>Ù…Ù‚Ø¯Ø§Ø± Ø§Ù„Ø²ÙƒØ§Ø©: 2.5%</strong> Ù…Ù† Ø§Ù„Ù…Ø§Ù„ Ø§Ù„Ø²ÙƒÙˆÙŠ Ø¨Ø¹Ø¯ Ø­ÙˆÙ„Ø§Ù† Ø§Ù„Ø­ÙˆÙ„.<div class="src-row"><span class="src-tag">Ø§Ù„ÙÙ‚Ù‡ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠ</span><span class="src-tag">Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø¹Ø©</span><span class="src-tag">âœ” Ù…ÙˆØ«Ù‚</span></div>',
  'ÙØ¶Ù„ Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ù': 'Ù„Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ù ÙØ¶Ù„ Ø¹Ø¸ÙŠÙ… Ø®ØµÙˆØµÙ‹Ø§ ÙŠÙˆÙ… Ø§Ù„Ø¬Ù…Ø¹Ø©:<br><br><div class="quran-box" style="font-size:15px;">Â«Ù…Ù† Ù‚Ø±Ø£ Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ù ÙŠÙˆÙ… Ø§Ù„Ø¬Ù…Ø¹Ø© Ø£Ø¶Ø§Ø¡ Ù„Ù‡ Ù…Ù† Ø§Ù„Ù†ÙˆØ± Ù…Ø§ Ø¨ÙŠÙ† Ø§Ù„Ø¬Ù…Ø¹ØªÙŠÙ†Â»<div class="quran-ref">Ø±ÙˆØ§Ù‡ Ø§Ù„Ø­Ø§ÙƒÙ… â€” Ø­Ø¯ÙŠØ« ØµØ­ÙŠØ­</div></div>Ù…Ù† ÙØ¶Ø§Ø¦Ù„Ù‡Ø§ Ø£ÙŠØ¶Ù‹Ø§: Ø­ÙØ¸ Ù…Ù† ÙØªÙ†Ø© Ø§Ù„Ø¯Ø¬Ø§Ù„ØŒ Ù…Ù† Ù‚Ø±Ø£ Ø¹Ø´Ø± Ø¢ÙŠØ§Øª Ù…Ù† Ø£ÙˆÙ„Ù‡Ø§ Ø­ÙØ¸ Ù…Ù† Ø§Ù„Ø¯Ø¬Ø§Ù„.<div class="src-row"><span class="src-tag">Ø§Ù„Ø­Ø§ÙƒÙ…</span><span class="src-tag">Ø§Ù„Ø¨ÙŠÙ‡Ù‚ÙŠ</span><span class="src-tag">âœ” Ù…ÙˆØ«Ù‚</span></div>',
  'Ø¯Ø¹Ø§Ø¡ ÙƒÙØ§Ø±Ø© Ø§Ù„Ù…Ø¬Ù„Ø³': 'Ø¯Ø¹Ø§Ø¡ ÙƒÙØ§Ø±Ø© Ø§Ù„Ù…Ø¬Ù„Ø³ ÙˆØ±Ø¯ ÙÙŠ Ø­Ø¯ÙŠØ« ØµØ­ÙŠØ­:<br><br><div class="quran-box" style="font-size:15px;">Â«Ø³ÙØ¨Ø­Ø§Ù†ÙÙƒÙ Ø§Ù„Ù„Ù‘Ù‡Ù…Ù‘ ÙˆØ¨Ø­Ù…Ø¯ÙÙƒØŒ Ø£Ø´Ù‡Ø¯ Ø£Ù† Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø£Ù†ØªØŒ Ø£Ø³ØªØºÙØ±Ùƒ ÙˆØ£ØªÙˆØ¨ Ø¥Ù„ÙŠÙƒÂ»<div class="quran-ref">Ø±ÙˆØ§Ù‡ Ø§Ù„ØªØ±Ù…Ø°ÙŠ â€” Ø­Ø¯ÙŠØ« ØµØ­ÙŠØ­</div></div>ÙŠÙ‚Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù‚ÙŠØ§Ù… Ù…Ù† Ø§Ù„Ù…Ø¬Ù„Ø³ØŒ ÙŠØºÙØ± Ø§Ù„Ù„Ù‡ Ù„ØµØ§Ø­Ø¨Ù‡ Ù…Ø§ ÙØ±Ø· ÙÙŠ Ù…Ø¬Ù„Ø³Ù‡.<div class="src-row"><span class="src-tag">Ø§Ù„ØªØ±Ù…Ø°ÙŠ</span><span class="src-tag">Ø£Ø¨Ùˆ Ø¯Ø§ÙˆØ¯</span><span class="src-tag">âœ” Ù…ÙˆØ«Ù‚</span></div>'
};

function demoAsk(el){ document.getElementById('demoInp').value=el.textContent; demoSend(); }

function demoSend(){
  const inp=document.getElementById('demoInp');
  const txt=inp.value.trim(); if(!txt) return;
  inp.value='';
  const msgs=document.getElementById('demoMsgs');
  msgs.innerHTML+=`<div class="d-msg user"><div class="d-av">Ø£</div><div class="d-bubble">${esc(txt)}</div></div>`;
  const tid='dt'+Date.now();
  msgs.innerHTML+=`<div class="d-msg ai" id="${tid}"><div class="d-av"><svg viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></div><div class="d-bubble"><div class="typing-dots"><div class="tdot"></div><div class="tdot"></div><div class="tdot"></div></div></div></div>`;
  msgs.scrollTop=msgs.scrollHeight;
  setTimeout(()=>{
    const el=document.getElementById(tid);
    const rep=demoReplies[txt]||('Ø´ÙƒØ±Ù‹Ø§ Ø¹Ù„Ù‰ Ø³Ø¤Ø§Ù„Ùƒ Ø­ÙˆÙ„ <strong>'+esc(txt)+'</strong>.<br><br>Ù‡Ø°Ø§ Ù…Ø¬Ø±Ø¯ Ø¹Ø±Ø¶ ØªØ¬Ø±ÙŠØ¨ÙŠ. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ <u style="cursor:pointer;" onclick="goApp()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</u> Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø¨Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…ÙˆØ«Ù‚Ø©.');
    if(el) el.querySelector('.d-bubble').innerHTML=rep;
    msgs.scrollTop=msgs.scrollHeight;
  },1400);
}

// ==============================
//  APP CHAT
// ==============================
let convs=[], activeId=null, loading=false, chatHistory=[], currentMode='general';
let allConvs=[];

function loadConvsFromStorage(){
  const saved=ls('noor_convs');
  if(saved) { convs=saved; allConvs=[...convs]; }
  updSB();
}

function saveConvsToStorage(){
  lss('noor_convs', convs);
}

function setMode(m, btn){
  currentMode=m;
  document.querySelectorAll('.mode-btn').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
  const placeholders={
    general:'Ø§Ø³Ø£Ù„Ù†ÙŠ Ø¹Ù† Ø§Ù„Ù‚Ø±Ø¢Ù†ØŒ Ø§Ù„Ø­Ø¯ÙŠØ«ØŒ Ø§Ù„ÙÙ‚Ù‡...',
    quran:'Ø§Ø³Ø£Ù„Ù†ÙŠ Ø¹Ù† Ø¢ÙŠØ© Ø£Ùˆ Ø³ÙˆØ±Ø© Ø£Ùˆ Ù…ÙˆØ¶ÙˆØ¹ Ù‚Ø±Ø¢Ù†ÙŠ...',
    hadith:'Ø§Ø³Ø£Ù„Ù†ÙŠ Ø¹Ù† Ø­Ø¯ÙŠØ« Ø£Ùˆ Ø³Ù†Ø© Ù†Ø¨ÙˆÙŠØ©...',
    fiqh:'Ø§Ø³Ø£Ù„Ù†ÙŠ Ø¹Ù† Ù…Ø³Ø£Ù„Ø© ÙÙ‚Ù‡ÙŠØ© Ø£Ùˆ Ø­ÙƒÙ… Ø´Ø±Ø¹ÙŠ...'
  };
  document.getElementById('ta').placeholder=placeholders[m]||placeholders.general;
}

function filterConvs(q){
  if(!q.trim()){ convs=[...allConvs]; updSB(); return; }
  convs=allConvs.filter(c=>c.title.includes(q.trim()));
  updSB();
}

function showWelcomeSc(){
  chatHistory=[]; activeId=null;
  const m=document.getElementById('chatMsgs');
  m.innerHTML=`
  <div class="welcome-screen">
    <div class="w-icon"><svg viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></div>
    <div class="w-title">ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŸ</div>
    <div class="w-sub">Ø§Ø³Ø£Ù„Ù†ÙŠ Ø¹Ù† Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…ØŒ Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ« Ø§Ù„Ù†Ø¨ÙˆÙŠØ©ØŒ Ø§Ù„ÙÙ‚Ù‡ ÙˆØ§Ù„ÙØªØ§ÙˆÙ‰ØŒ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ù†Ø¨ÙˆÙŠØ©ØŒ Ø£Ùˆ Ø£ÙŠ Ù…ÙˆØ¶ÙˆØ¹ ØªØ±ÙŠØ¯Ù‡.</div>
    <div class="starter-grid">
      <div class="starter" onclick="aSend('Ø§Ø´Ø±Ø­ Ù„ÙŠ ØªÙØ³ÙŠØ± Ø³ÙˆØ±Ø© Ø§Ù„ÙØ§ØªØ­Ø© Ø¨Ø§Ù„ØªÙØµÙŠÙ„')">
        <div class="st-icon"><svg viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg></div>
        <div class="st-name">ØªÙØ³ÙŠØ± Ø§Ù„Ù‚Ø±Ø¢Ù†</div><div class="st-sub">Ø§Ù„Ø¢ÙŠØ§Øª ÙˆØ§Ù„Ø³ÙˆØ±</div>
      </div>
      <div class="starter" onclick="aSend('Ù…Ø§ ØµØ­Ø© Ø­Ø¯ÙŠØ« Ø¥Ù†Ù…Ø§ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø¨Ø§Ù„Ù†ÙŠØ§Øª ÙˆÙ…Ø§ Ø´Ø±Ø­Ù‡ØŸ')">
        <div class="st-icon"><svg viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></div>
        <div class="st-name">Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ«</div><div class="st-sub">Ø´Ø±Ø­ ÙˆØªØ®Ø±ÙŠØ¬</div>
      </div>
      <div class="starter" onclick="aSend('Ù…Ø§ Ø­ÙƒÙ… ØµÙ„Ø§Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹Ø© ÙˆÙ…Ø§ ÙØ¶Ù„Ù‡Ø§ØŸ')">
        <div class="st-icon"><svg viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></div>
        <div class="st-name">Ø§Ù„ÙÙ‚Ù‡ ÙˆØ§Ù„ÙØªØ§ÙˆÙ‰</div><div class="st-sub">Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø¹Ø©</div>
      </div>
      <div class="starter" onclick="aSend('Ø£Ø¹Ø·Ù†ÙŠ Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­ ÙƒØ§Ù…Ù„Ø© Ù…Ø¹ Ù…ØµØ§Ø¯Ø±Ù‡Ø§')">
        <div class="st-icon"><svg viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></div>
        <div class="st-name">Ø§Ù„Ø£Ø°ÙƒØ§Ø± ÙˆØ§Ù„Ø£Ø¯Ø¹ÙŠØ©</div><div class="st-sub">Ø§Ù„ØµØ¨Ø§Ø­ ÙˆØ§Ù„Ù…Ø³Ø§Ø¡</div>
      </div>
    </div>
  </div>`;
}

function newChat(){ showWelcomeSc(); updSB(); closeSB(); }

function updSB(){
  const el=document.getElementById('sbList');
  if(!convs.length){
    el.innerHTML='<div style="padding:16px 8px;text-align:center;font-size:12px;color:var(--text3);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø§Øª</div>';
    return;
  }
  let h='';
  const now=Date.now();
  const tod=convs.filter(c=>now-c.ts<86400000);
  const yes=convs.filter(c=>now-c.ts>=86400000&&now-c.ts<172800000);
  const old=convs.filter(c=>now-c.ts>=172800000);
  if(tod.length){ h+='<div class="grp-label">Ø§Ù„ÙŠÙˆÙ…</div>'; tod.forEach(c=>h+=cItem(c)); }
  if(yes.length){ h+='<div class="grp-label">Ø£Ù…Ø³</div>'; yes.forEach(c=>h+=cItem(c)); }
  if(old.length){ h+='<div class="grp-label">Ø³Ø§Ø¨Ù‚Ù‹Ø§</div>'; old.forEach(c=>h+=cItem(c)); }
  el.innerHTML=h;
  el.querySelectorAll('.c-item').forEach(i=>{
    i.addEventListener('click',()=>loadConv(i.dataset.id));
  });
  el.querySelectorAll('.c-del').forEach(b=>{
    b.addEventListener('click',(e)=>{e.stopPropagation();deleteConv(b.dataset.id);});
  });
}

function cItem(c){
  return `<div class="c-item${c.id===activeId?' on':''}" data-id="${c.id}">
    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="opacity:.45;flex-shrink:0"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
    <span class="c-txt">${esc(c.title)}</span>
    <button class="c-del" data-id="${c.id}" title="Ø­Ø°Ù">
      <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
    </button>
  </div>`;
}

function deleteConv(id){
  convs=convs.filter(c=>c.id!==id);
  allConvs=allConvs.filter(c=>c.id!==id);
  saveConvsToStorage();
  if(activeId===id){ showWelcomeSc(); activeId=null; }
  updSB();
  showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©');
}

function loadConv(id){
  const c=convs.find(x=>x.id===id); if(!c) return;
  activeId=id; chatHistory=[...c.history];
  const m=document.getElementById('chatMsgs'); m.innerHTML='';
  c.msgs.forEach(r=>renderRow(r.role,r.html,false));
  m.scrollTop=m.scrollHeight; updSB(); closeSB();
}

function aSend(t){ document.getElementById('ta').value=t; updateCharCount(); send(); }
function onKey(e){ if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();send();} }

function grow(el){
  el.style.height='auto';
  el.style.height=Math.min(el.scrollHeight,120)+'px';
  updateCharCount();
}

function updateCharCount(){
  const ta=document.getElementById('ta');
  const len=ta.value.length;
  document.getElementById('charCnt').textContent=len+' / 2000';
}

// Update char count on input
document.getElementById('ta')&&document.getElementById('ta').addEventListener('input',updateCharCount);

function renderRow(role, html, anim){
  const m=document.getElementById('chatMsgs');
  const w=m.querySelector('.welcome-screen'); if(w) w.remove();
  const div=document.createElement('div');
  div.className='msg-row '+(role==='u'?'u':'a');
  if(!anim) div.style.animation='none';

  if(role==='u'){
    div.innerHTML=`<div class="u-bubble">${html}</div>`;
  } else {
    div.innerHTML=`
      <div class="a-av"><svg viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></div>
      <div>
        <div class="a-content">${html}</div>
        <div class="msg-actions">
          <button class="msg-act-btn" onclick="copyMsg(this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            Ù†Ø³Ø®
          </button>
          <button class="msg-act-btn" onclick="shareMsg(this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
            Ù…Ø´Ø§Ø±ÙƒØ©
          </button>
        </div>
      </div>`;
  }
  m.appendChild(div);
  m.scrollTop=m.scrollHeight;
  return div;
}

function addTyp(){
  const m=document.getElementById('chatMsgs');
  const div=document.createElement('div'); div.className='typing-row'; div.id='typR';
  div.innerHTML=`<div class="a-av"><svg viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></div><div><div class="t-dots"><div class="tdot"></div><div class="tdot"></div><div class="tdot"></div></div></div>`;
  m.appendChild(div); m.scrollTop=m.scrollHeight;
}
function remTyp(){ const t=document.getElementById('typR'); if(t) t.remove(); }

async function send(){
  if(loading) return;
  const ta=document.getElementById('ta');
  const txt=ta.value.trim(); if(!txt) return;
  if(txt.length>2000) return showToast('Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø·ÙˆÙŠÙ„Ø© Ø¬Ø¯Ù‹Ø§ (Ø§Ù„Ø­Ø¯ 2000 Ø­Ø±Ù)','');
  ta.value=''; ta.style.height='auto'; updateCharCount();
  const uHtml=esc(txt);
  renderRow('u',uHtml,true);
  chatHistory.push({role:'user',content:txt});
  loading=true; document.getElementById('sendBtn').disabled=true; addTyp();
  let aHtml='';
  try{
    const rep=await callAI(chatHistory, currentMode);
    remTyp(); aHtml=fmtReply(rep);
    renderRow('a',aHtml,true);
    chatHistory.push({role:'assistant',content:rep});
    saveConv(uHtml,aHtml,txt);
  } catch(er){
    remTyp();
    aHtml='<span style="color:var(--text3)">âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ù‹Ø§</span>';
    renderRow('a',aHtml,true);
    console.error(er);
    chatHistory.pop();
  }
  loading=false; document.getElementById('sendBtn').disabled=false;
}

function saveConv(uH,aH,raw){
  if(!activeId){
    const id='c'+Date.now();
    const title=raw.length>35?raw.slice(0,35)+'â€¦':raw;
    const newConv={id,title,ts:Date.now(),history:[...chatHistory],msgs:[{role:'u',html:uH},{role:'a',html:aH}]};
    convs.unshift(newConv);
    allConvs.unshift(newConv);
    activeId=id;
  } else {
    const c=convs.find(x=>x.id===activeId);
    const ca=allConvs.find(x=>x.id===activeId);
    if(c){ c.history=[...chatHistory]; c.msgs.push({role:'u',html:uH},{role:'a',html:aH}); }
    if(ca){ ca.history=[...chatHistory]; ca.msgs=c?c.msgs:ca.msgs; }
  }
  saveConvsToStorage();
  updSB();
}

// ==============================
//  CLAUDE API
// ==============================
const SYS_BASE=`Ø£Ù†Øª "Ù†ÙˆØ± AI"ØŒ Ù…Ø³Ø§Ø¹Ø¯ Ø¥Ø³Ù„Ø§Ù…ÙŠ Ø°ÙƒÙŠ ÙˆÙ…ØªØ®ØµØµ ÙˆÙ…ÙˆØ«ÙˆÙ‚.

Ù‚ÙˆØ§Ø¹Ø¯Ùƒ:
1. Ø£Ø¬Ø¨ Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰ Ø§Ù„ÙˆØ§Ø¶Ø­Ø©.
2. Ø§Ù„Ø¢ÙŠØ§Øª: Ø¶Ø¹Ù‡Ø§ Ø¨ÙŠÙ† Ø¹Ù„Ø§Ù…ØªÙŠ âƒ...âƒ Ø«Ù… (Ø³ÙˆØ±Ø© ÙƒØ°Ø§: Ø¢ÙŠØ© Ø±Ù‚Ù…).
3. Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ«: Ø§Ø°ÙƒØ± Ø§Ù„Ù…ØµØ¯Ø± ÙˆØ­ÙƒÙ…Ù‡.
4. Ø§Ù„ÙØªØ§ÙˆÙ‰: ÙˆØ¶Ø­ Ø§Ù„Ù…Ø°Ù‡Ø¨ ÙˆØ£Ø¯Ù„ØªÙ‡.
5. Ù†ÙˆÙ‘Ø¹ ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© ÙƒÙ„ Ø±Ø¯ ÙˆÙ„Ø§ ØªÙƒØ±Ø± Ù†ÙØ³ Ø§Ù„Ø¬Ù…Ù„Ø©.
6. Ø§Ù„Ø±Ø¯ÙˆØ¯ Ù…ÙØµÙ‘Ù„Ø© ÙˆÙ…Ù†Ø¸Ù…Ø©.
7. Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… ** Ø£Ùˆ #ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ù†Øµ Ø¹Ø§Ø¯ÙŠ Ù…Ø¹ Ø£Ø±Ù‚Ø§Ù… ÙˆÙ†Ù‚Ø§Ø·.
8. Ø§Ø°ÙƒØ± Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ù…ØµØ¯Ø§Ù‚ÙŠØ©.`;

const SYS_MODES={
  general: SYS_BASE,
  quran: SYS_BASE+'\n\nØ£Ù†Øª Ø§Ù„Ø¢Ù† ÙÙŠ ÙˆØ¶Ø¹ ØªÙØ³ÙŠØ± Ø§Ù„Ù‚Ø±Ø¢Ù†. Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ Ø§Ù„ØªÙØ³ÙŠØ± Ø§Ù„Ø¯Ù‚ÙŠÙ‚ Ù…Ø¹ Ø°ÙƒØ± Ø§Ù„Ù…ÙØ³Ø±ÙŠÙ† ÙƒØ§Ø¨Ù† ÙƒØ«ÙŠØ± ÙˆØ§Ù„Ø·Ø¨Ø±ÙŠ ÙˆØ§Ù„Ù‚Ø±Ø·Ø¨ÙŠ ÙˆØ§Ù„Ø³Ø¹Ø¯ÙŠ.',
  hadith: SYS_BASE+'\n\nØ£Ù†Øª Ø§Ù„Ø¢Ù† ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ« Ø§Ù„Ù†Ø¨ÙˆÙŠØ©. Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ Ø´Ø±Ø­ Ø§Ù„Ø­Ø¯ÙŠØ« ÙˆØªØ®Ø±ÙŠØ¬Ù‡ ÙˆØ°ÙƒØ± Ø¯Ø±Ø¬Ø© ØµØ­ØªÙ‡ Ø¨Ø¯Ù‚Ø©.',
  fiqh: SYS_BASE+'\n\nØ£Ù†Øª Ø§Ù„Ø¢Ù† ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ÙÙ‚Ù‡ ÙˆØ§Ù„ÙØªØ§ÙˆÙ‰. Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù† Ø§Ù„Ø­ÙƒÙ… Ø§Ù„Ø´Ø±Ø¹ÙŠ Ù…Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø© ÙˆØ¢Ø±Ø§Ø¡ Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø¹Ø©.'
};

async function callAI(hist, mode='general'){
  const sys=SYS_MODES[mode]||SYS_MODES.general;
  const r=await fetch('https://api.anthropic.com/v1/messages',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      model:'claude-sonnet-4-20250514',
      max_tokens:1000,
      system:sys,
      messages:hist
    })
  });
  if(!r.ok){ const e=await r.json().catch(()=>({})); throw new Error(e.error?.message||'Err '+r.status); }
  const d=await r.json();
  return d.content.filter(b=>b.type==='text').map(b=>b.text).join('');
}

// ==============================
//  FORMAT
// ==============================
function esc(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function fmtReply(t){
  let o=esc(t);
  // Quran ï´¿...ï´¾ (ref)
  o=o.replace(/ï´¾([^ï´¿\n]+)ï´¿\s*\(([^)]+)\)/g,
    (_,v,r)=>`<div class="chat-quran">ï´¾${v}ï´¿<div class="chat-quran-ref">${r}</div></div>`);
  // âƒ...âƒ (ref)
  o=o.replace(/âƒ([^âƒ\n]+)âƒ\s*\(([^)]+)\)/g,
    (_,v,r)=>`<div class="chat-quran">ï´¾${v}ï´¿<div class="chat-quran-ref">${r}</div></div>`);
  // numbered 1. 2.
  o=o.replace(/^(\d+)\.\s+(.+)$/gm,
    (_,n,tx)=>`<div style="margin:5px 0"><span style="color:var(--gold);font-weight:700">${n}.</span> ${tx}</div>`);
  // Arabic numbers
  o=o.replace(/^([\u0661-\u0669\u0660]+)[\.\u066b]\s+(.+)$/gm,
    (_,n,tx)=>`<div style="margin:5px 0"><span style="color:var(--gold);font-weight:700">${n}.</span> ${tx}</div>`);
  // bullets
  o=o.replace(/^[-â€¢]\s+(.+)$/gm,
    (_,tx)=>`<div style="margin:4px 0;padding-right:6px">â€¢ ${tx}</div>`);
  // sources [source] tag
  o=o.replace(/\[([^\]]+)\]/g,
    (_,s)=>`<span class="chat-src-tag">${s}</span>`);
  // double newlines
  o=o.replace(/\n\n+/g,'<br><br>').replace(/\n/g,'<br>');
  return o;
}

// ==============================
//  MSG ACTIONS
// ==============================
function copyMsg(btn){
  const content=btn.closest('div').querySelector('.a-content');
  if(!content) return;
  const text=content.innerText||content.textContent;
  navigator.clipboard.writeText(text).then(()=>showToast('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø¯')).catch(()=>showToast('ØªØ¹Ø°Ø± Ø§Ù„Ù†Ø³Ø®',''));
}

function shareMsg(btn){
  const content=btn.closest('div').querySelector('.a-content');
  if(!content) return;
  const text=content.innerText||content.textContent;
  if(navigator.share){
    navigator.share({title:'Ù†ÙˆØ± AI', text:text}).catch(()=>{});
  } else {
    navigator.clipboard.writeText(text).then(()=>showToast('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø¯ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©'));
  }
}

// ==============================
//  EXPORT
// ==============================
function toggleExport(){
  const m=document.getElementById('exportMenu');
  m.classList.toggle('show');
  document.addEventListener('click', function handler(e){
    if(!document.getElementById('exportBtn').contains(e.target)){
      m.classList.remove('show');
      document.removeEventListener('click',handler);
    }
  });
}

function exportChat(type){
  document.getElementById('exportMenu').classList.remove('show');
  if(!chatHistory.length){ showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø© Ù„Ù„ØªØµØ¯ÙŠØ±',''); return; }
  const msgs=chatHistory.map(m=>
    (m.role==='user'?'Ø£Ù†Øª: ':'Ù†ÙˆØ± AI: ')+m.content
  ).join('\n\n---\n\n');

  if(type==='text'){
    const blob=new Blob([msgs],{type:'text/plain;charset=utf-8'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
    a.download='noor-ai-chat.txt'; a.click(); showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©');
  } else if(type==='html'){
    const html=`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="UTF-8"><title>Ù…Ø­Ø§Ø¯Ø«Ø© Ù†ÙˆØ± AI</title><style>body{font-family:Arial,sans-serif;max-width:800px;margin:40px auto;padding:0 20px;background:#0d0d0d;color:#ececec;direction:rtl;}.msg{margin:16px 0;padding:12px 16px;border-radius:12px;line-height:1.8;}.user{background:#2a2a2a;text-align:right;}.ai{background:#171717;border:1px solid #2f2f2f;}.label{font-size:12px;color:#9a9a9a;margin-bottom:6px;}</style></head><body><h1 style="color:#c9a84c;font-family:serif;">Ù…Ø­Ø§Ø¯Ø«Ø© Ù†ÙˆØ± AI</h1>${chatHistory.map(m=>`<div class="msg ${m.role==='user'?'user':'ai'}"><div class="label">${m.role==='user'?'Ø£Ù†Øª':'Ù†ÙˆØ± AI'}</div>${esc(m.content).replace(/\n/g,'<br>')}</div>`).join('')}</body></html>`;
    const blob=new Blob([html],{type:'text/html;charset=utf-8'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
    a.download='noor-ai-chat.html'; a.click(); showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©');
  }
}

function copyAllChat(){
  document.getElementById('exportMenu').classList.remove('show');
  if(!chatHistory.length){ showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø©',''); return; }
  const text=chatHistory.map(m=>(m.role==='user'?'Ø£Ù†Øª: ':'Ù†ÙˆØ± AI: ')+m.content).join('\n\n');
  navigator.clipboard.writeText(text).then(()=>showToast('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ÙƒØ§Ù…Ù„Ø©')).catch(()=>showToast('ØªØ¹Ø°Ø± Ø§Ù„Ù†Ø³Ø®',''));
}

// ==============================
//  VOICE
// ==============================
let isRecording=false;
function startVoice(){
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(!SR){ showToast('Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØµÙˆØªÙŠ',''); return; }
  if(isRecording) return;
  isRecording=true;
  const micBtn=document.getElementById('micBtn');
  micBtn.style.color='var(--red)';
  const r=new SR(); r.lang='ar-SA'; r.interimResults=false;
  r.onresult=e=>{
    const ta=document.getElementById('ta');
    ta.value=e.results[0][0].transcript;
    grow(ta); isRecording=false; micBtn.style.color='';
    showToast('ØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª');
  };
  r.onerror=()=>{ isRecording=false; micBtn.style.color=''; showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±ÙØŒ Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ù‹Ø§',''); };
  r.onend=()=>{ isRecording=false; micBtn.style.color=''; };
  r.start();
}

// ==============================
//  TASBIH
// ==============================
let tasbihCount=0, tasbihDhikr='Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡';

function openTasbih(){
  document.getElementById('tasbihOv').classList.add('show');
}
function closeTasbih(){
  document.getElementById('tasbihOv').classList.remove('show');
}
document.getElementById('tasbihOv').addEventListener('click',function(e){
  if(e.target===this) closeTasbih();
});
function tasbihClick(){
  tasbihCount++;
  document.getElementById('tasbihCount').textContent=tasbihCount;
  if(tasbihCount%33===0&&tasbihCount>0){
    showToast('Ø£Ø­Ø³Ù†Øª! Ø£ÙƒÙ…Ù„Øª Ù£Ù£ Ù…Ø±Ø© ğŸŒŸ');
  }
}
function resetTasbih(){
  tasbihCount=0;
  document.getElementById('tasbihCount').textContent='0';
}
function setDhikr(el, dhikr){
  tasbihDhikr=dhikr;
  document.querySelectorAll('.dhikr-opt').forEach(b=>b.classList.remove('on'));
  el.classList.add('on');
  document.getElementById('tasbihDhikr').textContent=dhikr;
  tasbihCount=0;
  document.getElementById('tasbihCount').textContent='0';
}
</script>
</body>
</html>
