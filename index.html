<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù†ÙˆØ± Ø§Ù„Ø¹ÙÙ„Ù… â€” Ù…Ù†ØµØ© Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400;1,700&family=Noto+Naskh+Arabic:wght@400;500;600;700&family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg-base:#0c1a12;--bg-elevated:#111f16;--bg-surface:#162119;--bg-overlay:#1c2d20;--bg-input:#0e1a10;
  --border-subtle:rgba(180,145,60,0.12);--border-mid:rgba(180,145,60,0.22);--border-glow:rgba(180,145,60,0.45);
  --gold-vivid:#c9973a;--gold-soft:#d8b060;--gold-pale:#e8cc88;--gold-dim:#7a5e20;
  --green-vivid:#1d7a44;--green-soft:#24944f;
  --text-1:#eee5cc;--text-2:#a89870;--text-3:#6a5e42;--text-inv:#0c1a12;
  --radius-sm:8px;--radius-md:12px;--radius-lg:18px;--radius-xl:24px;--radius-full:9999px;
  --shadow-gold:0 0 40px rgba(201,151,58,0.18);--shadow-deep:0 8px 32px rgba(0,0,0,0.5);
  --transition:all 0.2s cubic-bezier(0.4,0,0.2,1);
  --font-ui:'IBM Plex Sans Arabic',sans-serif;--font-ar:'Noto Naskh Arabic',serif;--font-display:'Amiri',serif;
  --sidebar-w:280px;
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{font-size:16px;scroll-behavior:smooth}
body{font-family:var(--font-ui);background:var(--bg-base);color:var(--text-1);min-height:100vh;overflow-x:hidden;-webkit-font-smoothing:antialiased}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image:radial-gradient(ellipse 80% 50% at 10% 50%,rgba(29,122,68,0.07) 0%,transparent 60%),
  radial-gradient(ellipse 60% 40% at 90% 10%,rgba(201,151,58,0.06) 0%,transparent 50%),
  url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' stroke='rgba(201,151,58,0.035)' stroke-width='0.5'%3E%3Cpath d='M40 0 L80 40 L40 80 L0 40 Z'/%3E%3Cpath d='M40 20 L60 40 L40 60 L20 40 Z'/%3E%3Cline x1='40' y1='0' x2='40' y2='80'/%3E%3Cline x1='0' y1='40' x2='80' y2='40'/%3E%3C/g%3E%3C/svg%3E");
  background-size:auto,auto,80px 80px}
::-webkit-scrollbar{width:5px;height:5px}::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--gold-dim);border-radius:var(--radius-full)}
#app{position:relative;z-index:1;display:flex;height:100vh;overflow:hidden}
.sidebar{width:var(--sidebar-w);flex-shrink:0;display:flex;flex-direction:column;background:var(--bg-elevated);border-left:1px solid var(--border-subtle);height:100vh;overflow:hidden;transition:width 0.3s cubic-bezier(0.4,0,0.2,1)}
.sidebar.collapsed{width:0}
.sidebar-header{padding:20px 18px 16px;border-bottom:1px solid var(--border-subtle);display:flex;align-items:center;gap:12px}
.logo-mark{width:40px;height:40px;border-radius:12px;flex-shrink:0;background:linear-gradient(135deg,var(--gold-vivid),var(--gold-dim));display:flex;align-items:center;justify-content:center;font-size:18px;animation:logoGlow 4s ease-in-out infinite}
@keyframes logoGlow{0%,100%{box-shadow:0 0 20px rgba(201,151,58,0.35)}50%{box-shadow:0 0 35px rgba(201,151,58,0.6)}}
.logo-text{min-width:0}
.logo-title{font-family:var(--font-display);font-size:1.15rem;color:var(--gold-soft);line-height:1.1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.logo-sub{font-size:0.68rem;color:var(--text-3);margin-top:2px}
.new-chat-btn{margin:12px 12px 0;padding:10px 16px;background:rgba(201,151,58,0.1);border:1px solid var(--border-mid);border-radius:var(--radius-md);color:var(--gold-soft);font-family:var(--font-ui);font-size:0.88rem;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:10px;transition:var(--transition);width:calc(100% - 24px)}
.new-chat-btn:hover{background:rgba(201,151,58,0.18);border-color:var(--border-glow)}
.sidebar-nav{padding:10px 10px 0;display:flex;flex-direction:column;gap:2px}
.nav-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:var(--radius-md);cursor:pointer;font-size:0.875rem;color:var(--text-2);transition:var(--transition);white-space:nowrap;overflow:hidden;border:1px solid transparent;user-select:none}
.nav-item:hover{background:var(--bg-surface);color:var(--text-1)}
.nav-item.active{background:rgba(201,151,58,0.12);color:var(--gold-soft);border-color:var(--border-mid)}
.nav-item .nav-icon{font-size:1rem;flex-shrink:0}
.nav-item .nav-label{flex:1}
.nav-item .nav-badge{background:var(--gold-vivid);color:var(--text-inv);font-size:0.65rem;font-weight:700;padding:1px 6px;border-radius:var(--radius-full)}
.sidebar-section{padding:12px 12px 0;font-size:0.7rem;font-weight:700;color:var(--text-3);text-transform:uppercase;letter-spacing:0.1em}
.history-list{padding:6px 10px;display:flex;flex-direction:column;gap:1px;flex:1;overflow-y:auto}
.history-item{padding:9px 12px;border-radius:var(--radius-sm);cursor:pointer;font-size:0.82rem;color:var(--text-2);transition:var(--transition);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;display:flex;align-items:center;gap:8px}
.history-item:hover{background:var(--bg-surface);color:var(--text-1)}
.sidebar-footer{padding:12px;border-top:1px solid var(--border-subtle);margin-top:auto}
.user-card{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:var(--radius-md);background:var(--bg-surface);border:1px solid var(--border-subtle);cursor:pointer;transition:var(--transition)}
.user-card:hover{border-color:var(--border-mid)}
.user-avatar{width:34px;height:34px;border-radius:50%;flex-shrink:0;background:linear-gradient(135deg,var(--green-vivid),var(--green-soft));display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:#fff}
.user-info{flex:1;min-width:0}
.user-name{font-size:0.83rem;font-weight:600;color:var(--text-1);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.user-email{font-size:0.7rem;color:var(--text-3);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.user-menu-trigger{color:var(--text-3);font-size:0.85rem}
.main-content{flex:1;display:flex;flex-direction:column;height:100vh;overflow:hidden;background:var(--bg-base);min-width:0}
.topbar{display:flex;align-items:center;justify-content:space-between;padding:0 20px;height:56px;flex-shrink:0;border-bottom:1px solid var(--border-subtle);background:rgba(12,26,18,0.8);backdrop-filter:blur(12px)}
.topbar-left{display:flex;align-items:center;gap:10px}
.topbar-toggle{width:36px;height:36px;border-radius:var(--radius-sm);background:transparent;border:1px solid var(--border-subtle);color:var(--text-3);cursor:pointer;font-size:1rem;display:flex;align-items:center;justify-content:center;transition:var(--transition)}
.topbar-toggle:hover{background:var(--bg-surface);color:var(--text-1);border-color:var(--border-mid)}
.topbar-title{font-size:0.9rem;font-weight:600;color:var(--text-2);display:flex;align-items:center;gap:8px}
.model-badge{padding:3px 10px;border-radius:var(--radius-full);background:rgba(201,151,58,0.12);border:1px solid var(--border-mid);font-size:0.7rem;color:var(--gold-soft);font-weight:600}
.topbar-right{display:flex;align-items:center;gap:8px}
.topbar-btn{padding:7px 16px;border-radius:var(--radius-sm);font-family:var(--font-ui);font-size:0.82rem;font-weight:600;cursor:pointer;transition:var(--transition);border:1px solid var(--border-mid)}
.topbar-btn.ghost{background:transparent;color:var(--text-2)}
.topbar-btn.ghost:hover{background:var(--bg-surface);color:var(--text-1)}
.topbar-btn.primary{background:linear-gradient(135deg,var(--gold-vivid),var(--gold-dim));color:var(--text-inv);border-color:transparent}
.topbar-btn.primary:hover{transform:translateY(-1px);box-shadow:var(--shadow-gold)}
.section{display:none;flex:1;overflow:hidden;flex-direction:column}
.section.active{display:flex}
#sec-chat{position:relative}
.chat-viewport{flex:1;overflow-y:auto;padding:0;display:flex;flex-direction:column}
.welcome-screen{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 24px;text-align:center;max-width:680px;margin:0 auto;width:100%}
.welcome-ornament{font-size:2.5rem;margin-bottom:20px;animation:floatOrnament 4s ease-in-out infinite}
@keyframes floatOrnament{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.welcome-basmala{font-family:var(--font-display);font-size:1.8rem;color:var(--gold-soft);margin-bottom:8px;line-height:1.4}
.welcome-title{font-size:2rem;font-weight:700;color:var(--text-1);margin-bottom:12px;line-height:1.2}
.welcome-desc{font-size:0.95rem;color:var(--text-2);line-height:1.7;max-width:480px;margin-bottom:36px}
.suggestions-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;width:100%;max-width:600px}
.suggestion-card{padding:14px 16px;border-radius:var(--radius-md);background:var(--bg-elevated);border:1px solid var(--border-subtle);cursor:pointer;text-align:right;transition:var(--transition);display:flex;align-items:flex-start;gap:10px}
.suggestion-card:hover{background:var(--bg-surface);border-color:var(--border-mid);transform:translateY(-2px);box-shadow:var(--shadow-deep)}
.suggestion-card .sc-icon{font-size:1.2rem;flex-shrink:0;margin-top:1px}
.suggestion-card .sc-text{font-size:0.83rem;color:var(--text-2);line-height:1.5}
.suggestion-card:hover .sc-text{color:var(--text-1)}
.messages-list{flex:1;padding:20px 0;display:flex;flex-direction:column}
.msg-row{display:flex;padding:16px 0;animation:msgIn 0.3s ease-out}
@keyframes msgIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
.msg-row.user{flex-direction:row-reverse}
.msg-inner{max-width:760px;width:100%;margin:0 auto;display:flex;gap:14px;padding:0 24px}
.msg-row.user .msg-inner{flex-direction:row-reverse}
.msg-avatar-wrap{width:36px;height:36px;flex-shrink:0;border-radius:50%;overflow:hidden;margin-top:2px}
.msg-avatar-ai{width:100%;height:100%;background:linear-gradient(135deg,var(--gold-vivid),var(--gold-dim));display:flex;align-items:center;justify-content:center;font-size:15px}
.msg-avatar-user{width:100%;height:100%;background:linear-gradient(135deg,var(--green-vivid),var(--green-soft));display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:#fff}
.msg-content-wrap{flex:1;min-width:0}
.msg-sender-name{font-size:0.75rem;font-weight:600;color:var(--text-3);margin-bottom:6px}
.msg-bubble{padding:16px 20px;border-radius:var(--radius-lg);line-height:1.75;font-size:0.92rem}
.msg-row.user .msg-bubble{background:var(--bg-overlay);border:1px solid var(--border-subtle);border-radius:var(--radius-lg) 6px var(--radius-lg) var(--radius-lg);color:var(--text-1);max-width:480px;margin-right:auto}
.msg-row.ai .msg-bubble{background:transparent;border:none;padding:0;color:var(--text-1)}
.ans-verdict-pill{display:inline-flex;align-items:center;gap:6px;padding:5px 14px;border-radius:var(--radius-full);background:linear-gradient(135deg,rgba(201,151,58,0.2),rgba(122,94,32,0.2));border:1px solid var(--border-mid);font-size:0.78rem;font-weight:700;color:var(--gold-soft);margin-bottom:14px}
.ans-verdict-text{font-size:1.05rem;font-weight:600;color:var(--text-1);margin-bottom:18px;line-height:1.6}
.ans-block{margin-bottom:14px;border-radius:var(--radius-md);overflow:hidden;border:1px solid var(--border-subtle)}
.ans-block-header{display:flex;align-items:center;gap:8px;padding:10px 16px;font-size:0.75rem;font-weight:700;text-transform:uppercase;letter-spacing:0.07em;border-bottom:1px solid var(--border-subtle)}
.ans-block.quran .ans-block-header{background:rgba(29,122,68,0.15);color:#6dd897}
.ans-block.hadith .ans-block-header{background:rgba(201,151,58,0.12);color:var(--gold-soft)}
.ans-block.explain .ans-block-header{background:rgba(255,255,255,0.04);color:var(--text-2)}
.ans-block.scholars .ans-block-header{background:rgba(100,130,200,0.1);color:#9bb5f0}
.ans-block-body{padding:14px 16px;background:rgba(0,0,0,0.2)}
.quran-text{font-family:var(--font-ar);font-size:1.25rem;color:var(--text-1);line-height:2;direction:rtl;text-align:right;margin-bottom:8px}
.quran-ref{font-size:0.75rem;color:var(--gold-dim)}
.hadith-text{font-family:var(--font-ar);font-size:1.05rem;color:var(--text-1);line-height:1.9;direction:rtl;text-align:right;margin-bottom:10px}
.hbadge{padding:3px 10px;border-radius:var(--radius-full);font-size:0.71rem;font-weight:700}
.hbadge.sahih{background:rgba(29,122,68,0.35);color:#6dd897;border:1px solid rgba(109,216,151,0.3)}
.explain-text{font-size:0.9rem;color:var(--text-2);line-height:1.8;white-space:pre-wrap}
.scholars-list{display:flex;flex-direction:column;gap:8px}
.scholar-row{display:flex;gap:10px;align-items:flex-start;padding:8px 0;border-bottom:1px solid var(--border-subtle)}
.scholar-row:last-child{border-bottom:none}
.school-name{font-size:0.78rem;font-weight:700;color:var(--gold-soft);flex-shrink:0;min-width:90px}
.school-opinion{font-size:0.85rem;color:var(--text-2);line-height:1.6}
.ans-sources{margin-top:14px;padding:12px 16px;background:var(--bg-surface);border-radius:var(--radius-md);border:1px solid var(--border-subtle)}
.ans-sources-title{font-size:0.72rem;color:var(--text-3);margin-bottom:8px;font-weight:600;text-transform:uppercase;letter-spacing:0.08em}
.ans-links{display:flex;flex-wrap:wrap;gap:6px}
.ans-link{padding:4px 12px;border-radius:var(--radius-full);background:rgba(201,151,58,0.1);border:1px solid var(--border-mid);color:var(--gold-soft);font-size:0.75rem;text-decoration:none;transition:var(--transition);display:flex;align-items:center;gap:5px}
.ans-link:hover{background:rgba(201,151,58,0.2)}
.msg-actions{display:flex;gap:4px;margin-top:12px;flex-wrap:wrap}
.msg-act-btn{padding:5px 12px;border-radius:var(--radius-sm);background:transparent;border:1px solid var(--border-subtle);color:var(--text-3);font-size:0.74rem;cursor:pointer;font-family:var(--font-ui);transition:var(--transition);display:flex;align-items:center;gap:5px}
.msg-act-btn:hover{background:var(--bg-surface);color:var(--text-1);border-color:var(--border-mid)}
.msg-act-btn.copied{color:#6dd897;border-color:rgba(109,216,151,0.3)}
.typing-dots{display:flex;gap:5px;align-items:center;padding:12px 16px}
.typing-dot{width:7px;height:7px;border-radius:50%;background:var(--gold-soft);opacity:0.5;animation:typeBounce 1.4s ease-in-out infinite}
.typing-dot:nth-child(2){animation-delay:0.15s}
.typing-dot:nth-child(3){animation-delay:0.3s}
@keyframes typeBounce{0%,60%,100%{transform:translateY(0);opacity:0.5}30%{transform:translateY(-6px);opacity:1}}
.typing-label{font-size:0.8rem;color:var(--text-3)}
.input-zone{flex-shrink:0;padding:16px 24px 20px;border-top:1px solid var(--border-subtle);background:var(--bg-base)}
.input-container{max-width:760px;margin:0 auto}
.input-box{background:var(--bg-elevated);border:1px solid var(--border-mid);border-radius:var(--radius-lg);transition:var(--transition);overflow:hidden}
.input-box:focus-within{border-color:var(--border-glow);box-shadow:0 0 0 3px rgba(201,151,58,0.08)}
.input-toolbar-top{display:flex;gap:4px;padding:10px 14px 6px;border-bottom:1px solid var(--border-subtle);flex-wrap:wrap}
.it-btn{padding:5px 12px;border-radius:var(--radius-sm);background:transparent;border:1px solid transparent;color:var(--text-3);font-size:0.77rem;cursor:pointer;font-family:var(--font-ui);font-weight:500;transition:var(--transition);display:flex;align-items:center;gap:5px}
.it-btn:hover{background:var(--bg-surface);color:var(--text-2);border-color:var(--border-subtle)}
.it-btn.active-mode{background:rgba(201,151,58,0.12);color:var(--gold-soft);border-color:var(--border-mid)}
.input-row{display:flex;align-items:flex-end;padding:10px 14px;gap:10px}
.chat-textarea{flex:1;background:transparent;border:none;outline:none;color:var(--text-1);font-family:var(--font-ui);font-size:0.95rem;resize:none;min-height:24px;max-height:200px;line-height:1.6;scrollbar-width:none}
.chat-textarea::placeholder{color:var(--text-3)}
.chat-textarea::-webkit-scrollbar{display:none}
.send-btn{width:38px;height:38px;flex-shrink:0;border-radius:10px;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1rem;transition:var(--transition);background:linear-gradient(135deg,var(--gold-vivid),var(--gold-dim));color:var(--text-inv)}
.send-btn:hover{transform:scale(1.05);box-shadow:var(--shadow-gold)}
.send-btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}
.input-footer{display:flex;justify-content:space-between;align-items:center;margin-top:8px;padding:0 2px}
.input-disclaimer{font-size:0.71rem;color:var(--text-3)}
.char-counter{font-size:0.71rem;color:var(--text-3)}
.section-header{padding:24px 28px 20px;border-bottom:1px solid var(--border-subtle);flex-shrink:0}
.section-title{font-family:var(--font-display);font-size:1.6rem;color:var(--gold-soft);margin-bottom:4px}
.section-sub{font-size:0.85rem;color:var(--text-2)}
.quran-search-bar{padding:16px 28px;border-bottom:1px solid var(--border-subtle);flex-shrink:0;display:flex;gap:10px}
.qs-input{flex:1;background:var(--bg-elevated);border:1px solid var(--border-mid);border-radius:var(--radius-md);padding:12px 18px;color:var(--text-1);font-family:var(--font-ar);font-size:1.05rem;outline:none;transition:var(--transition)}
.qs-input:focus{border-color:var(--border-glow);box-shadow:0 0 0 3px rgba(201,151,58,0.08)}
.qs-input::placeholder{color:var(--text-3);font-family:var(--font-ui);font-size:0.9rem}
.qs-btn{padding:12px 24px;border-radius:var(--radius-md);background:linear-gradient(135deg,var(--gold-vivid),var(--gold-dim));border:none;color:var(--text-inv);font-family:var(--font-ui);font-size:0.9rem;font-weight:700;cursor:pointer;transition:var(--transition)}
.qs-btn:hover{transform:translateY(-1px);box-shadow:var(--shadow-gold)}
.quran-results{flex:1;overflow-y:auto;padding:20px 28px}
.quran-verse-card{background:var(--bg-elevated);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);padding:24px;margin-bottom:14px;transition:var(--transition)}
.quran-verse-card:hover{border-color:var(--border-mid)}
.qvc-meta{display:flex;align-items:center;gap:10px;margin-bottom:14px}
.qvc-num{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,var(--gold-vivid),var(--gold-dim));display:flex;align-items:center;justify-content:center;font-family:var(--font-display);font-size:0.85rem;color:var(--text-inv);font-weight:700}
.qvc-ref{font-size:0.8rem;color:var(--text-3)}
.qvc-surah{font-size:0.85rem;color:var(--gold-soft);font-weight:600}
.qvc-arabic{font-family:var(--font-ar);font-size:1.4rem;color:var(--text-1);line-height:2.1;text-align:justify;direction:rtl;margin-bottom:14px;padding:16px;background:rgba(0,0,0,0.2);border-radius:var(--radius-md);border-right:3px solid var(--gold-vivid)}
.qvc-tafsir{font-size:0.87rem;color:var(--text-2);line-height:1.8;padding:12px 16px;background:rgba(29,122,68,0.08);border-radius:var(--radius-md)}
.qvc-tafsir-label{font-size:0.72rem;font-weight:700;color:var(--green-soft);margin-bottom:6px;text-transform:uppercase;letter-spacing:0.07em}
.qvc-actions{display:flex;gap:6px;margin-top:14px}
#sec-hadith{flex-direction:column;overflow:hidden}
.hadith-books{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;padding:20px 28px;flex-shrink:0;border-bottom:1px solid var(--border-subtle)}
.hadith-book-btn{padding:12px 16px;border-radius:var(--radius-md);background:var(--bg-elevated);border:1px solid var(--border-subtle);color:var(--text-2);font-family:var(--font-ui);font-size:0.82rem;cursor:pointer;transition:var(--transition);text-align:center}
.hadith-book-btn:hover,.hadith-book-btn.active{background:rgba(201,151,58,0.12);color:var(--gold-soft);border-color:var(--border-mid)}
#sec-bookmarks{flex-direction:column;overflow:hidden}
.bookmarks-list{flex:1;overflow-y:auto;padding:20px 28px}
.bookmark-card{background:var(--bg-elevated);border:1px solid var(--border-subtle);border-radius:var(--radius-md);padding:18px 20px;margin-bottom:10px;display:flex;gap:14px;align-items:flex-start;transition:var(--transition)}
.bookmark-card:hover{border-color:var(--border-mid)}
.bk-icon{font-size:1.2rem;flex-shrink:0;margin-top:2px}
.bk-content{flex:1;min-width:0}
.bk-question{font-size:0.88rem;color:var(--text-1);font-weight:600;margin-bottom:4px}
.bk-date{font-size:0.72rem;color:var(--text-3)}
.bk-del{background:transparent;border:none;color:var(--text-3);cursor:pointer;font-size:0.85rem;padding:4px;border-radius:6px;transition:var(--transition)}
.bk-del:hover{color:#f87171;background:rgba(248,113,113,0.1)}
.empty-state{text-align:center;padding:60px 24px;color:var(--text-3)}
.empty-icon{font-size:3rem;margin-bottom:12px;opacity:0.5}
.empty-text{font-size:0.9rem}
#sec-admin{flex-direction:column;overflow:hidden}
.admin-body{flex:1;overflow-y:auto;padding:24px 28px}
.admin-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:24px}
.admin-stat{background:var(--bg-elevated);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);padding:20px;text-align:center}
.admin-stat-num{font-family:var(--font-display);font-size:2rem;font-weight:700;color:var(--gold-soft);line-height:1}
.admin-stat-label{font-size:0.75rem;color:var(--text-3);margin-top:6px}
.admin-table-wrap{background:var(--bg-elevated);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);overflow:hidden}
.admin-table-title{padding:16px 20px;font-size:0.85rem;font-weight:700;color:var(--text-1);border-bottom:1px solid var(--border-subtle);display:flex;align-items:center;justify-content:space-between}
.admin-table{width:100%;border-collapse:collapse}
.admin-table th{padding:12px 16px;text-align:right;font-size:0.72rem;font-weight:700;color:var(--text-3);text-transform:uppercase;letter-spacing:0.08em;background:rgba(0,0,0,0.2);border-bottom:1px solid var(--border-subtle)}
.admin-table td{padding:13px 16px;font-size:0.83rem;color:var(--text-2);border-bottom:1px solid var(--border-subtle)}
.admin-table tr:last-child td{border-bottom:none}
.st-badge{padding:3px 10px;border-radius:var(--radius-full);font-size:0.71rem;font-weight:700}
.st-ok{background:rgba(29,122,68,0.3);color:#6dd897}
.st-rev{background:rgba(201,151,58,0.2);color:var(--gold-soft)}
.st-blk{background:rgba(248,113,113,0.2);color:#f87171}
.overlay{position:fixed;inset:0;z-index:1000;background:rgba(0,0,0,0.75);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity 0.25s}
.overlay.open{opacity:1;pointer-events:all}
.modal{background:var(--bg-elevated);border:1px solid var(--border-mid);border-radius:var(--radius-xl);padding:36px;width:100%;max-width:440px;transform:scale(0.95) translateY(10px);transition:transform 0.25s cubic-bezier(0.4,0,0.2,1);position:relative;max-height:90vh;overflow-y:auto}
.overlay.open .modal{transform:scale(1) translateY(0)}
.modal-close-btn{position:absolute;top:14px;left:14px;width:30px;height:30px;border-radius:50%;background:var(--bg-surface);border:1px solid var(--border-subtle);color:var(--text-3);cursor:pointer;font-size:0.9rem;display:flex;align-items:center;justify-content:center;transition:var(--transition)}
.modal-close-btn:hover{color:var(--text-1);border-color:var(--border-mid)}
.modal-logo{text-align:center;margin-bottom:24px}
.modal-logo-mark{width:52px;height:52px;border-radius:14px;margin:0 auto 12px;background:linear-gradient(135deg,var(--gold-vivid),var(--gold-dim));display:flex;align-items:center;justify-content:center;font-size:24px;box-shadow:0 0 25px rgba(201,151,58,0.4)}
.modal-title{font-family:var(--font-display);font-size:1.4rem;color:var(--gold-soft)}
.modal-sub{font-size:0.82rem;color:var(--text-3);margin-top:4px}
.modal-tabs{display:flex;margin-bottom:24px;background:var(--bg-surface);border-radius:var(--radius-md);padding:3px}
.modal-tab{flex:1;padding:9px;border-radius:var(--radius-sm);background:transparent;border:none;color:var(--text-3);font-family:var(--font-ui);font-size:0.85rem;font-weight:600;cursor:pointer;transition:var(--transition)}
.modal-tab.active{background:var(--bg-elevated);color:var(--gold-soft);box-shadow:var(--shadow-deep)}
.form-group{margin-bottom:16px}
.form-label{display:block;font-size:0.8rem;font-weight:600;color:var(--text-2);margin-bottom:7px}
.form-input{width:100%;background:var(--bg-input);border:1px solid var(--border-mid);border-radius:var(--radius-md);padding:11px 14px;color:var(--text-1);font-family:var(--font-ui);font-size:0.9rem;outline:none;transition:var(--transition)}
.form-input:focus{border-color:var(--border-glow);box-shadow:0 0 0 3px rgba(201,151,58,0.1)}
.form-input::placeholder{color:var(--text-3)}
.form-error{margin-bottom:14px;padding:10px 14px;border-radius:var(--radius-sm);background:rgba(248,113,113,0.1);border:1px solid rgba(248,113,113,0.3);color:#f87171;font-size:0.82rem;display:none}
.form-submit{width:100%;padding:13px;border-radius:var(--radius-md);background:linear-gradient(135deg,var(--gold-vivid),var(--gold-dim));border:none;color:var(--text-inv);font-family:var(--font-ui);font-size:0.95rem;font-weight:700;cursor:pointer;transition:var(--transition);margin-top:4px}
.form-submit:hover{transform:translateY(-1px);box-shadow:var(--shadow-gold)}
.form-submit:disabled{opacity:0.7;cursor:not-allowed;transform:none}
.pw-strength{margin-top:6px}
.pw-bar{height:3px;border-radius:2px;background:var(--bg-surface);overflow:hidden}
.pw-fill{height:100%;border-radius:2px;transition:all 0.3s}
.pw-label{font-size:0.68rem;color:var(--text-3);margin-top:3px}
.user-dropdown{position:fixed;z-index:500;background:var(--bg-elevated);border:1px solid var(--border-mid);border-radius:var(--radius-lg);padding:6px;min-width:200px;box-shadow:var(--shadow-deep);display:none}
.user-dropdown.open{display:block;animation:dropIn 0.15s ease-out}
@keyframes dropIn{from{opacity:0;transform:translateY(-6px) scale(0.97)}to{opacity:1;transform:translateY(0) scale(1)}}
.dd-item{display:flex;align-items:center;gap:10px;padding:9px 12px;border-radius:var(--radius-sm);cursor:pointer;font-size:0.84rem;color:var(--text-2);transition:var(--transition)}
.dd-item:hover{background:var(--bg-surface);color:var(--text-1)}
.dd-item.danger{color:#f87171}
.dd-item.danger:hover{background:rgba(248,113,113,0.1)}
.dd-divider{height:1px;background:var(--border-subtle);margin:4px 0}
.toast-container{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);z-index:2000;display:flex;flex-direction:column;align-items:center;gap:8px}
.toast{padding:11px 20px;border-radius:var(--radius-md);background:var(--bg-elevated);border:1px solid var(--border-mid);color:var(--text-1);font-size:0.85rem;font-weight:500;box-shadow:var(--shadow-deep);display:flex;align-items:center;gap:8px;animation:toastIn 0.25s ease-out;max-width:380px;text-align:center}
@keyframes toastIn{from{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}
.toast.success .toast-icon{color:#6dd897}
.toast.error .toast-icon{color:#f87171}
.toast.info .toast-icon{color:var(--gold-soft)}
.loading-bar{position:fixed;top:0;left:0;right:0;height:2px;z-index:3000;background:linear-gradient(90deg,var(--gold-vivid),var(--gold-soft));transform:scaleX(0);transform-origin:right;transition:transform 0.4s ease}
.loading-bar.active{transform:scaleX(1)}
@media(max-width:900px){
  .sidebar{position:fixed;z-index:200;height:100vh;left:0;top:0}
  .sidebar:not(.open){width:0}
  .sidebar.open{width:var(--sidebar-w)}
  .admin-stats{grid-template-columns:1fr 1fr}
  .hadith-books{grid-template-columns:1fr 1fr}
}
@media(max-width:600px){
  .suggestions-grid{grid-template-columns:1fr}
  .welcome-title{font-size:1.4rem}
  .modal{padding:24px 20px}
  .quran-search-bar{flex-direction:column}
}
</style>
</head>
<body>

<div class="loading-bar" id="loadingBar"></div>
<div class="toast-container" id="toastContainer"></div>

<!-- Auth Modal -->
<div class="overlay" id="authOverlay">
  <div class="modal">
    <button class="modal-close-btn" onclick="closeModal()">âœ•</button>
    <div class="modal-logo">
      <div class="modal-logo-mark">â˜ª</div>
      <div class="modal-title">Ù†ÙˆØ± Ø§Ù„Ø¹ÙÙ„Ù…</div>
      <div class="modal-sub">Ù…Ù†ØµØ© Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</div>
    </div>
    <div class="modal-tabs">
      <button class="modal-tab active" id="tab-login" onclick="switchTab('login')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      <button class="modal-tab" id="tab-register" onclick="switchTab('register')">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
    </div>
    <div class="form-error" id="auth-error"></div>
    <div id="form-login">
      <div class="form-group">
        <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
        <input type="email" class="form-input" id="login-email" placeholder="example@email.com" onkeydown="if(event.key==='Enter')doLogin()">
      </div>
      <div class="form-group">
        <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <input type="password" class="form-input" id="login-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')doLogin()">
      </div>
      <button class="form-submit" id="auth-btn-login" onclick="doLogin()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    </div>
    <div id="form-register" style="display:none">
      <div class="form-group">
        <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
        <input type="text" class="form-input" id="reg-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
      </div>
      <div class="form-group">
        <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
        <input type="email" class="form-input" id="reg-email" placeholder="example@email.com">
      </div>
      <div class="form-group">
        <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <input type="password" class="form-input" id="reg-pass" placeholder="6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„" oninput="checkPwStrength(this.value)">
        <div class="pw-strength">
          <div class="pw-bar"><div class="pw-fill" id="pw-fill" style="width:0;background:#f87171"></div></div>
          <div class="pw-label" id="pw-label"></div>
        </div>
      </div>
      <button class="form-submit" id="auth-btn-register" onclick="doRegister()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
    </div>
  </div>
</div>

<!-- User Dropdown -->
<div class="user-dropdown" id="userDropdown">
  <div class="dd-item" onclick="showSection('bookmarks');closeDropdown()">â­ Ù…Ø­ÙÙˆØ¸Ø§ØªÙŠ</div>
  <div class="dd-divider"></div>
  <div class="dd-item danger" onclick="doLogout();closeDropdown()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</div>
</div>

<div id="app">
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="logo-mark">â˜ª</div>
      <div class="logo-text">
        <div class="logo-title">Ù†ÙˆØ± Ø§Ù„Ø¹ÙÙ„Ù…</div>
        <div class="logo-sub">Ù…Ù†ØµØ© Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</div>
      </div>
    </div>
    <button class="new-chat-btn" onclick="newChat()"><span>âœï¸</span> Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
    <div class="sidebar-nav">
      <div class="nav-item active" onclick="showSection('chat')"><span class="nav-icon">ğŸ’¬</span><span class="nav-label">Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„ÙÙ‚Ù‡ÙŠØ©</span></div>
      <div class="nav-item" onclick="showSection('quran')"><span class="nav-icon">ğŸ“–</span><span class="nav-label">Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠ</span></div>
      <div class="nav-item" onclick="showSection('hadith')"><span class="nav-icon">ğŸ“œ</span><span class="nav-label">ÙƒØªØ¨ Ø§Ù„Ø­Ø¯ÙŠØ«</span></div>
      <div class="nav-item" onclick="showSection('bookmarks')"><span class="nav-icon">â­</span><span class="nav-label">Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª</span></div>
      <div class="nav-item" id="admin-nav-item" onclick="showSection('admin')" style="display:none"><span class="nav-icon">âš™ï¸</span><span class="nav-label">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</span><span class="nav-badge" id="adminBadge">0</span></div>
    </div>
    <div class="sidebar-section" style="margin-top:16px;">Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©</div>
    <div class="history-list" id="historyList">
      <div class="history-item" style="color:var(--text-3);font-size:0.78rem;padding:16px 12px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø³Ø§Ø¨Ù‚Ø©</div>
    </div>
    <div class="sidebar-footer" id="sidebarFooter" style="display:none">
      <div class="user-card" onclick="toggleDropdown(event)">
        <div class="user-avatar" id="sidebarAvatar">ØŸ</div>
        <div class="user-info">
          <div class="user-name" id="sidebarName">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</div>
          <div class="user-email" id="sidebarEmail">-</div>
        </div>
        <div class="user-menu-trigger">â‹®</div>
      </div>
    </div>
  </aside>

  <div class="main-content" id="mainContent">
    <div class="topbar">
      <div class="topbar-left">
        <button class="topbar-toggle" onclick="toggleSidebar()">â˜°</button>
        <div class="topbar-title">
          <span id="topbarTitle">Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„ÙÙ‚Ù‡ÙŠØ©</span>
          <span class="model-badge">Claude Sonnet</span>
        </div>
      </div>
      <div class="topbar-right" id="topbarRight">
        <div id="auth-buttons">
          <button class="topbar-btn ghost" onclick="openModal('login')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
          <button class="topbar-btn primary" onclick="openModal('register')">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ù…Ø¬Ø§Ù†ÙŠ</button>
        </div>
        <div id="topbar-user-info" style="display:none;align-items:center;gap:10px">
          <span style="font-size:0.82rem;color:var(--text-2)" id="topbarGreeting"></span>
          <button class="topbar-btn ghost" onclick="doLogout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
      </div>
    </div>

    <!-- CHAT -->
    <div class="section active" id="sec-chat">
      <div class="chat-viewport" id="chatViewport">
        <div class="welcome-screen" id="welcomeScreen">
          <div class="welcome-ornament">â˜ª</div>
          <div class="welcome-basmala">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
          <h1 class="welcome-title">ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŸ</h1>
          <p class="welcome-desc">Ø§Ø³Ø£Ù„ Ø£ÙŠ Ø³Ø¤Ø§Ù„ ÙÙŠ Ø§Ù„ÙÙ‚Ù‡ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØŒ Ø§Ù„ØªÙØ³ÙŠØ±ØŒ Ø§Ù„Ø­Ø¯ÙŠØ«ØŒ Ø£Ùˆ Ø§Ù„Ø¹Ù‚ÙŠØ¯Ø© â€” ÙˆØ³Ø£ÙØ¬ÙŠØ¨Ùƒ Ø¨Ø£Ø¯Ù„Ø© Ù…ÙˆØ«Ù‚Ø© Ù…Ù† Ø§Ù„Ù‚Ø±Ø¢Ù† ÙˆØ§Ù„Ø³Ù†Ø©.</p>
          <div class="suggestions-grid">
            <div class="suggestion-card" onclick="fillQuestion('Ù…Ø§ Ø­ÙƒÙ… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… Ø¨Ø¯ÙˆÙ† ÙˆØ¶ÙˆØ¡ØŸ')"><span class="sc-icon">ğŸ•Œ</span><span class="sc-text">Ù…Ø§ Ø­ÙƒÙ… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† Ø¨Ø¯ÙˆÙ† ÙˆØ¶ÙˆØ¡ØŸ</span></div>
            <div class="suggestion-card" onclick="fillQuestion('Ù…Ø§ Ù‡ÙŠ Ø´Ø±ÙˆØ· ØµØ­Ø© Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ£Ø±ÙƒØ§Ù†Ù‡Ø§ØŸ')"><span class="sc-icon">ğŸ™</span><span class="sc-text">Ø´Ø±ÙˆØ· ØµØ­Ø© Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ£Ø±ÙƒØ§Ù†Ù‡Ø§</span></div>
            <div class="suggestion-card" onclick="fillQuestion('Ù…Ø§ Ø­ÙƒÙ… Ø§Ù„Ø²ÙƒØ§Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø§Ù„ Ø§Ù„Ù…Ø¯Ø®Ø±ØŸ ÙˆÙ…Ø§ Ù†ØµØ§Ø¨Ù‡Ø§ØŸ')"><span class="sc-icon">ğŸ’°</span><span class="sc-text">Ø²ÙƒØ§Ø© Ø§Ù„Ù…Ø§Ù„ Ø§Ù„Ù…Ø¯Ø®Ø± ÙˆÙ†ØµØ§Ø¨Ù‡Ø§</span></div>
            <div class="suggestion-card" onclick="fillQuestion('Ù…Ø§ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨ Ø§Ù„ÙÙ‚Ù‡ÙŠØ© Ø§Ù„Ø£Ø±Ø¨Ø¹Ø©ØŸ')"><span class="sc-icon">ğŸ“š</span><span class="sc-text">Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨ Ø§Ù„ÙÙ‚Ù‡ÙŠØ© Ø§Ù„Ø£Ø±Ø¨Ø¹Ø©</span></div>
            <div class="suggestion-card" onclick="fillQuestion('Ù…Ø§ Ø£Ø­ÙƒØ§Ù… ØµÙŠØ§Ù… Ø´Ù‡Ø± Ø±Ù…Ø¶Ø§Ù† ÙˆÙ…Ø¨Ø·Ù„Ø§ØªÙ‡ØŸ')"><span class="sc-icon">ğŸŒ™</span><span class="sc-text">Ø£Ø­ÙƒØ§Ù… Ø§Ù„ØµÙŠØ§Ù… ÙˆÙ…Ø¨Ø·Ù„Ø§ØªÙ‡</span></div>
            <div class="suggestion-card" onclick="fillQuestion('Ù…Ø§ Ø­ÙƒÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ù„ Ø¨Ø§Ù„Ù…ÙˆÙ„Ø¯ Ø§Ù„Ù†Ø¨ÙˆÙŠ Ø§Ù„Ø´Ø±ÙŠÙØŸ')"><span class="sc-icon">â­</span><span class="sc-text">Ø­ÙƒÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ù„ Ø¨Ø§Ù„Ù…ÙˆÙ„Ø¯ Ø§Ù„Ù†Ø¨ÙˆÙŠ</span></div>
          </div>
        </div>
        <div class="messages-list" id="messagesList" style="display:none"></div>
      </div>
      <div class="input-zone">
        <div class="input-container">
          <div class="input-box">
            <div class="input-toolbar-top">
              <button class="it-btn active-mode" id="mode-general" onclick="setMode('general')">ğŸ“‹ Ø¹Ø§Ù…</button>
              <button class="it-btn" id="mode-quran" onclick="setMode('quran')">ğŸ“– Ù‚Ø±Ø¢Ù†</button>
              <button class="it-btn" id="mode-hadith" onclick="setMode('hadith')">ğŸ“œ Ø­Ø¯ÙŠØ«</button>
              <button class="it-btn" id="mode-fiqh" onclick="setMode('fiqh')">âš–ï¸ ÙÙ‚Ù‡</button>
              <div style="flex:1"></div>
              <button class="it-btn" onclick="clearChat()" style="color:var(--text-3)">ğŸ—‘ï¸ Ù…Ø³Ø­</button>
            </div>
            <div class="input-row">
              <textarea class="chat-textarea" id="chatInput" placeholder="Ø§Ø³Ø£Ù„ Ø³Ø¤Ø§Ù„Ùƒ Ø§Ù„Ø´Ø±Ø¹ÙŠ Ù‡Ù†Ø§..." rows="1" onkeydown="handleKeydown(event)" oninput="autoResize(this)"></textarea>
              <button class="send-btn" id="sendBtn" onclick="sendMessage()">â¤</button>
            </div>
          </div>
          <div class="input-footer">
            <span class="input-disclaimer">âš ï¸ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ù„Ù„Ø§Ø³ØªØ¦Ù†Ø§Ø³ Ø§Ù„Ø¹Ù„Ù…ÙŠ. Ù„Ù„ÙØªÙˆÙ‰ Ø§Ù„Ø±Ø³Ù…ÙŠØ© Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¹Ù„Ù…Ø§Ø¡ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ÙŠÙ†.</span>
            <span class="char-counter" id="charCounter">0 / 1000</span>
          </div>
        </div>
      </div>
    </div>

    <!-- QURAN -->
    <div class="section" id="sec-quran">
      <div class="section-header">
        <div class="section-title">ğŸ“– Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</div>
        <div class="section-sub">Ø§Ø¨Ø­Ø« ÙÙŠ Ø¢ÙŠØ§Øª Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… Ù…Ø¹ Ø§Ù„ØªÙØ³ÙŠØ± Ù…Ù† Ø§Ø¨Ù† ÙƒØ«ÙŠØ±</div>
      </div>
      <div class="quran-search-bar">
        <input type="text" class="qs-input" id="quranInput" placeholder="Ø§Ø¨Ø­Ø« Ø¨ÙƒÙ„Ù…Ø© Ø£Ùˆ Ø¬Ø²Ø¡ Ù…Ù† Ø¢ÙŠØ©..." onkeydown="if(event.key==='Enter')searchQuran()">
        <button class="qs-btn" onclick="searchQuran()">ğŸ” Ø¨Ø­Ø«</button>
      </div>
      <div class="quran-results" id="quranResults">
        <div style="text-align:center;padding:60px;color:var(--text-3)"><div style="font-size:3rem;margin-bottom:12px;opacity:0.4">ğŸ“–</div><div>Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ù„Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</div></div>
      </div>
    </div>

    <!-- HADITH -->
    <div class="section" id="sec-hadith">
      <div class="section-header">
        <div class="section-title">ğŸ“œ ÙƒØªØ¨ Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠÙ</div>
        <div class="section-sub">Ø§Ø®ØªØ± Ø§Ù„ÙƒØªØ§Ø¨ Ø«Ù… Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ« Ø§Ù„Ù†Ø¨ÙˆÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙØ©</div>
      </div>
      <div class="hadith-books">
        <button class="hadith-book-btn active" id="book-bukhari" onclick="selectBook('bukhari')">ØµØ­ÙŠØ­ Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ</button>
        <button class="hadith-book-btn" id="book-muslim" onclick="selectBook('muslim')">ØµØ­ÙŠØ­ Ù…Ø³Ù„Ù…</button>
        <button class="hadith-book-btn" id="book-abudawud" onclick="selectBook('abudawud')">Ø³Ù†Ù† Ø£Ø¨ÙŠ Ø¯Ø§ÙˆØ¯</button>
        <button class="hadith-book-btn" id="book-tirmidhi" onclick="selectBook('tirmidhi')">Ø³Ù†Ù† Ø§Ù„ØªØ±Ù…Ø°ÙŠ</button>
        <button class="hadith-book-btn" id="book-nasai" onclick="selectBook('nasai')">Ø³Ù†Ù† Ø§Ù„Ù†Ø³Ø§Ø¦ÙŠ</button>
        <button class="hadith-book-btn" id="book-ibnmajah" onclick="selectBook('ibnmajah')">Ø³Ù†Ù† Ø§Ø¨Ù† Ù…Ø§Ø¬Ø©</button>
      </div>
      <div class="quran-search-bar">
        <input type="text" class="qs-input" id="hadithInput" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ«..." onkeydown="if(event.key==='Enter')searchHadith()">
        <button class="qs-btn" onclick="searchHadith()">ğŸ” Ø¨Ø­Ø«</button>
      </div>
      <div class="quran-results" id="hadithResults">
        <div style="text-align:center;padding:60px;color:var(--text-3)"><div style="font-size:3rem;margin-bottom:12px;opacity:0.4">ğŸ“œ</div><div>Ø§Ø®ØªØ± Ø§Ù„ÙƒØªØ§Ø¨ ÙˆØ§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ« Ø§Ù„Ù†Ø¨ÙˆÙŠØ©</div></div>
      </div>
    </div>

    <!-- BOOKMARKS -->
    <div class="section" id="sec-bookmarks">
      <div class="section-header">
        <div class="section-title">â­ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª</div>
        <div class="section-sub">Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØªÙŠ Ø­ÙØ¸ØªÙ‡Ø§</div>
      </div>
      <div class="bookmarks-list" id="bookmarksList">
        <div class="empty-state"><div class="empty-icon">â­</div><div class="empty-text">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­ÙÙˆØ¸Ø§Øª Ø¨Ø¹Ø¯.</div></div>
      </div>
    </div>

    <!-- ADMIN -->
    <div class="section" id="sec-admin">
      <div class="section-header">
        <div class="section-title">âš™ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù</div>
        <div class="section-sub">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØµØ© ÙˆÙ…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</div>
      </div>
      <div class="admin-body">
        <div class="admin-stats">
          <div class="admin-stat"><div class="admin-stat-num" id="stat-questions">-</div><div class="admin-stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</div></div>
          <div class="admin-stat"><div class="admin-stat-num" id="stat-users">-</div><div class="admin-stat-label">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</div></div>
          <div class="admin-stat"><div class="admin-stat-num" id="stat-pending">-</div><div class="admin-stat-label">ØªØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©</div></div>
          <div class="admin-stat"><div class="admin-stat-num">Claude</div><div class="admin-stat-label">Ù…Ø­Ø±Ùƒ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</div></div>
        </div>
        <div class="admin-table-wrap">
          <div class="admin-table-title">
            <span>Ø³Ø¬Ù„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©</span>
            <button class="topbar-btn ghost" style="font-size:0.78rem" onclick="loadAdminLogs()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
          </div>
          <table class="admin-table">
            <thead><tr><th>Ø§Ù„Ø³Ø¤Ø§Ù„</th><th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead>
            <tbody id="adminLogsBody"><tr><td colspan="4" style="text-align:center;padding:30px;color:var(--text-3)">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="module">
// ============================================================
// âœ… Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
// ============================================================
const FIREBASE_CONFIG = {
  apiKey: "AIzaSyBWmPhxpq6Q7G7CRUaAfGBa18zs56wgD0",
  authDomain: "noor-94b0d.firebaseapp.com",
  projectId: "noor-94b0d",
  storageBucket: "noor-94b0d.firebasestorage.app",
  messagingSenderId: "440882728031",
  appId: "1:440882728031:web:ba8236e66506dc18a01fea"
};

// ============================================================
// âœ… Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙØªØ§Ø­ Anthropic Ù‡Ù†Ø§ â€” ÙŠØ°Ù‡Ø¨ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù€ /api/chat
// ============================================================

import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js';
import { getFirestore, collection, addDoc, getDocs, getDoc, setDoc, doc, query, where, orderBy, limit, serverTimestamp, updateDoc } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

const app  = initializeApp(FIREBASE_CONFIG);
const auth = getAuth(app);
const db   = getFirestore(app);

let currentUser  = null;
let userProfile  = null;
let isAdmin      = false;
let chatHistory  = [];
let bookmarks    = [];
let currentMode  = 'general';
let selectedBook = 'bukhari';
let isSending    = false;

// ============================================================
// AUTH STATE
// ============================================================
onAuthStateChanged(auth, async (user) => {
  if (user) {
    currentUser = user;
    const ref  = doc(db, 'users', user.uid);
    const snap = await getDoc(ref);
    if (snap.exists()) {
      userProfile = snap.data();
    } else {
      userProfile = { name: user.displayName || user.email.split('@')[0], email: user.email, role: 'user', questionsCount: 0, createdAt: serverTimestamp() };
      await setDoc(ref, userProfile);
    }
    isAdmin = userProfile.role === 'admin';
    updateUIForLoggedIn();
    loadBookmarks();
    if (isAdmin) { document.getElementById('admin-nav-item').style.display = 'flex'; loadAdminStats(); }
    showToast('Ù…Ø±Ø­Ø¨Ø§Ù‹ ' + (userProfile.name || user.email) + ' ğŸ‘‹', 'success');
  } else {
    currentUser = null; userProfile = null; isAdmin = false; bookmarks = [];
    updateUIForLoggedOut();
  }
});

function updateUIForLoggedIn() {
  const name = userProfile?.name || currentUser.email;
  document.getElementById('auth-buttons').style.display = 'none';
  document.getElementById('topbar-user-info').style.display = 'flex';
  document.getElementById('topbarGreeting').textContent = 'Ø£Ù‡Ù„Ø§Ù‹ØŒ ' + name;
  document.getElementById('sidebarFooter').style.display = 'block';
  document.getElementById('sidebarAvatar').textContent = name.charAt(0).toUpperCase();
  document.getElementById('sidebarName').textContent = name;
  document.getElementById('sidebarEmail').textContent = currentUser.email;
}

function updateUIForLoggedOut() {
  document.getElementById('auth-buttons').style.display = 'flex';
  document.getElementById('topbar-user-info').style.display = 'none';
  document.getElementById('sidebarFooter').style.display = 'none';
  document.getElementById('admin-nav-item').style.display = 'none';
}

// ============================================================
// AUTH
// ============================================================
window.doLogin = async function() {
  const email = document.getElementById('login-email').value.trim();
  const pass  = document.getElementById('login-pass').value;
  const btn   = document.getElementById('auth-btn-login');
  if (!email || !pass) { showAuthError('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„'); return; }
  btn.disabled = true; btn.textContent = 'â³ Ø¬Ø§Ø±Ù ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...';
  document.getElementById('auth-error').style.display = 'none';
  try {
    await signInWithEmailAndPassword(auth, email, pass);
    closeModal();
  } catch(e) {
    const msgs = {'auth/invalid-credential':'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©','auth/user-not-found':'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯','auth/wrong-password':'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©','auth/too-many-requests':'Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙƒØ«ÙŠØ±Ø©ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±','auth/network-request-failed':'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª'};
    showAuthError(msgs[e.code] || 'Ø­Ø¯Ø« Ø®Ø·Ø£: ' + e.message);
  }
  btn.disabled = false; btn.textContent = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
};

window.doRegister = async function() {
  const name  = document.getElementById('reg-name').value.trim();
  const email = document.getElementById('reg-email').value.trim();
  const pass  = document.getElementById('reg-pass').value;
  const btn   = document.getElementById('auth-btn-register');
  if (!name)         { showAuthError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…'); return; }
  if (!email)        { showAuthError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ'); return; }
  if (pass.length<6) { showAuthError('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„'); return; }
  btn.disabled = true; btn.textContent = 'â³ Ø¬Ø§Ø±Ù Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...';
  document.getElementById('auth-error').style.display = 'none';
  try {
    const cred = await createUserWithEmailAndPassword(auth, email, pass);
    await updateProfile(cred.user, { displayName: name });
    closeModal();
    showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ ğŸ‰', 'success');
  } catch(e) {
    const msgs = {'auth/email-already-in-use':'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„','auth/invalid-email':'Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­','auth/weak-password':'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹','auth/network-request-failed':'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª'};
    showAuthError(msgs[e.code] || 'Ø­Ø¯Ø« Ø®Ø·Ø£: ' + e.message);
  }
  btn.disabled = false; btn.textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨';
};

window.doLogout = async function() {
  await signOut(auth);
  chatHistory = [];
  newChat();
  showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'info');
};

function showAuthError(msg) {
  const err = document.getElementById('auth-error');
  err.textContent = msg; err.style.display = 'block';
}

// ============================================================
// âœ… SEND MESSAGE â€” ÙŠØ³ØªØ®Ø¯Ù… /api/chat Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Anthropic Ù…Ø¨Ø§Ø´Ø±Ø©
// ============================================================
window.sendMessage = async function() {
  const input = document.getElementById('chatInput');
  const text  = input.value.trim();
  if (!text || isSending) return;

  isSending = true;
  document.getElementById('sendBtn').disabled = true;
  document.getElementById('welcomeScreen').style.display = 'none';
  document.getElementById('messagesList').style.display = 'flex';

  appendMessage('user', text);
  input.value = ''; input.style.height = 'auto';
  document.getElementById('charCounter').textContent = '0 / 1000';
  chatHistory.push({ role: 'user', content: text });

  const typingId = appendTyping();
  showLoadingBar();

  try {
    // âœ… Ø§Ù„Ø·Ù„Ø¨ ÙŠØ°Ù‡Ø¨ Ù„Ù€ Vercel Function â€” Ø§Ù„Ù…ÙØªØ§Ø­ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¢Ù…Ù†
    const res = await fetch('/api/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ messages: chatHistory, mode: currentMode })
    });

    hideLoadingBar();
    removeTyping(typingId);

    if (!res.ok) {
      const errData = await res.json().catch(()=>({}));
      throw new Error(errData.error || 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±: ' + res.status);
    }

    const data    = await res.json();
    const aiText  = data.reply;

    chatHistory.push({ role: 'assistant', content: aiText });
    appendMessage('ai', aiText);
    if (currentUser) await logQuestion(text, aiText);

  } catch(err) {
    hideLoadingBar();
    removeTyping(typingId);
    console.error('Error:', err);
    appendMessage('ai', 'âš ï¸ ' + err.message + '\n\nØªØ£ÙƒØ¯ Ù…Ù†:\n1. Ø¥Ø¶Ø§ÙØ© ANTHROPIC_API_KEY ÙÙŠ Vercel Environment Variables\n2. Ø±ÙØ¹ Ù…Ù„Ù api/chat.js Ø¹Ù„Ù‰ Vercel');
    showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„', 'error');
  }

  isSending = false;
  document.getElementById('sendBtn').disabled = false;
};

// ============================================================
// FIRESTORE
// ============================================================
async function logQuestion(question, answer) {
  try {
    await addDoc(collection(db, 'questions'), { uid: currentUser.uid, question, answer, mode: currentMode, status: 'answered', timestamp: serverTimestamp() });
    const userRef = doc(db, 'users', currentUser.uid);
    const snap = await getDoc(userRef);
    if (snap.exists()) await updateDoc(userRef, { questionsCount: (snap.data().questionsCount||0) + 1 });
  } catch(e) { console.error('Firestore log error:', e); }
}

async function loadBookmarks() {
  if (!currentUser) return;
  try {
    const q = query(collection(db, 'bookmarks'), where('uid','==',currentUser.uid), orderBy('timestamp','desc'), limit(50));
    const snap = await getDocs(q);
    bookmarks = snap.docs.map(d => ({id:d.id,...d.data()}));
    renderBookmarks();
  } catch(e) { console.error('Load bookmarks error:', e); }
}

function renderBookmarks() {
  const list = document.getElementById('bookmarksList');
  if (!bookmarks.length) { list.innerHTML = '<div class="empty-state"><div class="empty-icon">â­</div><div class="empty-text">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­ÙÙˆØ¸Ø§Øª Ø¨Ø¹Ø¯.</div></div>'; return; }
  list.innerHTML = bookmarks.map(b => `<div class="bookmark-card"><span class="bk-icon">â­</span><div class="bk-content"><div class="bk-question">${escHtml(b.question)}</div><div class="bk-date">${b.timestamp?.toDate?.()?.toLocaleDateString('ar-SA')||''}</div></div><button class="bk-del" onclick="deleteBookmark('${b.id}')">ğŸ—‘ï¸</button></div>`).join('');
}

window.saveBookmark = async function(question, answer) {
  if (!currentUser) { openModal('login'); showToast('Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª', 'info'); return; }
  try {
    const ref = await addDoc(collection(db, 'bookmarks'), { uid: currentUser.uid, question, answer, timestamp: serverTimestamp() });
    bookmarks.unshift({ id: ref.id, question, answer });
    renderBookmarks();
    showToast('ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù…ÙØ¶Ù„Ø© â­', 'success');
  } catch(e) { showToast('ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸: ' + e.message, 'error'); }
};

window.deleteBookmark = async function(id) {
  try {
    const { deleteDoc } = await import('https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js');
    await deleteDoc(doc(db, 'bookmarks', id));
    bookmarks = bookmarks.filter(b => b.id !== id);
    renderBookmarks();
    showToast('ØªÙ… Ø§Ù„Ø­Ø°Ù', 'info');
  } catch(e) { showToast('ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù', 'error'); }
};

// ============================================================
// ADMIN
// ============================================================
async function loadAdminStats() {
  if (!isAdmin) return;
  try {
    const qSnap = await getDocs(collection(db, 'questions'));
    const uSnap = await getDocs(collection(db, 'users'));
    const pSnap = await getDocs(query(collection(db,'questions'),where('status','==','review')));
    document.getElementById('stat-questions').textContent = qSnap.size;
    document.getElementById('stat-users').textContent = uSnap.size;
    document.getElementById('stat-pending').textContent = pSnap.size;
    document.getElementById('adminBadge').textContent = pSnap.size;
    await loadAdminLogs();
  } catch(e) { console.error('Admin stats error:', e); }
}

window.loadAdminLogs = async function() {
  if (!isAdmin) return;
  try {
    const q = query(collection(db,'questions'), orderBy('timestamp','desc'), limit(20));
    const snap = await getDocs(q);
    const tbody = document.getElementById('adminLogsBody');
    if (snap.empty) { tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;padding:30px;color:var(--text-3)">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ø¨Ø¹Ø¯</td></tr>'; return; }
    tbody.innerHTML = snap.docs.map(d => {
      const data = d.data();
      const time = data.timestamp?.toDate?.()?.toLocaleTimeString('ar-SA',{hour:'2-digit',minute:'2-digit'})||'-';
      const q2   = (data.question||'').substring(0,50) + ((data.question||'').length>50?'...':'');
      const stClass = data.status==='review'?'st-rev':data.status==='blocked'?'st-blk':'st-ok';
      const stLabel = data.status==='review'?'Ù…Ø±Ø§Ø¬Ø¹Ø©':data.status==='blocked'?'Ù…Ø­Ø¸ÙˆØ±':'Ù…ÙØ¬Ø§Ø¨';
      return `<tr><td>${escHtml(q2)}</td><td style="direction:ltr;font-size:0.75rem;color:var(--text-3)">${(data.uid||'').substring(0,12)}...</td><td>${time}</td><td><span class="st-badge ${stClass}">${stLabel}</span></td></tr>`;
    }).join('');
  } catch(e) { console.error('Admin logs error:', e); }
};

// ============================================================
// MESSAGE RENDERING
// ============================================================
function appendMessage(role, text) {
  const list = document.getElementById('messagesList');
  const div  = document.createElement('div');
  div.className = `msg-row ${role}`;
  const avatarInner = role==='ai' ? `<div class="msg-avatar-ai">â˜ª</div>` : `<div class="msg-avatar-user">${currentUser?(userProfile?.name||'Ø£').charAt(0).toUpperCase():'Ø£'}</div>`;
  const content = role==='ai' ? renderAIContent(text) : `<div class="msg-bubble">${escHtml(text).replace(/\n/g,'<br>')}</div>`;
  div.innerHTML = `<div class="msg-inner"><div class="msg-avatar-wrap">${avatarInner}</div><div class="msg-content-wrap"><div class="msg-sender-name">${role==='ai'?'Ù†ÙˆØ± Ø§Ù„Ø¹Ù„Ù…':'Ø£Ù†Øª'}</div>${content}</div></div>`;
  list.appendChild(div);
  scrollToBottom();
}

function renderAIContent(text) {
  const s  = {};
  const rx = {
    verdict:/ã€Ø§Ù„Ø­ÙƒÙ…ã€‘:\s*(.+?)(?=ã€|$)/s,
    quranDaleel:/ã€Ø§Ù„Ø¯Ù„ÙŠÙ„ Ù…Ù† Ø§Ù„Ù‚Ø±Ø¢Ù†ã€‘:\s*(.+?)(?=ã€|$)/s,
    hadithDaleel:/ã€Ø§Ù„Ø¯Ù„ÙŠÙ„ Ù…Ù† Ø§Ù„Ø³Ù†Ø©ã€‘:\s*(.+?)(?=ã€|$)/s,
    explain:/ã€Ø§Ù„Ø´Ø±Ø­ ÙˆØ§Ù„ØªÙØµÙŠÙ„ã€‘:\s*(.+?)(?=ã€|$)/s,
    scholars:/ã€Ù…Ø°Ø§Ù‡Ø¨ Ø§Ù„Ø¹Ù„Ù…Ø§Ø¡ã€‘:\s*(.+?)(?=ã€|$)/s,
    more:/ã€Ù„Ù„Ø§Ø³ØªØ²Ø§Ø¯Ø©ã€‘:\s*(.+?)(?=ã€|$)/s
  };
  let hasFormat = false;
  for (const [k,r] of Object.entries(rx)) { const m=text.match(r); if(m){s[k]=m[1].trim();hasFormat=true;} }
  if (!hasFormat) return `<div class="msg-bubble"><div style="white-space:pre-wrap;line-height:1.8;font-size:0.92rem">${escHtml(text)}</div>${msgActionsHtml(text,text)}</div>`;

  let html = '<div class="msg-bubble">';
  if (s.verdict) html += `<div class="ans-verdict-pill">âš–ï¸ Ø§Ù„Ø­ÙƒÙ… Ø§Ù„Ø´Ø±Ø¹ÙŠ</div><div class="ans-verdict-text">${escHtml(s.verdict)}</div>`;
  if (s.quranDaleel) html += `<div class="ans-block quran"><div class="ans-block-header">ğŸ“– Ø§Ù„Ø¯Ù„ÙŠÙ„ Ù…Ù† Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</div><div class="ans-block-body"><div class="quran-text">${escHtml(s.quranDaleel)}</div></div></div>`;
  if (s.hadithDaleel) html += `<div class="ans-block hadith"><div class="ans-block-header">ğŸ“œ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ù…Ù† Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù†Ø¨ÙˆÙŠØ©</div><div class="ans-block-body"><div class="hadith-text">${escHtml(s.hadithDaleel)}</div></div></div>`;
  if (s.explain) html += `<div class="ans-block explain"><div class="ans-block-header">ğŸ’¡ Ø§Ù„Ø´Ø±Ø­ ÙˆØ§Ù„ØªÙØµÙŠÙ„</div><div class="ans-block-body"><div class="explain-text">${escHtml(s.explain)}</div></div></div>`;
  if (s.scholars) {
    const lines = s.scholars.split('\n').filter(l=>l.trim());
    let sh = '<div class="scholars-list">';
    lines.forEach(line => {
      const m = line.match(/^[â€¢Â·-]?\s*(Ø§Ù„Ø­Ù†ÙÙŠØ©|Ø§Ù„Ù…Ø§Ù„ÙƒÙŠØ©|Ø§Ù„Ø´Ø§ÙØ¹ÙŠØ©|Ø§Ù„Ø­Ù†Ø§Ø¨Ù„Ø©|Ø§Ù„Ø±Ø§Ø¬Ø­):\s*(.+)/);
      if (m) sh += `<div class="scholar-row"><div class="school-name">${m[1]}</div><div class="school-opinion">${escHtml(m[2])}</div></div>`;
      else if (line.trim()) sh += `<div class="scholar-row"><div class="school-opinion">${escHtml(line.replace(/^[â€¢Â·-]\s*/,''))}</div></div>`;
    });
    sh += '</div>';
    html += `<div class="ans-block scholars"><div class="ans-block-header">ğŸ§‘â€ğŸ« Ù…Ø°Ø§Ù‡Ø¨ Ø§Ù„Ø¹Ù„Ù…Ø§Ø¡</div><div class="ans-block-body">${sh}</div></div>`;
  }
  if (s.more) {
    const links = s.more.match(/[\w-]+\.\w{2,}/g)||[];
    if (links.length) html += `<div class="ans-sources"><div class="ans-sources-title">Ù„Ù„Ø§Ø³ØªØ²Ø§Ø¯Ø© ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹</div><div class="ans-links">${links.map(l=>`<a href="https://${l}" target="_blank" rel="noopener" class="ans-link">ğŸ”— ${l}</a>`).join('')}</div></div>`;
  }
  const fullQ = chatHistory.find((m,i)=>m.role==='user'&&chatHistory[i+1]?.content===text)?.content||'';
  html += msgActionsHtml(fullQ, text) + '</div>';
  return html;
}

function msgActionsHtml(question, answer) {
  const safeA = answer.replace(/\\/g,'\\\\').replace(/`/g,"'").replace(/\n/g,'\\n').substring(0,500);
  const safeQ = question.replace(/\\/g,'\\\\').replace(/`/g,"'");
  return `<div class="msg-actions">
    <button class="msg-act-btn" onclick="copyToClipboard(this,\`${safeA}\`)">ğŸ“‹ Ù†Ø³Ø®</button>
    <button class="msg-act-btn" onclick="saveBk(this,\`${safeQ}\`,\`${safeA}\`)">â­ Ø­ÙØ¸</button>
    <button class="msg-act-btn" onclick="shareAnswer(\`${safeA}\`)">ğŸ”— Ù…Ø´Ø§Ø±ÙƒØ©</button>
  </div>`;
}

window.copyToClipboard = function(btn, text) {
  navigator.clipboard.writeText(text.replace(/\\n/g,'\n')).then(()=>{
    btn.classList.add('copied'); btn.textContent = 'âœ“ ØªÙ… Ø§Ù„Ù†Ø³Ø®';
    setTimeout(()=>{btn.classList.remove('copied');btn.innerHTML='ğŸ“‹ Ù†Ø³Ø®';},2000);
  });
};
window.saveBk = function(btn, q, a) { window.saveBookmark(q.replace(/\\n/g,'\n'), a.replace(/\\n/g,'\n')); };
window.shareAnswer = function(text) {
  const share = text.replace(/\\n/g,'\n').substring(0,300) + '\n\nâ€” Ù†ÙˆØ± Ø§Ù„Ø¹Ù„Ù… | Ù…Ù†ØµØ© Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©';
  navigator.clipboard.writeText(share).then(()=>showToast('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ© ğŸ”—','info'));
};

function appendTyping() {
  const list = document.getElementById('messagesList');
  const id   = 'typing-' + Date.now();
  const div  = document.createElement('div');
  div.id = id; div.className = 'msg-row ai';
  div.innerHTML = `<div class="msg-inner"><div class="msg-avatar-wrap"><div class="msg-avatar-ai">â˜ª</div></div><div class="msg-content-wrap"><div class="msg-sender-name">Ù†ÙˆØ± Ø§Ù„Ø¹Ù„Ù…</div><div class="typing-dots"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div><span class="typing-label">ÙŠØ¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø´Ø±Ø¹ÙŠØ©...</span></div></div></div>`;
  list.appendChild(div); scrollToBottom(); return id;
}
function removeTyping(id) { document.getElementById(id)?.remove(); }

// ============================================================
// QURAN DB
// ============================================================
const QURAN_DB = [
  {surah:'Ø§Ù„ÙØ§ØªØ­Ø©',num:1,ayah:6,text:'Ø§Ù‡Ù’Ø¯ÙÙ†ÙØ§ Ø§Ù„ØµÙÙ‘Ø±ÙØ§Ø·Ù Ø§Ù„Ù’Ù…ÙØ³Ù’ØªÙÙ‚ÙÙŠÙ…Ù',tafsir:'Ø³Ø¤Ø§Ù„ Ø§Ù„Ø¹Ø¨Ø¯ Ø±Ø¨Ù‡ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªÙ‚ÙŠÙ…ØŒ ÙˆÙ‡Ùˆ Ø§Ù„Ø¥Ø³Ù„Ø§Ù… Ø§Ù„Ø­Ù‚ Ø§Ù„Ø°ÙŠ ÙŠÙˆØµÙ„ Ø¥Ù„Ù‰ Ø±Ø¶Ø§ Ø§Ù„Ù„Ù‡ ÙˆØ¬Ù†ØªÙ‡.'},
  {surah:'Ø§Ù„Ø¨Ù‚Ø±Ø©',num:2,ayah:2,text:'Ø°ÙÙ°Ù„ÙÙƒÙ Ø§Ù„Ù’ÙƒÙØªÙØ§Ø¨Ù Ù„ÙØ§ Ø±ÙÙŠÙ’Ø¨Ù Û› ÙÙÙŠÙ‡Ù Û› Ù‡ÙØ¯Ù‹Ù‰ Ù„ÙÙ‘Ù„Ù’Ù…ÙØªÙÙ‘Ù‚ÙÙŠÙ†Ù',tafsir:'Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… Ù„Ø§ Ø´Ùƒ ÙÙŠÙ‡ØŒ ÙˆÙ‡Ùˆ Ù‡Ø¯Ø§ÙŠØ© Ù„Ù„Ù…ØªÙ‚ÙŠÙ† Ø§Ù„Ø°ÙŠÙ† ÙŠØ®Ø´ÙˆÙ† Ø§Ù„Ù„Ù‡ ÙˆÙŠØªØ¨Ø¹ÙˆÙ† Ø£ÙˆØ§Ù…Ø±Ù‡.'},
  {surah:'Ø§Ù„Ø¨Ù‚Ø±Ø©',num:2,ayah:255,text:'Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ù„ÙØ§ Ø¥ÙÙ„ÙÙ°Ù‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ù‡ÙÙˆÙ Ø§Ù„Ù’Ø­ÙÙŠÙÙ‘ Ø§Ù„Ù’Ù‚ÙÙŠÙÙ‘ÙˆÙ…Ù Ûš Ù„ÙØ§ ØªÙØ£Ù’Ø®ÙØ°ÙÙ‡Ù Ø³ÙÙ†ÙØ©ÙŒ ÙˆÙÙ„ÙØ§ Ù†ÙÙˆÙ’Ù…ÙŒ',tafsir:'Ø¢ÙŠØ© Ø§Ù„ÙƒØ±Ø³ÙŠØŒ Ø£Ø¹Ø¸Ù… Ø¢ÙŠØ© ÙÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù†. ØªØµÙ Ø§Ù„Ù„Ù‡ Ø¨ØµÙØ§Øª Ø§Ù„ÙƒÙ…Ø§Ù„: Ø§Ù„Ø­ÙŠØ§Ø© Ø§Ù„Ø£Ø¨Ø¯ÙŠØ©ØŒ ÙˆØ§Ù„Ù‚ÙŠÙˆÙ…ÙŠØ©ØŒ ÙˆØ¹Ø¯Ù… Ø§Ù„ØºÙÙ„Ø©.'},
  {surah:'Ø§Ù„Ø¨Ù‚Ø±Ø©',num:2,ayah:286,text:'Ù„ÙØ§ ÙŠÙÙƒÙÙ„ÙÙ‘ÙÙ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ù†ÙÙÙ’Ø³Ù‹Ø§ Ø¥ÙÙ„ÙÙ‘Ø§ ÙˆÙØ³Ù’Ø¹ÙÙ‡ÙØ§',tafsir:'Ø¯Ù„ÙŠÙ„ Ø¹Ù„Ù‰ Ø±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ Ø¨Ø¹Ø¨Ø§Ø¯Ù‡ØŒ Ø¥Ø° Ù„Ø§ ÙŠÙƒÙ„ÙÙ‡Ù… Ø¥Ù„Ø§ Ø¨Ù…Ø§ ÙŠØ·ÙŠÙ‚ÙˆÙ†.'},
  {surah:'Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†',num:3,ayah:185,text:'ÙƒÙÙ„ÙÙ‘ Ù†ÙÙÙ’Ø³Ù Ø°ÙØ§Ø¦ÙÙ‚ÙØ©Ù Ø§Ù„Ù’Ù…ÙÙˆÙ’ØªÙ',tafsir:'Ø­Ù‚ÙŠÙ‚Ø© ÙƒÙˆÙ†ÙŠØ© Ø«Ø§Ø¨ØªØ©: ÙƒÙ„ Ù†ÙØ³ Ø³ØªÙ…ÙˆØªØŒ ÙˆÙ‡Ø°Ø§ ÙŠØ­Ø« Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ù„Ù„Ø¢Ø®Ø±Ø©.'},
  {surah:'ÙŠÙˆØ³Ù',num:12,ayah:87,text:'ÙˆÙÙ„ÙØ§ ØªÙÙŠÙ’Ø£ÙØ³ÙÙˆØ§ Ù…ÙÙ† Ø±ÙÙ‘ÙˆÙ’Ø­Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Û– Ø¥ÙÙ†ÙÙ‘Ù‡Ù Ù„ÙØ§ ÙŠÙÙŠÙ’Ø£ÙØ³Ù Ù…ÙÙ† Ø±ÙÙ‘ÙˆÙ’Ø­Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø§Ù„Ù’Ù‚ÙÙˆÙ’Ù…Ù Ø§Ù„Ù’ÙƒÙØ§ÙÙØ±ÙÙˆÙ†Ù',tafsir:'Ù†Ù‡ÙŠ Ø§Ù„Ù„Ù‡ Ø¹Ù† Ø§Ù„ÙŠØ£Ø³ Ù…Ù† Ø±Ø­Ù…ØªÙ‡ØŒ ÙØ§Ù„Ù…Ø¤Ù…Ù† ÙŠØ­Ø³Ù† Ø§Ù„Ø¸Ù† Ø¨Ø±Ø¨Ù‡ Ø¯Ø§Ø¦Ù…Ø§Ù‹.'},
  {surah:'Ø§Ù„Ø±Ø¹Ø¯',num:13,ayah:28,text:'Ø£ÙÙ„ÙØ§ Ø¨ÙØ°ÙÙƒÙ’Ø±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ØªÙØ·Ù’Ù…ÙØ¦ÙÙ†ÙÙ‘ Ø§Ù„Ù’Ù‚ÙÙ„ÙÙˆØ¨Ù',tafsir:'Ø§Ù„Ø·Ù…Ø£Ù†ÙŠÙ†Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù„Ø§ ØªÙÙ†Ø§Ù„ Ø¥Ù„Ø§ Ø¨Ø°ÙƒØ± Ø§Ù„Ù„Ù‡ØŒ ÙÙ‡Ùˆ Ø¯ÙˆØ§Ø¡ Ø§Ù„Ù‚Ù„ÙˆØ¨ ÙˆØ±Ø§Ø­Ø© Ø§Ù„Ø£Ø±ÙˆØ§Ø­.'},
  {surah:'Ø§Ù„Ø´Ø±Ø­',num:94,ayah:6,text:'Ø¥ÙÙ†ÙÙ‘ Ù…ÙØ¹Ù Ø§Ù„Ù’Ø¹ÙØ³Ù’Ø±Ù ÙŠÙØ³Ù’Ø±Ù‹Ø§',tafsir:'Ø¨Ø´Ø§Ø±Ø© Ø±Ø¨Ø§Ù†ÙŠØ©: Ø£Ù† Ø§Ù„ÙØ±Ø¬ Ø¢ØªÙ Ù„Ø§ Ù…Ø­Ø§Ù„Ø© Ù…Ø¹ Ø§Ù„ØµØ¨Ø±.'},
  {surah:'Ø§Ù„Ø²Ù…Ø±',num:39,ayah:53,text:'Ù‚ÙÙ„Ù’ ÙŠÙØ§ Ø¹ÙØ¨ÙØ§Ø¯ÙÙŠÙ Ø§Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø£ÙØ³Ù’Ø±ÙÙÙÙˆØ§ Ø¹ÙÙ„ÙÙ‰Ù° Ø£ÙÙ†ÙÙØ³ÙÙ‡ÙÙ…Ù’ Ù„ÙØ§ ØªÙÙ‚Ù’Ù†ÙØ·ÙÙˆØ§ Ù…ÙÙ† Ø±ÙÙ‘Ø­Ù’Ù…ÙØ©Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ûš Ø¥ÙÙ†ÙÙ‘ Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙŠÙØºÙ’ÙÙØ±Ù Ø§Ù„Ø°ÙÙ‘Ù†ÙÙˆØ¨Ù Ø¬ÙÙ…ÙÙŠØ¹Ù‹Ø§',tafsir:'Ø¨Ø§Ø¨ Ø§Ù„ØªÙˆØ¨Ø© Ù…ÙØªÙˆØ­ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ø¨Ø§Ø¯ Ù…Ù‡Ù…Ø§ Ø£Ø³Ø±ÙÙˆØ§ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§ØµÙŠ.'},
  {surah:'Ø§Ù„Ø­Ø¬Ø±Ø§Øª',num:49,ayah:13,text:'Ø¥ÙÙ†ÙÙ‘ Ø£ÙÙƒÙ’Ø±ÙÙ…ÙÙƒÙÙ…Ù’ Ø¹ÙÙ†Ø¯Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙØªÙ’Ù‚ÙØ§ÙƒÙÙ…Ù’',tafsir:'Ø§Ù„ØªÙØ§Ø¶Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø¨Ø´Ø± Ø¨Ø§Ù„ØªÙ‚ÙˆÙ‰ ÙˆØ§Ù„Ø¹Ù…Ù„ Ø§Ù„ØµØ§Ù„Ø­ Ù„Ø§ Ø¨Ø§Ù„Ø¬Ù†Ø³ Ø£Ùˆ Ø§Ù„Ù„ÙˆÙ†.'},
  {surah:'Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡',num:17,ayah:23,text:'ÙˆÙÙ‚ÙØ¶ÙÙ‰Ù° Ø±ÙØ¨ÙÙ‘ÙƒÙ Ø£ÙÙ„ÙÙ‘Ø§ ØªÙØ¹Ù’Ø¨ÙØ¯ÙÙˆØ§ Ø¥ÙÙ„ÙÙ‘Ø§ Ø¥ÙÙŠÙÙ‘Ø§Ù‡Ù ÙˆÙØ¨ÙØ§Ù„Ù’ÙˆÙØ§Ù„ÙØ¯ÙÙŠÙ’Ù†Ù Ø¥ÙØ­Ù’Ø³ÙØ§Ù†Ù‹Ø§',tafsir:'ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø± Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ† Ù…Ù‚Ø±ÙˆÙ†Ø§Ù†ØŒ Ù…Ù…Ø§ ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ø¹Ø¸Ù… Ø­Ù‚ Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ† ÙÙŠ Ø§Ù„Ø¥Ø³Ù„Ø§Ù….'},
  {surah:'Ø§Ù„Ù…Ù„Ùƒ',num:67,ayah:2,text:'Ø§Ù„ÙÙ‘Ø°ÙÙŠ Ø®ÙÙ„ÙÙ‚Ù Ø§Ù„Ù’Ù…ÙÙˆÙ’ØªÙ ÙˆÙØ§Ù„Ù’Ø­ÙÙŠÙØ§Ø©Ù Ù„ÙÙŠÙØ¨Ù’Ù„ÙÙˆÙÙƒÙÙ…Ù’ Ø£ÙÙŠÙÙ‘ÙƒÙÙ…Ù’ Ø£ÙØ­Ù’Ø³ÙÙ†Ù Ø¹ÙÙ…ÙÙ„Ù‹Ø§',tafsir:'Ø§Ù„Ø¯Ù†ÙŠØ§ Ø¯Ø§Ø± Ø§Ø¨ØªÙ„Ø§Ø¡ ÙˆØ§Ø®ØªØ¨Ø§Ø±ØŒ ÙˆØ§Ù„Ù„Ù‡ ÙŠØ±Ø§Ù‚Ø¨ Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø¹Ø¨Ø§Ø¯ Ù„ÙŠØ¬Ø²ÙŠÙ‡Ù….'}
];

window.searchQuran = function() {
  const q   = document.getElementById('quranInput').value.trim();
  const res = document.getElementById('quranResults');
  if (!q) { res.innerHTML = '<div style="text-align:center;padding:60px;color:var(--text-3)"><div style="font-size:3rem;margin-bottom:12px;opacity:0.4">ğŸ“–</div><div>Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ù„Ù„Ø¨Ø­Ø«</div></div>'; return; }
  const found = QURAN_DB.filter(v => v.text.includes(q)||v.surah.includes(q)||v.tafsir.includes(q));
  if (!found.length) { res.innerHTML = `<div style="text-align:center;padding:60px;color:var(--text-3)">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ù„Ù€ "<b style="color:var(--gold-soft)">${escHtml(q)}</b>"</div>`; return; }
  res.innerHTML = found.map((v,i) => `<div class="quran-verse-card"><div class="qvc-meta"><div class="qvc-num">${i+1}</div><div><div class="qvc-surah">Ø³ÙˆØ±Ø© ${v.surah}</div><div class="qvc-ref">Ø§Ù„Ø¢ÙŠØ© ${v.ayah}</div></div></div><div class="qvc-arabic">${v.text}</div><div class="qvc-tafsir"><div class="qvc-tafsir-label">ğŸ“š ØªÙØ³ÙŠØ± Ø§Ø¨Ù† ÙƒØ«ÙŠØ±</div>${escHtml(v.tafsir)}</div><div class="qvc-actions"><button class="msg-act-btn" onclick="copyToClipboard(this,'${v.text.replace(/'/g,"\\'")}')">ğŸ“‹ Ù†Ø³Ø®</button><a href="https://quran.com/${v.num}/${v.ayah}" target="_blank" class="msg-act-btn" style="text-decoration:none">ğŸŒ quran.com</a></div></div>`).join('');
};

// ============================================================
// HADITH DB
// ============================================================
const HADITH_DB = {
  bukhari:[
    {num:1,text:'Ø¥ÙÙ†ÙÙ‘Ù…ÙØ§ Ø§Ù„Ø£ÙØ¹Ù’Ù…ÙØ§Ù„Ù Ø¨ÙØ§Ù„Ù†ÙÙ‘ÙŠÙÙ‘Ø§ØªÙØŒ ÙˆÙØ¥ÙÙ†ÙÙ‘Ù…ÙØ§ Ù„ÙÙƒÙÙ„ÙÙ‘ Ø§Ù…Ù’Ø±ÙØ¦Ù Ù…ÙØ§ Ù†ÙÙˆÙÙ‰',degree:'ØµØ­ÙŠØ­',narrator:'Ø¹Ù…Ø± Ø¨Ù† Ø§Ù„Ø®Ø·Ø§Ø¨ Ø±Ø¶ÙŠ Ø§Ù„Ù„Ù‡ Ø¹Ù†Ù‡',explain:'Ø£ØµÙ„ ÙÙŠ Ø§Ù„ÙÙ‚Ù‡ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠ: Ø£Ù† Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ ØªÙÙ‚Ø¨Ù„ Ø£Ùˆ ØªØ±Ø¯ Ø¨Ø­Ø³Ø¨ Ø§Ù„Ù†ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù†Ø© ÙÙŠ Ø§Ù„Ù‚Ù„Ø¨.'},
    {num:2,text:'Ø¨ÙÙ†ÙÙŠÙ Ø§Ù„Ø¥ÙØ³Ù’Ù„Ø§ÙÙ…Ù Ø¹ÙÙ„ÙÙ‰ Ø®ÙÙ…Ù’Ø³Ù: Ø´ÙÙ‡ÙØ§Ø¯ÙØ©Ù Ø£ÙÙ†Ù’ Ù„Ø§Ù Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„Ø§ÙÙ‘ Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØ£ÙÙ†ÙÙ‘ Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù‹Ø§ Ø±ÙØ³ÙÙˆÙ„Ù Ø§Ù„Ù„ÙÙ‘Ù‡ÙØŒ ÙˆÙØ¥ÙÙ‚ÙØ§Ù…Ù Ø§Ù„ØµÙÙ‘Ù„Ø§ÙØ©ÙØŒ ÙˆÙØ¥ÙÙŠØªÙØ§Ø¡Ù Ø§Ù„Ø²ÙÙ‘ÙƒÙØ§Ø©ÙØŒ ÙˆÙØµÙÙˆÙ’Ù…Ù Ø±ÙÙ…ÙØ¶ÙØ§Ù†ÙØŒ ÙˆÙØ­ÙØ¬ÙÙ‘ Ø§Ù„Ù’Ø¨ÙÙŠÙ’ØªÙ',degree:'ØµØ­ÙŠØ­',narrator:'Ø§Ø¨Ù† Ø¹Ù…Ø± Ø±Ø¶ÙŠ Ø§Ù„Ù„Ù‡ Ø¹Ù†Ù‡Ù…Ø§',explain:'Ø£Ø±ÙƒØ§Ù† Ø§Ù„Ø¥Ø³Ù„Ø§Ù… Ø§Ù„Ø®Ù…Ø³Ø© Ø§Ù„ØªÙŠ ÙŠÙ‚ÙˆÙ… Ø¹Ù„ÙŠÙ‡Ø§ Ø§Ù„Ø¯ÙŠÙ†.'},
    {num:52,text:'Ø§Ù„Ù’Ø­ÙÙ„Ø§Ù„Ù Ø¨ÙÙŠÙÙ‘Ù†ÙŒØŒ ÙˆÙØ§Ù„Ù’Ø­ÙØ±ÙØ§Ù…Ù Ø¨ÙÙŠÙÙ‘Ù†ÙŒØŒ ÙˆÙØ¨ÙÙŠÙ’Ù†ÙÙ‡ÙÙ…ÙØ§ Ù…ÙØ´ÙØ¨ÙÙ‘Ù‡ÙØ§ØªÙŒ Ù„Ø§Ù ÙŠÙØ¹Ù’Ù„ÙÙ…ÙÙ‡ÙØ§ ÙƒÙØ«ÙÙŠØ±ÙŒ Ù…ÙÙ†Ù Ø§Ù„Ù†ÙÙ‘Ø§Ø³Ù',degree:'ØµØ­ÙŠØ­',narrator:'Ø§Ù„Ù†Ø¹Ù…Ø§Ù† Ø¨Ù† Ø¨Ø´ÙŠØ± Ø±Ø¶ÙŠ Ø§Ù„Ù„Ù‡ Ø¹Ù†Ù‡',explain:'Ù‚Ø§Ø¹Ø¯Ø© ÙÙ‚Ù‡ÙŠØ© Ø¹Ø¸ÙŠÙ…Ø© ÙÙŠ ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø­Ù„Ø§Ù„ Ù…Ù† Ø§Ù„Ø­Ø±Ø§Ù….'}
  ],
  muslim:[
    {num:2564,text:'Ø§Ù„Ù’Ù…ÙØ³Ù’Ù„ÙÙ…Ù Ø£ÙØ®ÙÙˆ Ø§Ù„Ù’Ù…ÙØ³Ù’Ù„ÙÙ…Ù Ù„Ø§Ù ÙŠÙØ¸Ù’Ù„ÙÙ…ÙÙ‡Ù ÙˆÙÙ„Ø§Ù ÙŠÙØ®Ù’Ø°ÙÙ„ÙÙ‡Ù ÙˆÙÙ„Ø§Ù ÙŠÙØ­Ù’Ù‚ÙØ±ÙÙ‡Ù',degree:'ØµØ­ÙŠØ­',narrator:'Ø£Ø¨Ùˆ Ù‡Ø±ÙŠØ±Ø© Ø±Ø¶ÙŠ Ø§Ù„Ù„Ù‡ Ø¹Ù†Ù‡',explain:'Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ø³Ù„Ù… Ø¹Ù„Ù‰ Ø£Ø®ÙŠÙ‡: Ø¹Ø¯Ù… Ø§Ù„Ø¸Ù„Ù… ÙˆØ§Ù„Ø®Ø°Ù„Ø§Ù† ÙˆØ§Ù„Ø§Ø­ØªÙ‚Ø§Ø±.'}
  ],
  abudawud:[
    {num:4604,text:'Ø¹ÙÙ„ÙÙŠÙ’ÙƒÙÙ…Ù’ Ø¨ÙØ³ÙÙ†ÙÙ‘ØªÙÙŠ ÙˆÙØ³ÙÙ†ÙÙ‘Ø©Ù Ø§Ù„Ù’Ø®ÙÙ„ÙÙÙØ§Ø¡Ù Ø§Ù„Ø±ÙÙ‘Ø§Ø´ÙØ¯ÙÙŠÙ†Ù Ø§Ù„Ù’Ù…ÙÙ‡Ù’Ø¯ÙÙŠÙÙ‘ÙŠÙ†ÙØŒ Ø¹ÙØ¶ÙÙ‘ÙˆØ§ Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙØ§ Ø¨ÙØ§Ù„Ù†ÙÙ‘ÙˆÙØ§Ø¬ÙØ°Ù',degree:'ØµØ­ÙŠØ­',narrator:'Ø§Ù„Ø¹Ø±Ø¨Ø§Ø¶ Ø¨Ù† Ø³Ø§Ø±ÙŠØ© Ø±Ø¶ÙŠ Ø§Ù„Ù„Ù‡ Ø¹Ù†Ù‡',explain:'ÙˆØ¬ÙˆØ¨ Ø§Ù„ØªÙ…Ø³Ùƒ Ø¨Ø³Ù†Ø© Ø§Ù„Ù†Ø¨ÙŠ ï·º ÙˆØ³Ù†Ø© Ø§Ù„Ø®Ù„ÙØ§Ø¡ Ø§Ù„Ø±Ø§Ø´Ø¯ÙŠÙ†.'}
  ],
  tirmidhi:[
    {num:2518,text:'Ø§ØªÙÙ‘Ù‚Ù Ø§Ù„Ù„Ù‡Ù Ø­ÙÙŠÙ’Ø«ÙÙ…ÙØ§ ÙƒÙÙ†Ù’ØªÙØŒ ÙˆÙØ£ÙØªÙ’Ø¨ÙØ¹Ù Ø§Ù„Ø³ÙÙ‘ÙŠÙÙ‘Ø¦ÙØ©Ù Ø§Ù„Ù’Ø­ÙØ³ÙÙ†ÙØ©Ù ØªÙÙ…Ù’Ø­ÙÙ‡ÙØ§ØŒ ÙˆÙØ®ÙØ§Ù„ÙÙ‚Ù Ø§Ù„Ù†ÙÙ‘Ø§Ø³Ù Ø¨ÙØ®ÙÙ„ÙÙ‚Ù Ø­ÙØ³ÙÙ†Ù',degree:'Ø­Ø³Ù†',narrator:'Ø£Ø¨Ùˆ Ø°Ø± Ø±Ø¶ÙŠ Ø§Ù„Ù„Ù‡ Ø¹Ù†Ù‡',explain:'Ø«Ù„Ø§Ø« ÙˆØµØ§ÙŠØ§ Ø¬Ø§Ù…Ø¹Ø©: ØªÙ‚ÙˆÙ‰ Ø§Ù„Ù„Ù‡ØŒ ÙˆØªØ¹Ù‚ÙŠØ¨ Ø§Ù„Ø³ÙŠØ¦Ø© Ø¨Ø§Ù„Ø­Ø³Ù†Ø©ØŒ ÙˆØ­Ø³Ù† Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©.'}
  ],
  nasai:[
    {num:3939,text:'ÙƒÙÙ„ÙÙ‘ Ù…ÙØ³Ù’ÙƒÙØ±Ù Ø®ÙÙ…Ù’Ø±ÙŒØŒ ÙˆÙÙƒÙÙ„ÙÙ‘ Ø®ÙÙ…Ù’Ø±Ù Ø­ÙØ±ÙØ§Ù…ÙŒ',degree:'ØµØ­ÙŠØ­',narrator:'Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø¨Ù† Ø¹Ù…Ø± Ø±Ø¶ÙŠ Ø§Ù„Ù„Ù‡ Ø¹Ù†Ù‡Ù…Ø§',explain:'ØªØ­Ø±ÙŠÙ… ÙƒÙ„ Ù…Ø³ÙƒØ± Ù‚Ù„ÙŠÙ„Ø§Ù‹ ÙƒØ§Ù† Ø£Ù… ÙƒØ«ÙŠØ±Ø§Ù‹.'}
  ],
  ibnmajah:[
    {num:2340,text:'Ù„Ø§Ù Ø¶ÙØ±ÙØ±Ù ÙˆÙÙ„Ø§Ù Ø¶ÙØ±ÙØ§Ø±Ù',degree:'ØµØ­ÙŠØ­',narrator:'Ø§Ø¨Ù† Ø¹Ø¨Ø§Ø³ Ø±Ø¶ÙŠ Ø§Ù„Ù„Ù‡ Ø¹Ù†Ù‡Ù…Ø§',explain:'Ù‚Ø§Ø¹Ø¯Ø© ÙÙ‚Ù‡ÙŠØ© ÙƒØ¨Ø±Ù‰: Ù„Ø§ ÙŠØ¬ÙˆØ² Ø¥Ù„Ø­Ø§Ù‚ Ø§Ù„Ø¶Ø±Ø± Ø¨Ø§Ù„Ù†ÙØ³ Ø£Ùˆ Ø§Ù„ØºÙŠØ±.'}
  ]
};

window.selectBook = function(book) {
  selectedBook = book;
  document.querySelectorAll('.hadith-book-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('book-'+book).classList.add('active');
  const names = {bukhari:'ØµØ­ÙŠØ­ Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ',muslim:'ØµØ­ÙŠØ­ Ù…Ø³Ù„Ù…',abudawud:'Ø³Ù†Ù† Ø£Ø¨ÙŠ Ø¯Ø§ÙˆØ¯',tirmidhi:'Ø³Ù†Ù† Ø§Ù„ØªØ±Ù…Ø°ÙŠ',nasai:'Ø³Ù†Ù† Ø§Ù„Ù†Ø³Ø§Ø¦ÙŠ',ibnmajah:'Ø³Ù†Ù† Ø§Ø¨Ù† Ù…Ø§Ø¬Ø©'};
  document.getElementById('hadithResults').innerHTML = `<div style="text-align:center;padding:40px;color:var(--text-3)">Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ù„Ù„Ø¨Ø­Ø« ÙÙŠ ${names[book]}</div>`;
};

window.searchHadith = function() {
  const q   = document.getElementById('hadithInput').value.trim();
  const res = document.getElementById('hadithResults');
  const db2 = HADITH_DB[selectedBook]||[];
  if (!q) { res.innerHTML = '<div style="text-align:center;padding:40px;color:var(--text-3)">Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ù„Ù„Ø¨Ø­Ø«</div>'; return; }
  const found = db2.filter(h=>h.text.includes(q)||h.narrator.includes(q)||h.explain.includes(q));
  if (!found.length) { res.innerHTML = `<div style="text-align:center;padding:60px;color:var(--text-3)">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ù„Ù€ "<b style="color:var(--gold-soft)">${escHtml(q)}</b>"</div>`; return; }
  const names = {bukhari:'ØµØ­ÙŠØ­ Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ',muslim:'ØµØ­ÙŠØ­ Ù…Ø³Ù„Ù…',abudawud:'Ø³Ù†Ù† Ø£Ø¨ÙŠ Ø¯Ø§ÙˆØ¯',tirmidhi:'Ø³Ù†Ù† Ø§Ù„ØªØ±Ù…Ø°ÙŠ',nasai:'Ø³Ù†Ù† Ø§Ù„Ù†Ø³Ø§Ø¦ÙŠ',ibnmajah:'Ø³Ù†Ù† Ø§Ø¨Ù† Ù…Ø§Ø¬Ø©'};
  res.innerHTML = found.map(h=>`<div class="quran-verse-card"><div class="qvc-meta"><div class="qvc-num" style="font-size:0.7rem">Ø­${h.num}</div><div><div class="qvc-surah">${names[selectedBook]}</div><div class="qvc-ref">${h.narrator}</div></div><div style="margin-right:auto"><span class="hbadge sahih">${h.degree}</span></div></div><div class="qvc-arabic" style="font-size:1.15rem">${h.text}</div><div class="qvc-tafsir"><div class="qvc-tafsir-label">ğŸ’¡ Ø§Ù„Ø´Ø±Ø­</div>${escHtml(h.explain)}</div><div class="qvc-actions"><button class="msg-act-btn" onclick="copyToClipboard(this,'${h.text.replace(/'/g,"\\'")}')">ğŸ“‹ Ù†Ø³Ø®</button><a href="https://sunnah.com/${selectedBook}:${h.num}" target="_blank" class="msg-act-btn" style="text-decoration:none">ğŸŒ sunnah.com</a></div></div>`).join('');
};

// ============================================================
// UI HELPERS
// ============================================================
window.showSection = function(name) {
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById('sec-'+name).classList.add('active');
  const titles = {chat:'Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„ÙÙ‚Ù‡ÙŠØ©',quran:'Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠ',hadith:'ÙƒØªØ¨ Ø§Ù„Ø­Ø¯ÙŠØ«',bookmarks:'Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª',admin:'Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©'};
  document.getElementById('topbarTitle').textContent = titles[name]||name;
  const navMap = {chat:0,quran:1,hadith:2,bookmarks:3};
  const navItems = document.querySelectorAll('.nav-item');
  if (navMap[name]!==undefined) navItems[navMap[name]]?.classList.add('active');
  if (window.innerWidth<900) document.getElementById('sidebar').classList.remove('open');
};

window.newChat = function() {
  chatHistory = [];
  document.getElementById('messagesList').innerHTML = '';
  document.getElementById('messagesList').style.display = 'none';
  document.getElementById('welcomeScreen').style.display = 'flex';
  showSection('chat');
};

window.clearChat = function() {
  chatHistory = [];
  document.getElementById('messagesList').innerHTML = '';
  document.getElementById('messagesList').style.display = 'none';
  document.getElementById('welcomeScreen').style.display = 'flex';
  showToast('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©', 'info');
};

window.fillQuestion = function(q) {
  document.getElementById('chatInput').value = q;
  document.getElementById('chatInput').focus();
  autoResize(document.getElementById('chatInput'));
};

window.setMode = function(mode) {
  currentMode = mode;
  document.querySelectorAll('.it-btn').forEach(b=>b.classList.remove('active-mode'));
  document.getElementById('mode-'+mode).classList.add('active-mode');
  const placeholders = {general:'Ø§Ø³Ø£Ù„ Ø³Ø¤Ø§Ù„Ùƒ Ø§Ù„Ø´Ø±Ø¹ÙŠ Ù‡Ù†Ø§...',quran:'Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¢ÙŠØ© Ù‚Ø±Ø¢Ù†ÙŠØ© Ø£Ùˆ Ù…ÙˆØ¶ÙˆØ¹...',hadith:'Ø§Ø¨Ø­Ø« Ø¹Ù† Ø­Ø¯ÙŠØ« Ù†Ø¨ÙˆÙŠ...',fiqh:'Ø§Ø³Ø£Ù„ Ø¹Ù† Ù…Ø³Ø£Ù„Ø© ÙÙ‚Ù‡ÙŠØ© Ù…Ù‚Ø§Ø±Ù†Ø©...'};
  document.getElementById('chatInput').placeholder = placeholders[mode];
};

window.handleKeydown = function(e) { if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage();} };

window.autoResize = function(el) {
  el.style.height='auto';
  el.style.height=Math.min(el.scrollHeight,200)+'px';
  document.getElementById('charCounter').textContent=el.value.length+' / 1000';
  if(el.value.length>1000) el.value=el.value.substring(0,1000);
};

window.openModal = function(tab='login') {
  document.getElementById('authOverlay').classList.add('open');
  switchTab(tab);
  document.getElementById('auth-error').style.display='none';
};

window.closeModal = function() { document.getElementById('authOverlay').classList.remove('open'); };

window.switchTab = function(tab) {
  document.getElementById('tab-login').classList.toggle('active', tab==='login');
  document.getElementById('tab-register').classList.toggle('active', tab==='register');
  document.getElementById('form-login').style.display    = tab==='login'?'block':'none';
  document.getElementById('form-register').style.display = tab==='register'?'block':'none';
  document.getElementById('auth-error').style.display    = 'none';
};

window.toggleSidebar = function() {
  const sb = document.getElementById('sidebar');
  if (window.innerWidth<900) sb.classList.toggle('open');
  else sb.classList.toggle('collapsed');
};

window.toggleDropdown = function(e) {
  e.stopPropagation();
  const dd = document.getElementById('userDropdown');
  const rect = e.currentTarget.getBoundingClientRect();
  dd.style.bottom = (window.innerHeight-rect.top+8)+'px';
  dd.style.right  = (window.innerWidth-rect.right)+'px';
  dd.classList.toggle('open');
};

window.closeDropdown = function() { document.getElementById('userDropdown').classList.remove('open'); };
document.addEventListener('click', closeDropdown);

window.checkPwStrength = function(pw) {
  const fill=document.getElementById('pw-fill'), label=document.getElementById('pw-label');
  let s=0;
  if(pw.length>=6)s++;if(pw.length>=10)s++;if(/[A-Z]/.test(pw))s++;if(/[0-9]/.test(pw))s++;if(/[^A-Za-z0-9]/.test(pw))s++;
  const cfg=[{w:'0%',c:'#f87171',t:''},{w:'25%',c:'#f87171',t:'Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹'},{w:'50%',c:'#fb923c',t:'Ø¶Ø¹ÙŠÙØ©'},{w:'70%',c:'#facc15',t:'Ù…ØªÙˆØ³Ø·Ø©'},{w:'90%',c:'#86efac',t:'Ø¬ÙŠØ¯Ø©'},{w:'100%',c:'#6dd897',t:'Ù‚ÙˆÙŠØ© Ø¬Ø¯Ø§Ù‹ âœ“'}][Math.min(s,5)];
  fill.style.width=cfg.w;fill.style.background=cfg.c;label.textContent=cfg.t;label.style.color=cfg.c;
};

window.showToast = function(msg, type='info') {
  const c=document.getElementById('toastContainer');
  const t=document.createElement('div');
  const icons={success:'âœ“',error:'âœ•',info:'â„¹'};
  t.className=`toast ${type}`;
  t.innerHTML=`<span class="toast-icon">${icons[type]||'â„¹'}</span>${msg}`;
  c.appendChild(t);
  setTimeout(()=>{t.style.opacity='0';t.style.transform='translateY(10px)';setTimeout(()=>t.remove(),300);},3000);
};

function showLoadingBar() { document.getElementById('loadingBar').classList.add('active'); }
function hideLoadingBar() { document.getElementById('loadingBar').classList.remove('active'); }
function scrollToBottom() { const vp=document.getElementById('chatViewport'); vp.scrollTop=vp.scrollHeight; }
function escHtml(t='') { return String(t).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

// Init
setMode('general');
</script>
</body>
</html>
